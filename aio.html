<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Geospatial Data Carpentry for Urbanism: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Geospatial Data Carpentry for Urbanism
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Geospatial Data Carpentry for Urbanism
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Geospatial Data Carpentry for Urbanism
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro-to-r.html">1. Introduction to R and RStudio</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-data-structures.html">2. Data Structures</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-explore-data.html">3. Exploring Data Frames &amp; Data frame Manipulation with dplyr</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-intro-to-visualisation.html">4. Introduction to visualisation</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="08-intro-to-geospatial-concepts.html">5. Introduction to Geospatial Concepts</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="09-open-and-plot-vector-layers.html">6. Open and Plot Vector Layers</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="10-explore-and-plot-by-vector-layer-attributes.html">7. Explore and plot by vector layer attributes</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="11-plot-multiple-shape-files.html">8. Plot multiple shapefiles</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="12-handling-spatial-projection-and-crs.html">9. Handling Spatial Projections &amp; CRS</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="13-intro-to-raster-data.html">10. Intro to Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="14-plot-raster-data.html">11. Plot Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="15-reproject-raster-data.html">12. Reproject Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="16-raster-calculations.html">13. Raster Calculations</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="17-work-with-multi-band-rasters.html">14. Work with Multi-Band Rasters</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-intro-to-r"><p>Content from <a href="01-intro-to-r.html">Introduction to R and RStudio</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/01-intro-to-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to find your way around RStudio?</li>
<li>How to manage projects in R?</li>
<li>How to install packages?</li>
<li>How to interact with R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Create self-contained projects in RStudio</li>
<li>Install additional packages using R code.</li>
<li>Manage packages</li>
<li>Define a variable</li>
<li>Assign data to a variable</li>
<li>Call functions</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="project-management-in-rstudio">Project management in RStudio<a class="anchor" aria-label="anchor" href="#project-management-in-rstudio"></a>
</h1>
<p>RStudio is an integrated development environment (IDE), which means
it provides a (much prettier) interface for the R software. For RStudio
to work, you need to have R installed on your computer. But R is
integrated into RStudio, so you never actually have to open R
software.</p>
<p>RStudio provides a useful feature: creating projects - self-contained
working space (i.e. working directory), to which R will refer to, when
looking for and saving files. You can create projects in existing
directories (folders) or create a new one.</p>
<div class="section level2">
<h2 id="creating-rstudio-project">Creating RStudio Project<a class="anchor" aria-label="anchor" href="#creating-rstudio-project"></a>
</h2>
<p>We’re going to create a project in RStudio in a new directory. To
create a project, go to:</p>
<ul>
<li><code>File</code></li>
<li><code>New Project</code></li>
<li><code>New directory</code></li>
<li>Place the project that you will easily find on your laptop and name
the project <code>data-carpentry</code>
</li>
<li><code>Create project</code></li>
</ul>
</div>
<div class="section level2">
<h2 id="organising-working-directory">Organising working directory<a class="anchor" aria-label="anchor" href="#organising-working-directory"></a>
</h2>
<p>Creating an RStudio project is a good first step towards good project
management. However, most of the time it is a good idea to organize
working space further. This is one suggestion of how your R project can
look like. Let’s go ahead and create the other folders:</p>
<ul>
<li>
<code>data/</code> - should be where your raw data is. <strong>READ
ONLY</strong>
</li>
<li>
<code>data_output/</code> - should be where your data output is
saved <strong>READ AND WRITE</strong>
</li>
<li>
<code>documents/</code> - all the documentation associated with the
project (e.g. cookbook)</li>
<li>
<code>fig_output/</code> - your figure outputs go here <strong>WRITE
ONLY</strong>
</li>
<li>
<code>scripts/</code> - all your code goes here <strong>READ AND
WRITE</strong>
</li>
</ul>
<figure><img src="fig/rstudio_project_files.jpeg" alt="RStudio  project logo with five lines, each leading from the logo towards  one of the five boxes with texts: 'data/', 'data_output/',  'documents/', 'fig_output/', 'scripts/'" class="figure mx-auto d-block"><figcaption>R project organization</figcaption></figure><p>You can create these folders as you would any other folders on your
laptop, but R and RStudio offer handy ways to do it directly in your
RStudio session.</p>
<p>You can use RStudio interface to create a folder in your project by
going to lower-bottom pane, files tab, and clicking on Folder icon. A
dialog box will appear, allowing you typing a name of a folder you want
to create.</p>
<p>An alternative solution is to create the folders using R command
<code>dir.create()</code>. In the console type:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dir.create</span><span class="op">(</span><span class="st">'data'</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">'data_output'</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">'documents'</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">'fig_output'</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">'scripts'</span><span class="op">)</span></span></code></pre>
</div>

</div>
<div class="section level2">
<h2 id="two-main-ways-to-interact-with-r">Two main ways to interact with R<a class="anchor" aria-label="anchor" href="#two-main-ways-to-interact-with-r"></a>
</h2>
<p>There are two main ways to interact with R through RStudio:</p>
<ul>
<li>test and play environment within the interactive <strong>R
console</strong>
</li>
<li>write and save an <strong>R script (<code>.R</code>
file)</strong>
</li>
</ul>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>When you open the RStudio or create the Rstudio project, you will see
Console window on the left by default. Once you create an R script, it
is placed in the upper left pane. The Console is moved to the bottom
left pane.</p>
</div>
</div>
</div>
<p>Each of the modes o interactions has its advantages and
drawbacks.</p>
<table class="table">
<colgroup>
<col width="30%">
<col width="34%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Console</th>
<th>R script</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Pros</strong></td>
<td>Immediate results</td>
<td>Work lost once you close RStudio</td>
</tr>
<tr class="even">
<td><strong>Cons</strong></td>
<td>Complete record of your work</td>
<td>Messy if you just want to print things out</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="creating-a-script">Creating a script<a class="anchor" aria-label="anchor" href="#creating-a-script"></a>
</h2>
<p>During the workshop we will mostly use an <code>.R</code> script to
have a full documentation of what has been written. This way we will
also be able to reproduce the results. Let’s create one now and save it
in the <code>scripts</code> directory.</p>
<ul>
<li><code>File</code></li>
<li><code>New File</code></li>
<li><code>R Script</code></li>
<li>A new <code>Untitled</code> script will appear in the source
pane.</li>
<li>Save it using floppy disc icon.</li>
<li>Select the <code>scripts/</code> folder as the file location</li>
<li>Name the script <code>intro-to-r.R</code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-the-code">Running the code<a class="anchor" aria-label="anchor" href="#running-the-code"></a>
</h2>
<p>Note that all code written in the script can be also executed at a
spot in the<br>
interactive console. We will now learn how to run the code both in the
console and the script.</p>
<ul>
<li>In the Console you run the code by hitting <kbd>Enter</kbd> at the
end of the line</li>
<li>In the R script there are two way to execute the code:
<ul>
<li>You can use the <code>Run</code> button on the top right of the
script window.</li>
<li>Alternatively, you can use a keyboard shortcut: <kbd>Ctrl</kbd> +
<kbd>Enter</kbd> or <kbd>Command</kbd> + <kbd>Return</kbd> for MAC
users.</li>
</ul>
</li>
</ul>
<p>In both cases, the active line (the line where your cursor is placed)
or a highlighted snippet of code will be executed. A common source of
error in scripts, such as a previously created object not found, is code
that has not been executed in previous lines: make sure that all code
has been executed as described above. To run all lines before the active
line, you can use the keyboard shortcut <kbd>Ctrl</kbd> + <kbd>Alt</kbd>
+ <kbd>B</kbd> on Windows/Linux or <kbd>Command</kbd> +
<kbd>option</kbd> + <kbd>B</kbd> on Mac.</p>
<div id="escaping" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="escaping" class="callout-inner">
<h3 class="callout-title">Escaping<a class="anchor" aria-label="anchor" href="#escaping"></a>
</h3>
<div class="callout-content">
<p>The console shows it’s ready to get new commands with
<code>&gt;</code> sign. It will show <code>+</code> sign if it still
requires input for the command to be executed.</p>
<p>Sometimes you don’t know what is missing/ you change your mind and
want to run something else, or your code is running much too long and
you just want it to stop. The way to do it is to press
<kbd>Esc</kbd>.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>A great power of R lays in <strong>packages: add-on sets of
functions</strong> that are build by the community and once they go
through a quality process they are available to download from a
repository called <code>CRAN</code>. They need to be explicitly
activated. Now, we will be using <code>tidyverse</code> package, which
is actually a collection of useful packages. Another package that we
will use is <code>here</code>.</p>
<p>You were asked to install <code>tidyverse</code> package in the
preparation for the workshop. You need to install a package only once,
so you won’t have to do it again. We will however need to install the
<code>here</code> package. To do so, please go to your script and
type:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'here'</span><span class="op">)</span></span></code></pre>
</div>
<div id="callout3" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout3"></a>
</h3>
<div class="callout-content">
<p>If you are not sure if you have <code>tidyverse</code> packaged
installed, you can check it in the <code>Packages</code> tab in the
bottom right pane. In the search box start typing
‘<code>tidyverse</code>’ and see if it appears in the list of installed
packages. If not, you will need to install it by writing in the
script:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'tidyverse'</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="commenting-your-code" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="commenting-your-code" class="callout-inner">
<h3 class="callout-title">Commenting your code<a class="anchor" aria-label="anchor" href="#commenting-your-code"></a>
</h3>
<div class="callout-content">
<p>Now we have a bit of an issue with our script. As mentioned, the
packages need to be installed only once, but now, they will be installed
each time we run the script, which can take a lot of time if we’re
installing a large package like <code>tidyverse</code>.</p>
<p>To keep a trace of you installing the packages, without executing it,
you can use a comment. In <code>R</code>, anything that is written after
a has sign <code>#</code>, is ignored in execution. Thanks to this
feature, you can annotate your code. Let’s adapt our script by changing
the first lines into comments:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages('here')</span></span>
<span><span class="co"># install.packages('tidyverse')</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Installing packages is not sufficient to work with them. You will
need to load them each time you want to use them. To do that you use
<code>library()</code> command:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="handling-paths">Handling paths<a class="anchor" aria-label="anchor" href="#handling-paths"></a>
</h2>
<p>You have created a project which is your working directory, and a few
sub-folders, that will help you organise your project better. But now,
each time you will save or retrieve a file from those folders, you will
need to specify the path from the folder you are in (most likely the
<code>scripts/</code> folder) to those files.</p>
<p>That can become complicated and might cause a reproducibility
problem, if the person using your code (including future you) is working
in a different sub-folder.</p>
<p>We will use the <code>here()</code> package to tackle this issue.
This package converts relative paths from the root (main folder) of your
project to absolute paths (the exact location on your computer). For
instance, instead of writing out the full path like
“C:/Users/YourName/Documents/r-geospatial-urban/data/file.csv” or
“~/Documents/r-geospatial-urban/data/file.csv”, you can use the
<code>here()</code> function to create a path relative to your project’s
main directory. This makes your code more portable and reproducible, as
it doesn’t depend on a specific location of your project on your
computer.</p>
<p>It might be confusing, so let’s see how it works. We will use the
<code>here()</code> function from the <code>here</code> package. In the
console, we write:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">here</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">here</span><span class="op">(</span><span class="st">'data'</span><span class="op">)</span></span></code></pre>
</div>
<p>You all probably have something different printed out. And this is
fine, because <code>here</code> adapts to your computer’s specific
situation.</p>
</div>
<div class="section level2">
<h2 id="download-files">Download files<a class="anchor" aria-label="anchor" href="#download-files"></a>
</h2>
<p>We still need to download data for the first part of the workshop.
You can do it with the function <code>download.file()</code>. We will
save it in the <code>data/</code> folder, where the <strong>raw</strong>
data should go. In the script, we will write:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download the data</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">'https://bit.ly/geospatial_data'</span>, </span>
<span>              <span class="fu">here</span><span class="op">(</span><span class="st">'episodes'</span>, <span class="st">'data'</span>,<span class="st">'gapminder_data.csv'</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div id="importing-data-into-r" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="importing-data-into-r" class="callout-inner">
<h3 class="callout-title">Importing data into R<a class="anchor" aria-label="anchor" href="#importing-data-into-r"></a>
</h3>
<div class="callout-content">
<p>Three of the most common ways of importing data in R are:</p>
<ul>
<li>loading a package with pre-installed data;</li>
<li>downloading data from a URL;</li>
<li>reading a file from your computer.</li>
</ul>
<p>For larger datasets, database connections or API requests are also
possible. We will not cover these in the workshop.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="introduction-to-r">Introduction to R<a class="anchor" aria-label="anchor" href="#introduction-to-r"></a>
</h1>
<p>You can use R as calculator, you can for example write:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">+</span><span class="fl">100</span></span>
<span><span class="fl">1</span><span class="op">*</span><span class="fl">100</span></span>
<span><span class="fl">1</span><span class="op">/</span><span class="fl">100</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="variables-and-assignment">Variables and assignment<a class="anchor" aria-label="anchor" href="#variables-and-assignment"></a>
</h2>
<p>However, what’s more useful is that in R we can store values and use
them whenever we need to. We using the assignment operator
<code>&lt;-</code>, like this:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>Notice that assignment does not print a value. Instead, we’ve stored
it for later in something called a variable. <code>x</code> variable now
contains the value <code>0.025</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<p>Look for the <code>Environment</code> tab in the upper right pane of
RStudio. You will see that <code>x</code> and its value have appeared in
the list of Values. Our variable <code>x</code> can be used in place of
a number in any calculation that expects a number, e.g. when calculating
a square root:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<p>Variables can be also reassigned. This means that we can assign a new
value to variable <code>x</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<p>You can use one variable to create a new one:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># you can use value stored in object x to create y</span></span>
<span><span class="va">y</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to write and run R programs.</li>
<li>Use <code>install.packages()</code> to install packages.</li>
<li>Use <code>library()</code> to load packages.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div></section><section id="aio-02-data-structures"><p>Content from <a href="02-data-structures.html">Data Structures</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/02-data-structures.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the basic data types in R?</li>
<li>How do I represent categorical information in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>To be aware of the different types of data.</li>
<li>To begin exploring data frames, and understand how they are related
to vectors, factors and lists.</li>
<li>To be able to ask questions from R about the type, class, and
structure of an object.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="vectors"><h2 class="section-heading">Vectors<a class="anchor" aria-label="anchor" href="#vectors"></a>
</h2>
<hr class="half-width">
<p>So far we’ve looked on individual values. Now we will move to a data
structure called vectors. Vectors are arrays of values of the same data
type.</p>
<div id="data-types" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-types" class="callout-inner">
<h3 class="callout-title">Data types<a class="anchor" aria-label="anchor" href="#data-types"></a>
</h3>
<div class="callout-content">
<p>Data type refers to a type of information that is stored by a value.
It can be:</p>
<ul>
<li>
<code>numerical</code> (a number)</li>
<li>
<code>integer</code> (a number without information about decimal
points)</li>
<li>
<code>logical</code> (a boolean - are values TRUE or FALSE?)</li>
<li>
<code>character</code> (a text/ string of characters)</li>
<li>
<code>complex</code> (a complex number)</li>
<li>
<code>raw</code> (raw bytes)</li>
</ul>
<p>We won’t discuss <code>complex</code> or <code>raw</code> data type
in the workshop.</p>
</div>
</div>
</div>
<div id="data-structures" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-structures" class="callout-inner">
<h3 class="callout-title">Data structures<a class="anchor" aria-label="anchor" href="#data-structures"></a>
</h3>
<div class="callout-content">
<p>Vectors are the most common and basic data structure in R but you
will come across other data structures such as data frames, lists and
matrices as well. In short:</p>
<ul>
<li>data.frames is a two-dimensional data structure in which columns are
vectors of the same length that can have different data types. We will
use this data structure in this lesson.</li>
<li>lists can have an arbitrary structure and can mix data types;</li>
<li>matrices are two-dimensional data structures containing elements of
the same data type.</li>
</ul>
<p>For a more detailed description, see <a href="https://swcarpentry.github.io/r-novice-inflammation/13-supp-data-structures.html" class="external-link">Data
Types and Structures</a>.</p>
<p>Note that vector data in the geospatial context is different from
vector data types. More about vector data in a <a href="09-open-and-plot-vector-layers.html">later lesson</a>!</p>
</div>
</div>
</div>
<p>You can create a vector with a <code>c()</code> function.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numeric_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># vector of numbers - numeric data type.</span></span>
<span><span class="va">numeric_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 6 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'banana'</span>, <span class="st">'apple'</span>, <span class="st">'orange'</span><span class="op">)</span> <span class="co"># vector of words - or strings of characters- character data type</span></span>
<span><span class="va">character_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "banana" "apple"  "orange"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logical_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># vector of logical values (is something true or false?)- logical data type.</span></span>
<span><span class="va">logical_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE FALSE  TRUE</code></pre>
</div>
<div class="section level3">
<h3 id="combining-vectors">Combining vectors<a class="anchor" aria-label="anchor" href="#combining-vectors"></a>
</h3>
<p>The combine function, <code>c()</code>, will also append things to an
existing vector:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ab_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span></span>
<span><span class="va">ab_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abcd_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">ab_vector</span>, <span class="st">'c'</span>, <span class="st">'d'</span><span class="op">)</span></span>
<span><span class="va">abcd_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b" "c" "d"</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="missing-values">Missing values<a class="anchor" aria-label="anchor" href="#missing-values"></a>
</h3>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>Combine the <code>abcd_vector</code> with the
<code>numeric_vector</code> in R. What is the data type of this new
vector and why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<pre><code><span><span class="va">combined_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">abcd_vector</span>, <span class="va">numeric_vector</span><span class="op">)</span></span>
<span><span class="va">combined_vector</span></span></code></pre>
<p>The combined vector is a character vector. Because vectors can only
hold one data type and <code>abcd_vector</code> cannot be interpreted as
numbers, the numbers in <code>numeric_vector</code> are <em>coerced</em>
into characters.</p>
</div>
</div>
</div>
</div>
<p>A common operation you want to perform is to remove all the missing
values (in R denoted as <code>NA</code>). Let’s have a look how to do
it:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">with_na</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="cn">NA</span> <span class="op">)</span> <span class="co"># vector including missing value</span></span></code></pre>
</div>
<p>First, let’s try to calculate mean for the values in this vector</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="co"># mean() function cannot interpret the missing values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">with_na</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="co"># You can add the argument na.rm=TRUE to calculate the result while ignoring the missing values.</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.6</code></pre>
</div>
<p>However, sometimes, you would like to have the <code>NA</code>
permanently removed from your vector. For this you need to identify
which elements of the vector hold missing values with
<code>is.na()</code> function.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="co">#  This will produce a vector of logical values, stating if a statement 'This element of the vector is a missing value' is true or not</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="co"># # The ! operator means negation ,i.e. not is.na(with_na)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE</code></pre>
</div>
<p>We know which elements in the vectors are <code>NA</code>. Now we
need to retrieve the subset of the <code>with_na</code> vector that is
not <code>NA</code>. Sub-setting in <code>R</code> is done with square
brackets<code>[ ]</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">without_na</span> <span class="op">&lt;-</span> <span class="va">with_na</span><span class="op">[</span> <span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="op">]</span> <span class="co"># this notation will return only the elements that have TRUE on their respective positions</span></span>
<span></span>
<span><span class="va">without_na</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 1 1 3</code></pre>
</div>
</div>
</section><section id="factors"><h2 class="section-heading">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h2>
<hr class="half-width">
<p>Another important data structure is called a <strong>factor</strong>.
Factors look like character data, but are used to represent categorical
information.</p>
<p>Factors create a structured relation between the different levels
(values) of a categorical variable, such as days of the week or
responses to a question in a survey. While factors look (and often
behave) like character vectors, they are actually treated as numbers by
<code>R</code>, which is useful for computing summary statistics about
their distribution, running regression analysis, etc. So you need to be
very careful when treating them as strings.</p>
<div class="section level3">
<h3 id="create-factors">Create factors<a class="anchor" aria-label="anchor" href="#create-factors"></a>
</h3>
<p>Once created, factors can only contain a pre-defined set of values,
known as levels.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_str</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'Norway'</span>, <span class="st">'Sweden'</span>, <span class="st">'Norway'</span>, <span class="st">'Denmark'</span>, <span class="st">'Sweden'</span><span class="op">)</span></span>
<span><span class="va">nordic_str</span> <span class="co"># regular character vectors printed out</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Norway"  "Sweden"  "Norway"  "Denmark" "Sweden" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_cat</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic_str</span><span class="op">)</span> <span class="co"># factor() function converts a vector to factor data type</span></span>
<span><span class="va">nordic_cat</span> <span class="co"># With factors, R prints out additional information - 'Levels'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden 
Levels: Denmark Norway Sweden</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="inspect-factors">Inspect factors<a class="anchor" aria-label="anchor" href="#inspect-factors"></a>
</h3>
<p>R will treat each unique value from a factor vector as a
<strong>level</strong> and (silently) assign numerical values to it.
This can come in handy when performing statistical analysis. You can
inspect and adapt levels of the factor.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">nordic_cat</span><span class="op">)</span> <span class="co"># returns all levels of a factor vector.  </span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Norway"  "Sweden" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlevels</span><span class="op">(</span><span class="va">nordic_cat</span><span class="op">)</span> <span class="co"># returns number of levels in a vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="reorder-levels">Reorder levels<a class="anchor" aria-label="anchor" href="#reorder-levels"></a>
</h3>
<p>Note that <code>R</code> sorts the levels in the alphabetic order,
not in the order of occurrence in the vector. <code>R</code> assigns
value of:</p>
<ul>
<li>1 to level ‘Denmark’,</li>
<li>2 to ‘Norway’</li>
<li>3 to ‘Sweden’.</li>
</ul>
<p>This is important as it can affect e.g. the order in which categories
are displayed in a plot or which category is taken as a baseline in a
statistical model.</p>
<p>You can reorder the categories using <code>factor()</code> function.
This can be useful, for instance, to select a reference category (first
level) in a regression model or for ordering legend items in a plot,
rather than using the default category systematically (i.e. based on
alphabetical order).</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_cat</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic_cat</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'Norway'</span> , <span class="st">'Denmark'</span>, <span class="st">'Sweden'</span><span class="op">)</span><span class="op">)</span>  <span class="co"># now Norway should be the first category, Denmark second and Sweden third</span></span>
<span></span>
<span><span class="va">nordic_cat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden 
Levels: Norway Denmark Sweden</code></pre>
</div>
<div id="callout3" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout3"></a>
</h3>
<div class="callout-content">
<p>There is more than one way to reorder factors. Later in the lesson,
we will use <code>fct_relevel()</code> function from
<code>forcats</code> package to do the reordering.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># nordic_cat &lt;- fct_relevel(nordic_cat, 'Norway' , 'Denmark', 'Sweden') # now Norway should be the first category, Denmark second and Sweden third</span></span>
<span></span>
<span><span class="va">nordic_cat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden 
Levels: Norway Denmark Sweden</code></pre>
</div>
</div>
</div>
</div>
<p>You can also inspect vectors with <code>str()</code> function. In
factor vectors, it shows the underlying values of each category. You can
also see the structure in the environment tab of RStudio.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic_cat</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> Factor w/ 3 levels "Norway","Denmark",..: 1 3 1 2 3</code></pre>
</div>
<div id="note-of-caution" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note-of-caution" class="callout-inner">
<h3 class="callout-title">Note of caution<a class="anchor" aria-label="anchor" href="#note-of-caution"></a>
</h3>
<div class="callout-content">
<p>Remember that once created, factors can only contain a pre-defined
set of values, known as levels. It means that whenever you try to add
something to the factor outside of this set, it will become an
unknown/missing value detonated by <code>R</code> as
<code>NA</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_str</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Norway"  "Sweden"  "Norway"  "Denmark" "Sweden" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_cat2</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic_str</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'Norway'</span>, <span class="st">'Denmark'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nordic_cat2</span> <span class="co"># since we have not included Sweden in the list of factor levels, it has become NA.</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  &lt;NA&gt;    Norway  Denmark &lt;NA&gt;   
Levels: Norway Denmark</code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The mostly used basic data types in R are <code>numeric</code>,
<code>integer</code>, <code>logical</code>, and
<code>character</code>
</li>
<li>Use factors to represent categories in R.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></section><section id="aio-03-explore-data"><p>Content from <a href="03-explore-data.html">Exploring Data Frames &amp; Data frame Manipulation with dplyr</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/03-explore-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a data frame?</li>
<li>How can I read data in R?</li>
<li>How can I get basic summary information about my data set?</li>
<li>How can I select specific rows and/or columns from a data
frame?</li>
<li>How can I combine multiple commands into a single command?</li>
<li>How can I create new columns or remove existing columns from a data
frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Describe what a data frame is.</li>
<li>Load external data from a .csv file into a data frame.</li>
<li>Summarize the contents of a data frame.</li>
<li>Select certain columns in a data frame with the dplyr function
select.</li>
<li>Select certain rows in a data frame according to filtering
conditions with the dplyr function filter.</li>
<li>Link the output of one dplyr function to the input of another
function with the ‘pipe’ operator %&gt;%.</li>
<li>Add new columns to a data frame that are functions of existing
columns with mutate.</li>
<li>Use the split-apply-combine concept for data analysis.</li>
<li>Use summarize, group_by, and count to split a data frame into groups
of observations, apply a summary statistics for each group, and then
combine the results.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="exploring-data-frames">
<a href="https://datacarpentry.org/r-intro-geospatial/04-data-structures-part2/index.html" class="external-link">Exploring
Data frames</a><a class="anchor" aria-label="anchor" href="#exploring-data-frames"></a>
</h1>
<p>Now we turn to the bread-and-butter of working with <code>R</code>:
working with tabular data. In <code>R</code> data are stored in a data
structure called <strong>data frames</strong>.</p>
<p>A data frame is a representation of data in the format of a
<strong>table</strong> where the columns are <strong>vectors</strong>
that all have the <strong>same length</strong>.</p>
<p>Because columns are vectors, each column must contain a
<strong>single type of data</strong> (e.g., characters, numeric,
factors). For example, here is a figure depicting a data frame
comprising a numeric, a character, and a logical vector.</p>
<p><img src="fig/data-frame.svg" class="figure"><br><font size="3"><em>Source</em>:<a href="https://datacarpentry.org/r-socialsci/02-starting-with-data/index.html#what-are-data-frames-and-tibbles" class="external-link">Data
Carpentry R for Social Scientists</a></font></p>
<div class="section level2">
<h2 id="reading-data">Reading data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h2>
<p><code>read.csv()</code> is a function used to read coma separated
data files (<code>.csv</code> format)). There are other functions for
files separated with other delimiters. We’re gonna read in the
<code>gapminder</code> data set with information about countries’ size,
GDP and average life expectancy in different years.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="exploring-dataset">Exploring dataset<a class="anchor" aria-label="anchor" href="#exploring-dataset"></a>
</h2>
<p>Let’s investigate the <code>gapminder</code> data frame a bit; the
first thing we should always do is check out what the data looks
like.</p>
<p>It is important to see if all the variables (columns) have the data
type that we require. For instance, a column might have numbers stored
as characters, which would not allow us to make calculations with those
numbers.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spc_tbl_ [1,704 × 6] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ country  : chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : num [1:1704] 1952 1957 1962 1967 1972 ...
 $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr [1:1704] "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
 - attr(*, "spec")=
  .. cols(
  ..   country = col_character(),
  ..   year = col_double(),
  ..   pop = col_double(),
  ..   continent = col_character(),
  ..   lifeExp = col_double(),
  ..   gdpPercap = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<p>We can see that the <code>gapminder</code> object is a data.frame
with 1704 observations (rows) and 6 variables (columns).</p>
<p>In each line after a <code>$</code> sign, we see the name of each
column, its type and first few values.</p>
<div class="section level3">
<h3 id="first-look-at-the-dataset">First look at the dataset<a class="anchor" aria-label="anchor" href="#first-look-at-the-dataset"></a>
</h3>
<p>There are multiple ways to explore a data set. Here are just a few
examples:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># see first 6  rows of the data set</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 6
  country      year      pop continent lifeExp gdpPercap
  &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Afghanistan  1952  8425333 Asia         28.8      779.
2 Afghanistan  1957  9240934 Asia         30.3      821.
3 Afghanistan  1962 10267083 Asia         32.0      853.
4 Afghanistan  1967 11537966 Asia         34.0      836.
5 Afghanistan  1972 13079460 Asia         36.1      740.
6 Afghanistan  1977 14880372 Asia         38.4      786.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># gives basic statistical information about each column. Information format differes by data type.</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   country               year           pop             continent        
 Length:1704        Min.   :1952   Min.   :6.001e+04   Length:1704       
 Class :character   1st Qu.:1966   1st Qu.:2.794e+06   Class :character  
 Mode  :character   Median :1980   Median :7.024e+06   Mode  :character  
                    Mean   :1980   Mean   :2.960e+07                     
                    3rd Qu.:1993   3rd Qu.:1.959e+07                     
                    Max.   :2007   Max.   :1.319e+09                     
    lifeExp        gdpPercap       
 Min.   :23.60   Min.   :   241.2  
 1st Qu.:48.20   1st Qu.:  1202.1  
 Median :60.71   Median :  3531.8  
 Mean   :59.47   Mean   :  7215.3  
 3rd Qu.:70.85   3rd Qu.:  9325.5  
 Max.   :82.60   Max.   :113523.1  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># returns number of rows in a dataset</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># returns number of columns in a dataset</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="dollar-sign">Dollar sign ($)<a class="anchor" aria-label="anchor" href="#dollar-sign"></a>
</h3>
<p>When you’re analyzing a data set, you often need to access its
specific columns.</p>
<p>One handy way to access a column is using it’s name and a dollar sign
<code>$</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_vec</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">country</span>  <span class="co"># Notation means: From dataset gapminder, give me column country. You can see that the column accessed in this way is just a vector of characters. </span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">country_vec</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan"
[6] "Afghanistan"</code></pre>
</div>
<p>Note that the calling a column with a <code>$</code> sign will return
a <em>vector</em>, it’s not a data frame anymore.</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="data-frame-manipulation-with-dplyr">
<a href="https://datacarpentry.org/r-intro-geospatial/06-dplyr/index.html" class="external-link">Data
frame Manipulation with dplyr</a><a class="anchor" aria-label="anchor" href="#data-frame-manipulation-with-dplyr"></a>
</h1>
<div class="section level2">
<h2 id="select">Select<a class="anchor" aria-label="anchor" href="#select"></a>
</h2>
<p>Let’s start manipulating the data.</p>
<p>First, we will adapt our data set, by keeping only the columns we’re
interested in, using the <code>select()</code> function from the
<code>dplyr</code> package:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">year_country_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 3
   year country     gdpPercap
  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1  1952 Afghanistan      779.
2  1957 Afghanistan      821.
3  1962 Afghanistan      853.
4  1967 Afghanistan      836.
5  1972 Afghanistan      740.
6  1977 Afghanistan      786.</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="pipe">Pipe<a class="anchor" aria-label="anchor" href="#pipe"></a>
</h2>
<p>Now, this is not the most common notation when working with
<code>dplyr</code> package. <code>dplyr</code> offers an operator
<code>%&gt;%</code> called a pipe, which allows you build up very
complicated commands in a readable way.</p>
<p>In newer installation of <code>R</code> you can also find a notation
<code>|&gt;</code> . This pipe works in a similar way. The main
difference is that you don’t need to load any packages to have it
available.</p>
<p>The <code>select()</code> statement with pipe would look like
that:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>,<span class="va">country</span>,<span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">year_country_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 3
   year country     gdpPercap
  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1  1952 Afghanistan      779.
2  1957 Afghanistan      821.
3  1962 Afghanistan      853.
4  1967 Afghanistan      836.
5  1972 Afghanistan      740.
6  1977 Afghanistan      786.</code></pre>
</div>
<p>First we define data set, then - with the use of pipe we pass it on
to the <code>select()</code> function. This way we can chain multiple
functions together, which we will be doing now.</p>
</div>
<div class="section level2">
<h2 id="filter">Filter<a class="anchor" aria-label="anchor" href="#filter"></a>
</h2>
<p>We already know how to select only the needed columns. But now, we
also want to filter the rows of our data set via certain conditions with
<code>filter()</code> function. Instead of doing it in separate steps,
we can do it all together.</p>
<p>In the <code>gapminder</code> data set, we want to see the results
from outside of Europe for the 21st century.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_euro</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Europe"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># &amp; operator (AND) - both conditions must be met</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">year_country_gdp_euro</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 3
   year country     gdpPercap
  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1  2002 Afghanistan      727.
2  2007 Afghanistan      975.
3  2002 Algeria         5288.
4  2007 Algeria         6223.
5  2002 Angola          2773.
6  2007 Angola          4797.</code></pre>
</div>
<div class="section level3">
<h3 id="exercise-1">Exercise 1<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<div class="alert alert-info">
<p><strong>Challenge</strong> Write a single command (which can span
multiple lines and includes pipes) that will produce a data frame that
has the values for life expectancy, country and year, only for Eurasia.
How many rows does your data frame have and why?</p>
<p><strong>Solution</strong></p>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R BG-INFO<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_eurasia</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span> <span class="op">|</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># | operator (OR) - one of the conditions must be met</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">year_country_gdp_eurasia</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 756</code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="group-and-summarize">Group and summarize<a class="anchor" aria-label="anchor" href="#group-and-summarize"></a>
</h2>
<p>So far, we have provided summary statistics on the whole dataset,
selected columns, and filtered the observations. But often instead of
doing that, we would like to know statistics about all of the
continents, presented by group.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="co"># select the dataset</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># group by continent</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="co"># summarize function creates statistics for the data set </span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
  continent avg_gdpPercap
  &lt;chr&gt;             &lt;dbl&gt;
1 Africa            2194.
2 Americas          7136.
3 Asia              7902.
4 Europe           14469.
5 Oceania          18622.</code></pre>
</div>
<div class="section level3">
<h3 id="exercise-2">Exercise 2<a class="anchor" aria-label="anchor" href="#exercise-2"></a>
</h3>
<div class="alert alert-info">
<p><strong>Challenge</strong> Calculate the average life expectancy per
country. Which country has the longest average life expectancy and which
has the shortest average life expectancy?</p>
<p><strong>Hint</strong> Use <code>max()</code> and <code>min()</code>
functions to find minimum and maximum.</p>
<p><strong>Solution</strong></p>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R BG-INFO<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>avg_lifeExp<span class="op">=</span><span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">avg_lifeExp</span> <span class="op">==</span> <span class="fu">min</span><span class="op">(</span><span class="va">avg_lifeExp</span><span class="op">)</span> <span class="op">|</span> <span class="va">avg_lifeExp</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">avg_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  country      avg_lifeExp
  &lt;chr&gt;              &lt;dbl&gt;
1 Iceland             76.5
2 Sierra Leone        36.8</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="multiple-groups-and-summary-variables">Multiple groups and summary variables<a class="anchor" aria-label="anchor" href="#multiple-groups-and-summary-variables"></a>
</h3>
<p>You can also group by multiple columns:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 60 × 3
# Groups:   continent [5]
   continent  year avg_gdpPercap
   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 Africa     1952         1253.
 2 Africa     1957         1385.
 3 Africa     1962         1598.
 4 Africa     1967         2050.
 5 Africa     1972         2340.
 6 Africa     1977         2586.
 7 Africa     1982         2482.
 8 Africa     1987         2283.
 9 Africa     1992         2282.
10 Africa     1997         2379.
# ℹ 50 more rows</code></pre>
</div>
<p>On top of this, you can also make multiple summaries of those
groups:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>,<span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    avg_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>    sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>    avg_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    n_obs <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="frequencies">Frequencies<a class="anchor" aria-label="anchor" href="#frequencies"></a>
</h2>
<p>If you need only a number of observations per group, you can use the
<code>count()</code> function</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
# Groups:   continent [5]
  continent     n
  &lt;chr&gt;     &lt;int&gt;
1 Africa      624
2 Americas    300
3 Asia        396
4 Europe      360
5 Oceania      24</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="mutate">Mutate<a class="anchor" aria-label="anchor" href="#mutate"></a>
</h2>
<p>Frequently you’ll want to create new columns based on the values in
existing columns. For example, instead of only having the GDP per
capita, we might want to create a new GDP variable and convert its units
into Billions. For this, we’ll use <code>mutate()</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>gdpBillion <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">*</span><span class="va">pop</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 7
  country      year      pop continent lifeExp gdpPercap gdpBillion
  &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 Afghanistan  1952  8425333 Asia         28.8      779.       6.57
2 Afghanistan  1957  9240934 Asia         30.3      821.       7.59
3 Afghanistan  1962 10267083 Asia         32.0      853.       8.76
4 Afghanistan  1967 11537966 Asia         34.0      836.       9.65
5 Afghanistan  1972 13079460 Asia         36.1      740.       9.68
6 Afghanistan  1977 14880372 Asia         38.4      786.      11.7 </code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>We can use the <code>select()</code> and <code>filter()</code>
functions to select certain columns in a data frame and to subset it
based a specific conditions.</li>
<li>With <code>mutate()</code>, we can create new columns in a data
frame with values based on existing columns.</li>
<li>By combining <code>group_by()</code> and <code>summarize()</code> in
a pipe (<code>%&gt;%</code>) chain, we can generate summary statistics
for each group in a data frame.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div></section><section id="aio-04-intro-to-visualisation"><p>Content from <a href="04-intro-to-visualisation.html">Introduction to visualisation</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/04-intro-to-visualisation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create a basic plot in R?</li>
<li>How can I add features to a plot?</li>
<li>How can I get basic summary information about my data set?</li>
<li>How can I include addition information via a colours palette.</li>
<li>How can I find more information about a function and its
arguments?</li>
<li>How can I create new columns or remove existing columns from a data
frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Generate plots to visualise data with <code>ggplot2</code>.</li>
<li>Add plot layers to incrementally build a more complex plot.</li>
<li>Use the <code>fill</code> argument for colouring surfaces, and
modify colours with the viridis or scale_manual packages.</li>
<li>Explore the help documentation.</li>
<li>Save and format your plot via the <code>ggsave()</code>
function.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="introduction-to-visualisation">
<a href="https://datacarpentry.org/r-intro-geospatial/07-plot-ggplot2/index.html" class="external-link">Introduction
to Visualisation</a><a class="anchor" aria-label="anchor" href="#introduction-to-visualisation"></a>
</h1>
<p>The package <code>ggplot2</code> is a powerful plotting system. We
will start with an introduction of key features of <code>ggplot2</code>.
In the following parts of this workshop, you will use this package to
visualize geospatial data. <code>gg</code> stands for grammar of
graphics, the idea that three components are needed to create a
graph:</p>
<ul>
<li>data,</li>
<li>aesthetics - a coordinate system on which we map the data (what is
represented on x axis, what on y axis), and</li>
<li>geometries - visual representation of the data (points, bars,
etc.)</li>
</ul>
<p>Fun part about <code>ggplot2</code> is that you can add layers to the
plot to provide more information and to make it more beautiful.</p>
<p>First, lets plot the distribution of life expectancy in the
<code>gapminder</code> dataset:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>,  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span> <span class="co"># aesthetics layer </span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="co"># geometry layer</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>You can see that in <code>ggplot</code> you use <code>+</code> as a
pipe, to add layers. Within the <code>ggplot()</code> call, it is the
only pipe that will work. But, it is possible to chain operations on a
data set with a pipe that we have already learned: <code>%&gt;%</code> (
or <code>|&gt;</code>) and follow them by ggplot syntax.</p>
<p>Let’s create another plot, this time only on a subset of
observations:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span>  <span class="co"># we select a data set</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span> </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># and filter it to keep only one year and one continent</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># the x and y axes represent values of columns</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span>  <span class="co"># we select a column graph as a geometry</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-col-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now, you can iteratively improve how the plot looks like. For
example, you might want to flip it, to better display the labels.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span>  <span class="co"># flip axes</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-coord-flip-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>One thing you might want to change here is the order in which
countries are displayed. It would be easier to compare GDP per capita,
if they were showed in order. To do that, we need to reorder factor
levels (you remember, we’ve already done this before).</p>
<p>Now the order of the levels will depend on another variable - GDP per
capita.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span> <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># reorder factor levels</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span> , y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-color-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Let’s make things more colourful - let’s represent the average life
expectancy of a country by colour</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span> <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, fill <span class="op">=</span> <span class="va">lifeExp</span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># fill argument for colouring surfaces, colour for points and lines</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can also adapt the colour scale. Common choice that is used for
its readability and colorblind-proofness are the palettes available in
the <code>viridis</code> package.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span> <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, fill <span class="op">=</span> <span class="va">lifeExp</span>   <span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span>  <span class="co"># _c stands for continuous scale</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-colors-adapt-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Maybe we don’t need that much information about the life expectancy.
We only want to know if it’s below or above average. We will make use of
the <code>if_else()</code> function inside <code>mutate()</code> to
create a new column <code>lifeExpCat</code> with the value
<code>high</code> if life expectancy is above average and
<code>low</code> otherwise. Note the usage of the <code>if_else()</code>
function:
<code>if_else(&lt;condition&gt;, &lt;value if TRUE&gt;, &lt;value if FALSE&gt;)</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span>  <span class="co"># this time let's save the plot in an object</span></span>
<span>  <span class="va">gapminder</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span> </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span> <span class="op">)</span>,</span>
<span>         lifeExpCat <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="st">'high'</span>, <span class="st">'low'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, fill <span class="op">=</span> <span class="va">lifeExpCat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'light blue'</span>, <span class="st">'orange'</span><span class="op">)</span><span class="op">)</span>  <span class="co"># customize the colours of the fill aesthetic</span></span></code></pre>
</div>
<p>Since we saved a plot as an object, nothing has been printed out.
Just like with any other object in <code>R</code>, if you want to see
it, you need to call it.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-call-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now we can make use of the saved object and add things to it.</p>
<p>Let’s also give it a title and name the axes:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'GDP per capita in Americas'</span>, subtitle <span class="op">=</span> <span class="st">'Year 2007'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">'Country'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">'GDP per capita'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre>
</div>
<figure><img src="fig/04-intro-to-visualisation-rendered-ggplot-titles-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div class="section level1">
<h1 id="writing-data">
<a href="https://datacarpentry.org/r-intro-geospatial/08-writing-data/index.html" class="external-link">Writing
data</a><a class="anchor" aria-label="anchor" href="#writing-data"></a>
</h1>
<div class="section level2">
<h2 id="saving-the-plot">Saving the plot<a class="anchor" aria-label="anchor" href="#saving-the-plot"></a>
</h2>
<p>Once we are happy with our plot we can save it in a format of our
choice. Remember to save it in the dedicated folder.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">p</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">'fig_output'</span>,<span class="st">'plot_americas_2007.pdf'</span><span class="op">)</span><span class="op">)</span>  <span class="co"># By default, ggsave() saves the last displayed plot, but you can also explicitly name the plot you want to save</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in grDevices::pdf(file = filename, ..., version = version): cannot open file '/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/fig_output/plot_americas_2007.pdf'</code></pre>
</div>
<div class="section level3">
<h3 id="using-help-documentation">Using help documentation<a class="anchor" aria-label="anchor" href="#using-help-documentation"></a>
</h3>
<p>My saved plot is not very readable. We can see why it happened by
exploring the help documentation. We can do that by writing directly in
the console:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">ggsave</span></span></code></pre>
</div>
<p>We can read that it uses the “size of the current graphics device”.
That would explain why our saved plots look slightly different. Feel
free to explore the documentation to see how to adapt the size e.g. by
adapting <code>width</code>, <code>height</code> and <code>units</code>
parameter.</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-the-data">Saving the data<a class="anchor" aria-label="anchor" href="#saving-the-data"></a>
</h2>
<p>Another output of your work you want to save is a cleaned data set.
In your analysis, you can then load directly that data set. Let’s say we
want to save the data only for Americas:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_amr_2007</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">'Americas'</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country_reordered <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span> <span class="op">)</span>, </span>
<span>         lifeExpCat <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="st">'high'</span>, <span class="st">'low'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write.csv</span><span class="op">(</span><span class="va">gapminder_amr_2007</span>, <span class="fu">here</span><span class="op">(</span><span class="st">'data_output'</span>, <span class="st">'gapminder_americas_2007.csv'</span><span class="op">)</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in file(file, ifelse(append, "a", "w")): cannot open the connection</code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>With <code>ggplot2</code>, we use the <code>+</code> operator to
combine plot layers and incrementally build a more complex plot.</li>
<li>In the aesthetics (<code>aes()</code>), we can assign variables to
the x and y axes and use the <code>fill</code> argument for colouring
surfaces.</li>
<li>With <code>scale_fill_viridis_c()</code> and
<code>scale_fill_manual()</code> we can assign new colours to our
plot.</li>
<li>To open the help documentation for a function, we run the name of
the function preceded by the <code>?</code> sign.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div></section><section id="aio-08-intro-to-geospatial-concepts"><p>Content from <a href="08-intro-to-geospatial-concepts.html">Introduction to Geospatial Concepts</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/08-intro-to-geospatial-concepts.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you describe the location of a geographic feature on the
surface of the earth?</li>
<li>How do you describe different types of projections?</li>
<li>How do you decide on what CRS to use?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Identify the CRS and projection that is best fit for a specific
analytical question.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="the-shape-of-the-earth"><h2 class="section-heading">The shape of the Earth<a class="anchor" aria-label="anchor" href="#the-shape-of-the-earth"></a>
</h2>
<hr class="half-width">
<p>The shape of the Earth is approximately a sphere which is slightly
wider than it is tall, and which is called <strong>ellipsoid</strong>.
The true shape of the Earth is an irregular ellipsoid, the so-called
<strong>geoid</strong>, as illustrated in the image below.</p>
<figure style="text-align: center"><img src="https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/_ImagesModules/_selfstudy/S06_images/S06_03_a00.jpg" alt="The shape of the Earth. Source: United Nations Statistics Division and International Cartographic Association (2012a)." class="figure mx-auto d-block"><figcaption>
The shape of the Earth. Source: United Nations Statistics Division and
International Cartographic Association (2012a).
</figcaption></figure><p>The most common and basic representation of the position of points on
the Earth is the combination of the <strong>geographical latitude and
longitude</strong>, as shown below.</p>
<figure style="text-align: center"><img src="fig/latlon.png" alt="Geographical latitude and longitude. Source: van der Marel (2014)." class="figure mx-auto d-block"><figcaption>
Geographical latitude and longitude. Source: van der Marel (2014).
</figcaption></figure><p><strong>Meridians</strong> are <strong>vertical</strong> circles with
constant longitude, called <strong><strong>great
circles</strong></strong>, which run from the North Pole to the South
Pole. <strong>Parallels</strong> are <strong>horizontal</strong> circles
with constant latitude, which are called <strong><strong>small
circles</strong></strong>. Only the equator (the largest parallel) is
also a great circle.</p>
<p>The black lines in the figure above show the equator and the prime
meridian running through Greenwich, with latitude and longitude labels.
The red dotted lines show the meridian and parallel running through
Karachi, Pakistan (25°45’N, 67°01’E).</p>
</section><section id="map-projection"><h2 class="section-heading">Map projection<a class="anchor" aria-label="anchor" href="#map-projection"></a>
</h2>
<hr class="half-width">
<p><strong>Map projection</strong> is a systematic transformation of the
latitudes and longitudes of locations on the surface of an ellipsoid
into locations on a plane. It is a transformation of the
three-dimensional Earth’s surface into its two-dimensional
representation on a sheet of paper or computer screen (see the image
below for a comparison with flattening an orange peel).</p>
<figure style="text-align: center"><img src="https://datacarpentry.org/organization-geospatial/fig/orange-peel-earth.jpg" alt="Map projection represented as flattening an orange peel. Source: Data Carpentry (2023)." class="figure mx-auto d-block"><figcaption>
Map projection represented as flattening an orange peel. Source: Data
Carpentry (2023).
</figcaption></figure><p>Many different map projections are in use for different purposes.
Generally, they can be categorised into the following groups:
cylindrical, conic, and azimuthal (see <span class="citation">@fig-projections</span>).</p>
<figure style="text-align: center"><img src="https://kartoweb.itc.nl/geometrics/Bitmaps/Intro%201.9a.gif" alt="Cylindrical, conic, and azimuthal map projections. Source: Knippers (2009)." class="figure mx-auto d-block"><figcaption>
Cylindrical, conic, and azimuthal map projections. Source: Knippers
(2009).
</figcaption></figure><p>Each map projection introduces a <strong>distortion</strong> in
geometrical elements – <strong>distance</strong>,
<strong>angle</strong>, and <strong>area</strong>. Depending on which of
these geometrical elements are more relevant for a specific map, we can
choose an appropriate map projection. <strong>Conformal
projections</strong> are the best for preserving angles between any two
curves; <strong>equal area (equivalent) projections</strong> preserve
the area or scale; <strong>equal distance (conventional)
projections</strong> are the best for preserving distances.</p>
</section><section id="coordinate-reference-systems-crs"><h2 class="section-heading">Coordinate reference systems (CRS)<a class="anchor" aria-label="anchor" href="#coordinate-reference-systems-crs"></a>
</h2>
<hr class="half-width">
<p>A <strong>coordinate reference system (CRS)</strong> is a
coordinate-based local, regional or global system for locating
geographical entities, which uses a specific map projection. It defines
how the two-dimensional, projected map relates to real places on the
Earth.</p>
<p>All coordinate reference systems are included in a public registry
called the <strong>EPSG Geodetic Parameter Dataset (EPSG
registry)</strong>, initiated in 1985 by a member of the European
Petroleum Survey Group (EPSG). Each CRS has a unique <strong>EPSG
code</strong>, which makes it possible to easily identify them among the
large number of CRS. This is particularly important for transforming
spatial data from one CRS to another.</p>
<p>Some of the most commonly used CRS in the Netherlands are the
following:</p>
<ul>
<li>
<strong>World Geodetic System 1984 (WGS84)</strong> is the best
known global reference system (EPSG:4326).</li>
<li>
<strong>European Terrestrial Reference System 1989 (ETRS89)</strong>
is the standard coordinate system for Europe (EPSG:4258).</li>
<li>The most popular projected CRS in the Netherlands is ‘Stelsel van de
Rijksdriehoeksmeting (RD)’ registered in EPSG as <strong>Amersfoort / RD
New (EPSG:28992)</strong>.</li>
</ul>
<p>The main parameters of each CRS are the following:</p>
<ul>
<li>
<strong>Datum</strong> is a model of the shape of the Earth, which
specifies how a coordinate system is linked to the Earth, e.g. how to
define the origin of the coordinate axis – where (0,0) is. It has
angular units (degrees).</li>
<li>
<strong>Projection</strong> is mathematical transformation of the
angular measurements on the Earth to linear units (e.g. meters) on a
flat surface (paper or a computer screen).</li>
<li>
<strong>Additional parameters</strong>, such as a definition of the
centre of the map, are often necessary to create the full CRS.</li>
</ul>
<p>In this workshop, we use two CRS shown in <span class="citation">@tbl-crs</span>.</p>
<table class="table">
<caption>Main properties of WGS 84 and Amersfoort / RD New coordinate
reference systems {#tbl-crs}</caption>
<colgroup>
<col width="23%">
<col width="38%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>WGS 84 (EPSG:4326)</th>
<th>Amersfoort / RD New (EPSG:28992)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Units</td>
<td>degrees</td>
<td>meters</td>
</tr>
<tr class="even">
<td>Projection</td>
<td>Geographic (uses latitude and longitude for coordinates)</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>Dynamic (relies on a datum which is not plate-fixed)</td>
<td>Static (relies on a datum which is plate-fixed)</td>
</tr>
<tr class="even">
<td>Celestial body</td>
<td>Earth</td>
<td></td>
</tr>
<tr class="odd">
<td>Datum</td>
<td>World Geodetic System 1984 ensemble</td>
<td>Amersfoort</td>
</tr>
<tr class="even">
<td>Method</td>
<td>Lat/long (Geodetic alias)</td>
<td>Oblique Stereographic Alternative</td>
</tr>
<tr class="odd">
<td>Prime meridian</td>
<td>Greenwich</td>
<td></td>
</tr>
<tr class="even">
<td>Ellipsoid</td>
<td></td>
<td>Bessel 1841</td>
</tr>
</tbody>
</table>
<p>The figure below shows the same city (Rotterdam) in these two
CRS.</p>
<figure style="text-align: center"><img src="fig/rotterdam-crs.png" alt="Rotterdam in two different CRS" class="figure mx-auto d-block"><figcaption>
Rotterdam in two different CRS
</figcaption></figure><p>In addition to using different CRS, these two maps of Rotterdam also
have different scales.</p>
</section><section id="map-scale"><h2 class="section-heading">Map scale<a class="anchor" aria-label="anchor" href="#map-scale"></a>
</h2>
<hr class="half-width">
<p><strong>Map scale</strong> measures the ratio between distance on a
map and the corresponding distance on the ground. For example, on a
1:100 000 scale map, 1cm on the map equals 1km (100 000 cm) on the
ground. Map scale can be expressed in the following three ways:</p>
<table class="table"><tbody>
<tr class="odd">
<td>Verbal:</td>
<td>1 centimetre represents 250 meters</td>
</tr>
<tr class="even">
<td>Fraction:</td>
<td>1:25000</td>
</tr>
<tr class="odd">
<td>Graphic:</td>
<td><img src="fig/scalebar.png" style="width:75.0%" class="figure"></td>
</tr>
</tbody></table>
<div id="challenge-crs-for-calculating-areas" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-crs-for-calculating-areas" class="callout-inner">
<h3 class="callout-title">Challenge: CRS for calculating areas<a class="anchor" aria-label="anchor" href="#challenge-crs-for-calculating-areas"></a>
</h3>
<div class="callout-content">
<p>You want to investigate which European country has the largest urban
area. Which CRS will you use?</p>
<ol style="list-style-type: lower-alpha">
<li>EPSG:4326</li>
<li>EPSG:28992</li>
<li>EPSG:3035</li>
</ol>
<p>Hint: Go to <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> or <a href="https://epsg.org/search/by-name" class="external-link uri">https://epsg.org/search/by-name</a> and check properties of
the given CRS, such as datum, type of map projection, units of measure
etc.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Correct answer: c. EPSG:3035</p>
</div>
</div>
</div>
</div>
<div id="challenge-crs-for-calculating-shortest-paths" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-crs-for-calculating-shortest-paths" class="callout-inner">
<h3 class="callout-title">Challenge: CRS for calculating shortest
paths<a class="anchor" aria-label="anchor" href="#challenge-crs-for-calculating-shortest-paths"></a>
</h3>
<div class="callout-content">
<p>You want to calculate the shortest path between two buildings in
Delft. Which CRS will you use?</p>
<ol style="list-style-type: lower-alpha">
<li>EPSG:4326</li>
<li>EPSG:28992</li>
<li>EPSG:3035</li>
</ol>
<p>Hint: Go to <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> or <a href="https://epsg.org/search/by-name" class="external-link uri">https://epsg.org/search/by-name</a> and check properties of
the given CRS, such as datum, type of map projection, units of measure
etc.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Correct answer: c. EPSG:28992</p>
</div>
</div>
</div>
</div>
</section><section id="references"><h2 class="section-heading">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<hr class="half-width">
<ul>
<li><p>Knippers, R. (2009): Geometric aspects of mapping. International
Institute for Geo-Information Science and Earth Observation (ITC),
Enschede. <a href="https://kartoweb.itc.nl/geometrics/" class="external-link uri">https://kartoweb.itc.nl/geometrics/</a> (Accessed
22-01-2024)</p></li>
<li><p>United Nations Statistics Division and International Cartographic
Association (2012): 3. Plane rectangular coordinate systems – A) The
ellipsoid / geoid. <a href="https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/_HtmlModules/_Selfstudy/S06/S06_03a.html" class="external-link uri">https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/_HtmlModules/_Selfstudy/S06/S06_03a.html</a>
(Accessed 22-01-2024)</p></li>
<li><p>Van der Marel, H. (2014). Reference systems for surveying and
mapping. Lecture notes. Faculty of Civil Engineering and Geosciences,
Delft University of Technology, Delft, The Netherlands. <a href="https://gnss1.tudelft.nl/pub/vdmarel/reader/CTB3310_RefSystems_1-2a_print.pdf" class="external-link uri">https://gnss1.tudelft.nl/pub/vdmarel/reader/CTB3310_RefSystems_1-2a_print.pdf</a>
(Accessed 22-01-2024)</p></li>
</ul>
<div id="useful-resources" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="useful-resources" class="callout-inner">
<h3 class="callout-title">Useful resources<a class="anchor" aria-label="anchor" href="#useful-resources"></a>
</h3>
<div class="callout-content">
<ul>
<li><p>Campbell, J., Shin, M. E. (2011). Essentials of Geographic
Information Systems. Textbooks. 2. <a href="https://digitalcommons.liberty.edu/textbooks/2" class="external-link uri">https://digitalcommons.liberty.edu/textbooks/2</a> (Accessed
22-01-2024)</p></li>
<li><p>Data Carpentry (2023): Introduction to Geospatial Concepts.
Coordinate Reference Systems. <a href="https://datacarpentry.org/organization-geospatial/03-crs.html" class="external-link uri">https://datacarpentry.org/organization-geospatial/03-crs.html</a>
(Accessed 22-01-2024)</p></li>
<li><p>GeoRepository (2024): EPSG Geodetic Parameter Dataset <a href="https://epsg.org/home.html" class="external-link uri">https://epsg.org/home.html</a> (Accessed
22-01-2024)</p></li>
<li><p>Klokan Technologies GmbH (2022) <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> (Accessed 22-01-2024)</p></li>
<li><p>United Nations Statistics Division and International Cartographic
Association (2012b): UNGEGN-ICA webcourse on Toponymy. <a href="https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/2012_Home.html" class="external-link uri">https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/2012_Home.html</a>
(Accessed 22-01-2024)</p></li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>…</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-09-open-and-plot-vector-layers"><p>Content from <a href="09-open-and-plot-vector-layers.html">Open and Plot Vector Layers</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/09-open-and-plot-vector-layers.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I read, examine and visualize point, line and polygon vector
data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Differentiate between point, line, and polygon vector data.</li>
<li>Load vector data into R.</li>
<li>Access the attributes of a vector object in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite<a class="anchor" aria-label="anchor" href="#prereq1"></a>
</h3>
<div class="callout-content">
<p>In this lesson you will work with the <code>sf</code> package. Note
that the <code>sf</code> package has some external dependencies, namely
GEOS, PROJ.4, GDAL and UDUNITS, which need to be installed beforehand.
Before starting the lesson, follow the workshop <a href="index.html#setup">setup instructions</a> for the installation of
<code>sf</code> and its dependencies.</p>
</div>
</div>
</div>
<p>First we need to load the packages we will use in this lesson. We
will use the <code>tidyverse</code> package with which you are already
familiar from the previous lesson. In addition, we need to load the <a href="https://r-spatial.github.io/sf/" class="external-link"><code>sf</code></a> package for
working with spatial vector data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>  <span class="co"># wrangle, reshape and visualize data</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span>         <span class="co"># work with spatial vector data</span></span></code></pre>
</div>
<div id="the-sf-package" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-sf-package" class="callout-inner">
<h3 class="callout-title">The<code>sf</code>package<a class="anchor" aria-label="anchor" href="#the-sf-package"></a>
</h3>
<div class="callout-content">
<p><code>sf</code> stands for Simple Features which is a standard
defined by the Open Geospatial Consortium for storing and accessing
geospatial vector data. PostGIS, for instance, uses the same standard,
so PostGIS users might recognise the functions used by the
<code>sf</code> package.</p>
</div>
</div>
</div>
<section id="import-shapefiles"><h2 class="section-heading">Import shapefiles<a class="anchor" aria-label="anchor" href="#import-shapefiles"></a>
</h2>
<hr class="half-width">
<p>Let’s start by opening a shapefile. Shapefiles are a common file
format to store spatial vector data used in GIS software. Note that a
shapefile consists of multiple files and it is important to keep them
all together in the same location. We will read a shapefile with the
administrative boundary of Delft with the function
<code>st_read()</code> from the <code>sf</code> package.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div id="all-sf-functions-start-with-st_" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="all-sf-functions-start-with-st_" class="callout-inner">
<h3 class="callout-title">All<code>sf</code>functions start with<code>st_</code><a class="anchor" aria-label="anchor" href="#all-sf-functions-start-with-st_"></a>
</h3>
<div class="callout-content">
<p>Note that all functions from the <code>sf</code> package start with
the standard prefix <code>st_</code> which stands for Spatial Type. This
is helpful in at least two ways:</p>
<ol style="list-style-type: decimal">
<li>it allows for easy autocompletion of function names in RStudio,
and</li>
<li>it makes the interaction with or translation to/from software using
the simple features standard like PostGIS easy.</li>
</ol>
</div>
</div>
</div>
</section><section id="spatial-metadata"><h2 class="section-heading">Spatial Metadata<a class="anchor" aria-label="anchor" href="#spatial-metadata"></a>
</h2>
<hr class="half-width">
<p>By default (with <code>quiet = FALSE</code>), the
<code>st_read()</code> function provides a message with a summary of
metadata about the file that was read in. To examine the metadata in
more detail, we can use other, more specialised, functions from the
<code>sf</code> package.</p>
<p>The <code>st_geometry_type()</code> function, for instance, gives us
information about the geometry type, which in this case is
<code>POLYGON</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POLYGON
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<p>The <code>st_crs()</code> function returns the coordinate reference
system (CRS) used by the shapefile, which in this case is
<code>WGS 84</code> and has the unique reference code
<code>EPSG: 4326</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
<div id="examining-the-output-of-st_crs" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="examining-the-output-of-st_crs" class="callout-inner">
<h3 class="callout-title">Examining the output of<code>st_crs()</code><a class="anchor" aria-label="anchor" href="#examining-the-output-of-st_crs"></a>
</h3>
<div class="callout-content">
<p>As the output of <code>st_crs()</code> can be long, you can use
<code>$Name</code> and <code>$epsg</code> after the <code>crs()</code>
call to extract the projection name and EPSG code respectively.</p>
</div>
</div>
</div>
<p>The <code>st_bbox()</code> function shows the extent of the layer. As
<code>WGS 84</code> is a <strong>geographic CRS</strong>, the extent of
the shapefile is displayed in degrees.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 4.320218 51.966316  4.407911 52.032599 </code></pre>
</div>
<p>We need a <strong>projected CRS</strong>, which in the case of the
Netherlands is typically the Amersfort / RD New projection. To reproject
our shapefile, we will use the <code>st_transform()</code> function. For
the <code>crs</code> argument we can use the EPSG code of the CRS we
want to use, which is <code>28992</code> for the
<code>Amersfort / RD New</code> projection. To check the EPSG code of
any CRS, we can check this website: <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a></p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">boundary_Delft</span>, <span class="fl">28992</span><span class="op">)</span></span>
<span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">Name</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Amersfoort / RD New"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<p>Notice that the bounding box is measured in meters after the
transformation.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 81743.00 442446.21  87703.78 449847.95 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">units_gdal</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "metre"</code></pre>
</div>
<p>We confirm the transformation by examining the reprojected
shapefile.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 81743 ymin: 442446.2 xmax: 87703.78 ymax: 449848
Projected CRS: Amersfoort / RD New
  osm_id                       geometry
1 324269 POLYGON ((87703.78 442651, ...</code></pre>
</div>
<div id="callout4" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout4"></a>
</h3>
<div class="callout-content">
<p>Read more about Coordinate Reference Systems <a href="https://datacarpentry.org/organization-geospatial/03-crs.html" class="external-link">here</a>.
We will also practice transformation between CRS in <a href="12-handling-spatial-projection-and-crs.html">Handling Spatial
Projection &amp; CRS</a>.</p>
</div>
</div>
</div>
</section><section id="plot-a-vector-layer"><h2 class="section-heading">Plot a vector layer<a class="anchor" aria-label="anchor" href="#plot-a-vector-layer"></a>
</h2>
<hr class="half-width">
<p>Now, let’s plot this shapefile. You are already familiar with the
<code>ggplot2</code> package from <a href="04-intro-to-visualisation.html">Introduction to Visualisation</a>.
<code>ggplot2</code> has special <code>geom_</code> functions for
spatial data. We will use the <code>geom_sf()</code> function for
<code>sf</code> data.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"cyan1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Delft Administrative Boundary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span>  <span class="co"># this is needed to display the axes in meters</span></span></code></pre>
</div>
<figure><img src="fig/09-open-and-plot-vector-layers-rendered-unnamed-chunk-8-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-import-line-and-point-vector-layers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-import-line-and-point-vector-layers" class="callout-inner">
<h3 class="callout-title">Challenge: Import line and point vector
layers<a class="anchor" aria-label="anchor" href="#challenge-import-line-and-point-vector-layers"></a>
</h3>
<div class="callout-content">
<p>Read in <code>delft-streets.shp</code> and
<code>delft-leisure.shp</code> and assign them to
<code>lines_Delft</code> and <code>points_Delft</code> respectively.
Answer the following questions:</p>
<ol style="list-style-type: decimal">
<li>What type of R spatial object is created when you import each
layer?</li>
<li>What is the CRS and extent for each object?</li>
<li>Do the files contain points, lines, or polygons?</li>
<li>How many features are in each file?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-streets.shp"</span><span class="op">)</span></span>
<span><span class="va">points_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-leisure.shp"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can check the type of type of geometry with the
<code>st_geometry_type()</code> function. <code>lines_Delft</code>
contains <code>"LINESTRING"</code> geometry and
<code>points_Delft</code> is made of <code>"POINT"</code>
geometries.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] LINESTRING
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">points_Delft</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POINT
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<p><code>lines_Delft</code> and <code>points_Delft</code> are in the
correct CRS.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">points_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<p>When looking at the bounding boxes with the <code>st_bbox()</code>
function, we see the spatial extent of the two objects in a projected
CRS using meters as units. <code>lines_Delft()</code> and
<code>points_Delft</code> have similar extents.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 81759.58 441223.13  89081.41 449845.81 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">points_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 81863.21 442621.15  87370.15 449345.08 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Metadata for vector layers include geometry type, CRS, and
extent.</li>
<li>Load spatial objects into R with the <code>st_read()</code>
function.</li>
<li>Spatial objects can be plotted directly with <code>ggplot2</code>
using the <code>geom_sf()</code> function. No need to convert to a data
frame.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-10-explore-and-plot-by-vector-layer-attributes"><p>Content from <a href="10-explore-and-plot-by-vector-layer-attributes.html">Explore and plot by vector layer attributes</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/10-explore-and-plot-by-vector-layer-attributes.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I examine the attributes of a vector layer?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li><p>Query attributes of a vector object.</p></li>
<li><p>Subset vector objects using specific attribute values.</p></li>
<li><p>Plot a vector feature, colored by unique attribute
values.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="query-vector-feature-metadata">Query Vector Feature Metadata<a class="anchor" aria-label="anchor" href="#query-vector-feature-metadata"></a>
</h1>
<p>Let’s have a look at the content of the loaded data, starting with
<code>lines_Delft</code>. In essence, an <code>"sf"</code> object is a
data.frame with a “sticky” geometry column and some extra metadata, like
the CRS, extent and geometry type we examined earlier.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 11244 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 81759.58 ymin: 441223.1 xmax: 89081.41 ymax: 449845.8
Projected CRS: Amersfoort / RD New
First 10 features:
    osm_id  highway                       geometry
1  4239535 cycleway LINESTRING (86399.68 448599...
2  4239536 cycleway LINESTRING (85493.66 448740...
3  4239537 cycleway LINESTRING (85493.66 448740...
4  4239620  footway LINESTRING (86299.01 448536...
5  4239621  footway LINESTRING (86307.35 448738...
6  4239674  footway LINESTRING (86299.01 448536...
7  4310407  service LINESTRING (84049.47 447778...
8  4310808    steps LINESTRING (84588.83 447828...
9  4348553  footway LINESTRING (84527.26 447861...
10 4348575  footway LINESTRING (84500.15 447255...</code></pre>
</div>
<p>This means that we can examine and manipulate them as data frames.
For instance, we can look at the number of variables (columns in a data
frame) with <code>ncol()</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>In the case of <code>point_Delft</code> those columns are
<code>"osm_id"</code>, <code>"highway"</code> and
<code>"geometry"</code>. We can check the names of the columns with the
base R function <code>names()</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "osm_id"   "highway"  "geometry"</code></pre>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>Note that in R the geometry is just another column and counts towards
the number returned by <code>ncol()</code>. This is different from GIS
software with graphical user interfaces, where the geometry is displayed
in a viewport not as a column in the attribute table.</p>
</div>
</div>
</div>
<p>We can also preview the content of the object by looking at the first
6 rows with the <code>head()</code> function, which in the case of an
<code>sf</code> object is similar to examining the object directly.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span> <span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 85107.1 ymin: 448400.3 xmax: 86399.68 ymax: 449076.2
Projected CRS: Amersfoort / RD New
   osm_id  highway                       geometry
1 4239535 cycleway LINESTRING (86399.68 448599...
2 4239536 cycleway LINESTRING (85493.66 448740...
3 4239537 cycleway LINESTRING (85493.66 448740...
4 4239620  footway LINESTRING (86299.01 448536...
5 4239621  footway LINESTRING (86307.35 448738...
6 4239674  footway LINESTRING (86299.01 448536...</code></pre>
</div>
<div class="section level2">
<h2 id="explore-values-within-one-attribute">Explore values within one attribute<a class="anchor" aria-label="anchor" href="#explore-values-within-one-attribute"></a>
</h2>
<p>Using the <code>$</code> operator, we can examine the content of a
single field of our lines feature.</p>
<p>We can see the contents of the <code>highway</code> field of our
lines feature:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway" "cycleway" "cycleway" "footway"  "footway"  "footway" 
 [7] "service"  "steps"    "footway"  "footway" </code></pre>
</div>
<p>To see only unique values within the <code>highway</code> field, we
can use the <code>unique()</code> function. This function extracts all
possible values of a character variable.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"         
 [5] "residential"    "unclassified"   "construction"   "secondary"     
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"      
[13] "track"          "motorway"       "path"           "pedestrian"    
[17] "primary"        "bridleway"      "trunk"          "tertiary_link" 
[21] "services"       "secondary_link" "trunk_link"     "primary_link"  
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>R is also able to handle categorical variables called factors. With
factors, we can use the <code>levels()</code> function to show unique
values. To examine unique values of the <code>highway</code> variable
this way, we have to first transform it into a factor with the
<code>factor()</code> function:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "bridleway"      "busway"         "construction"   "cycleway"      
 [5] "footway"        "living_street"  "motorway"       "motorway_link" 
 [9] "path"           "pedestrian"     "platform"       "primary"       
[13] "primary_link"   "proposed"       "residential"    "secondary"     
[17] "secondary_link" "service"        "services"       "steps"         
[21] "tertiary"       "tertiary_link"  "track"          "trunk"         
[25] "trunk_link"     "unclassified"  </code></pre>
</div>
<p>Note that this way the values are shown by default in alphabetical
order and <code>NA</code>s are not displayed, whereas using
<code>unique()</code> returns unique values in the order of their
occurrence in the data frame and it also shows <code>NA</code>
values.</p>
</div>
</div>
</div>
<div id="challenge-attributes-for-different-spatial-classes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-attributes-for-different-spatial-classes" class="callout-inner">
<h3 class="callout-title">Challenge: Attributes for different spatial
classes<a class="anchor" aria-label="anchor" href="#challenge-attributes-for-different-spatial-classes"></a>
</h3>
<div class="callout-content">
<!-- 3 minutes -->
<p>Explore the attributes associated with the <code>point_Delft</code>
spatial object.</p>
<ol style="list-style-type: decimal">
<li>How many attributes does it have?</li>
<li>What types of leisure points do the points represent? Give three
examples.</li>
<li>Which of the following is NOT an attribute of the
<code>point_Delft</code> data object?</li>
</ol>
<ol style="list-style-type: upper-alpha">
<li>location B) leisure C) osm_id</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To find the number of attributes, we use the <code>ncol()</code>
function:</li>
</ol>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>The types of leisure point are in the column named
<code>leisure</code>.</li>
</ol>
<p>Using the <code>head()</code> function which displays 6 rows by
default, we only see two values and <code>NA</code>s.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 83839.59 ymin: 443827.4 xmax: 84967.67 ymax: 447475.5
Projected CRS: Amersfoort / RD New
     osm_id      leisure                  geometry
1 472312297 picnic_table POINT (84144.72 443827.4)
2 480470725       marina POINT (84967.67 446120.1)
3 484697679         &lt;NA&gt; POINT (83912.28 447431.8)
4 484697682         &lt;NA&gt; POINT (83895.43 447420.4)
5 484697691         &lt;NA&gt;   POINT (83839.59 447455)
6 484697814         &lt;NA&gt; POINT (83892.53 447475.5)</code></pre>
</div>
<p>We can increase the number of rows with the n argument (e.g.,
<code>head(n = 10)</code> to show 10 rows) until we see at least three
distinct values in the leisure column. Note that printing an
<code>sf</code> object will also display the first 10 rows.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">point_Delft</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># you might be lucky to see three distinct values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 10 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 82485.72 ymin: 443827.4 xmax: 85385.25 ymax: 448341.3
Projected CRS: Amersfoort / RD New
       osm_id       leisure                  geometry
1   472312297  picnic_table POINT (84144.72 443827.4)
2   480470725        marina POINT (84967.67 446120.1)
3   484697679          &lt;NA&gt; POINT (83912.28 447431.8)
4   484697682          &lt;NA&gt; POINT (83895.43 447420.4)
5   484697691          &lt;NA&gt;   POINT (83839.59 447455)
6   484697814          &lt;NA&gt; POINT (83892.53 447475.5)
7   549139430        marina POINT (84479.99 446823.5)
8   603300994 sports_centre POINT (82485.72 445237.5)
9   883518959 sports_centre POINT (85385.25 448341.3)
10 1148515039    playground    POINT (84661.3 446818)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># point_Delft</span></span></code></pre>
</div>
<p>We have our answer (<code>sports_centre</code> is the third value),
but in general this is not a good approach as the first rows might still
have many <code>NA</code>s and three distinct values might still not be
present in the first <code>n</code> rows of the data frame. To remove
<code>NA</code>s, we can use the function <code>na.omit()</code> on the
leisure column to remove <code>NA</code>s completely. Note that we use
the <code>$</code> operator to examine the content of a single
variable.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">na.omit</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span><span class="op">)</span>  <span class="co"># this is better</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table"  "marina"        "marina"        "sports_centre"
[5] "sports_centre" "playground"   </code></pre>
</div>
<p>To show only unique values, we can use the <code>levels()</code>
function on a factor to only see the first occurrence of each distinct
value. Note <code>NA</code>s are dropped in this case and that we get
the first three of the unique alphabetically ordered values.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>   <span class="co"># this is even better</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "dance"       "dog_park"    "escape_game"</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>To see a list of all attribute names, we can use the
<code>names()</code> function.</li>
</ol>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "osm_id"   "leisure"  "geometry"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="subset-features">Subset features<a class="anchor" aria-label="anchor" href="#subset-features"></a>
</h2>
<p>We can use the <code>filter()</code> function to select a subset of
features from a spatial object, just like with data frames. Let’s select
only cycleways from our street data.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleway_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span></code></pre>
</div>
<p>Our subsetting operation reduces the number of features from 11244 to
1397.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 11244</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">cycleway_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1397</code></pre>
</div>
<p>This can be useful, for instance, to calculate the total length of
cycleways.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleway_Delft</span> <span class="op">&lt;-</span> <span class="va">cycleway_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cycleway_Delft</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 81759.58 ymin: 441227.3 xmax: 87326.76 ymax: 449834.5
Projected CRS: Amersfoort / RD New
  total_length                       geometry
1 115550.1 [m] MULTILINESTRING ((86399.68 ...</code></pre>
</div>
<p>Now we can plot only the cycleways.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cycleway_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Slow mobility network in Delft"</span>, subtitle <span class="op">=</span> <span class="st">"Cycleways"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-17-1.png" alt="Map of cycleways in Delft." class="figure mx-auto d-block"><figcaption>
Map of cycleways in Delft.
</figcaption></figure><div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<!-- 7 minutes -->
<p>Challenge: Now with motorways (and pedestrian streets)</p>
<ol style="list-style-type: decimal">
<li>Create a new object that only contains the motorways in Delft.</li>
<li>How many features does the new object have?</li>
<li>What is the total length of motorways?</li>
<li>Plot the motorways.</li>
<li>Extra: follow the same steps with pedestrian streets.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To create the new object, we first need to see which value of the
<code>highway</code> column holds motorways. There is a value called
<code>motorway</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"         
 [5] "residential"    "unclassified"   "construction"   "secondary"     
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"      
[13] "track"          "motorway"       "path"           "pedestrian"    
[17] "primary"        "bridleway"      "trunk"          "tertiary_link" 
[21] "services"       "secondary_link" "trunk_link"     "primary_link"  
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<p>We extract only the features with the value
<code>motorway</code>.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">motorway_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"motorway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">motorway_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 48 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 84501.66 ymin: 442458.2 xmax: 87401.87 ymax: 449205.9
Projected CRS: Amersfoort / RD New
First 10 features:
      osm_id  highway                       geometry
1    7531946 motorway LINESTRING (87395.68 442480...
2    7531976 motorway LINESTRING (87401.87 442467...
3   46212227 motorway LINESTRING (86103.56 446928...
4  120945066 motorway LINESTRING (85724.87 447473...
5  120945068 motorway LINESTRING (85710.31 447466...
6  126548650 motorway LINESTRING (86984.12 443630...
7  126548651 motorway LINESTRING (86714.75 444772...
8  126548653 motorway LINESTRING (86700.23 444769...
9  126548654 motorway LINESTRING (86716.35 444766...
10 126548655 motorway LINESTRING (84961.78 448566...</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>There are 48 features with the value <code>motorway</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">motorway_Delft_length</span> <span class="op">&lt;-</span> <span class="va">motorway_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>The total length of motorways is 14877.4361477941.</li>
</ol>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">motorway_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 48</code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Plot the motorways.</li>
</ol>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">motorway_Delft</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fast mobility network"</span>, subtitle <span class="op">=</span> <span class="st">"Motorways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-22-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><ol start="5" style="list-style-type: decimal">
<li>Follow the same steps with pedestrian streets.</li>
</ol>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pedestrian_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"pedestrian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pedestrian_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 82388.15 ymin: 444400.2 xmax: 85875.95 ymax: 447987.8
Projected CRS: Amersfoort / RD New
  total_length                       geometry
1 12778.84 [m] MULTILINESTRING ((85538.03 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">pedestrian_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 234</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pedestrian_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Slow mobility network"</span>, subtitle <span class="op">=</span> <span class="st">"Pedestrian"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-24-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="customize-plots">Customize plots<a class="anchor" aria-label="anchor" href="#customize-plots"></a>
</h2>
<p>Let’s say that we want to color different road types with different
colors and that we want to determine those colors.</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"         
 [5] "residential"    "unclassified"   "construction"   "secondary"     
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"      
[13] "track"          "motorway"       "path"           "pedestrian"    
[17] "primary"        "bridleway"      "trunk"          "tertiary_link" 
[21] "services"       "secondary_link" "trunk_link"     "primary_link"  
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<p>If we look at all the unique values of the highway field of our
street network we see more than 20 values. Let’s focus on a subset of
four values to illustrate the use of distinct colors. We use a piped
expression in which we only filter the rows of our data frame that have
one of the four given values <code>"motorway"</code>,
<code>"primary"</code>, <code>"secondary"</code>, and
<code>"cycleway"</code>. Note that we do this with the <code>%in</code>
operator which is a more compact equivalent of a series of conditions
joined by the <code>|</code> (or) operator. We also make sure that the
highway column is a factor column.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_types</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>, <span class="st">"cycleway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lines_Delft_selection</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">%in%</span> <span class="va">road_types</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>highway <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">highway</span>, levels <span class="op">=</span> <span class="va">road_types</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Next we define the four colors we want to use, one for each type of
road in our vector object. Note that in R you can use named colors like
<code>"blue"</code>, <code>"green"</code>, <code>"navy"</code>, and
<code>"purple"</code>. If you are using RStudio, you will see the named
colors previewed in line. A full list of named colors can be listed with
the <code>colors()</code> function.</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"navy"</span>, <span class="st">"purple"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can use the defined color palette in ggplot.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Road network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-28-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div class="section level2">
<h2 id="adjust-line-width">Adjust line width<a class="anchor" aria-label="anchor" href="#adjust-line-width"></a>
</h2>
<p>Earlier we adjusted the line width universally. We can also adjust
line widths for every factor level. Note that in this case the
<code>size</code> argument, like the <code>color</code> argument, are
within the <code>aes()</code> mapping function. This means that the
values of that visual property will be mapped from a variable of the
object that is being plotted.</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_widths</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span>, linewidth <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span>,</span>
<span>       linewidth <span class="op">=</span> <span class="st">'Road Type'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_widths</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-30-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-plot-line-width-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-line-width-by-attribute" class="callout-inner">
<h3 class="callout-title">Challenge: Plot line width by attribute<a class="anchor" aria-label="anchor" href="#challenge-plot-line-width-by-attribute"></a>
</h3>
<div class="callout-content">
<p>In the example above, we set the line widths to be 1, 0.75, 0.5, and
0.25. In our case line thicknesses are consistent with the hierarchy of
the selected road types, but in some cases we might want to show a
different hierarchy.</p>
<p>Let’s create another plot where we show the different line types with
the following thicknesses:</p>
<ul>
<li>motorways linewidth = 0.25</li>
<li>primary linewidth = 0.75</li>
<li>secondary linewidth = 0.5</li>
<li>cycleway linewidth = 1</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft_selection</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "motorway"  "primary"   "secondary" "cycleway" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_width</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_width</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways - Line width varies"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-33-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="add-plot-legend">Add plot legend<a class="anchor" aria-label="anchor" href="#add-plot-legend"></a>
</h2>
<p>Let’s add a legend to our plot. We will use the
<code>road_colors</code> object that we created above to color the
legend. We can customize the appearance of our legend by manually
setting different parameters.</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways - Default Legend"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-34-1.png" alt="Mobility network in Delft using thicker lines than the previous example." class="figure mx-auto d-block"><figcaption>
Mobility network in Delft using thicker lines than the previous example.
</figcaption></figure><div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>        legend.box.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
generated.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-35-1.png" alt="Map of the mobility network in Delft with large-font and border around the legend." class="figure mx-auto d-block"><figcaption>
Map of the mobility network in Delft with large-font and border around
the legend.
</figcaption></figure><div id="challenge-plot-lines-by-attributes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-lines-by-attributes" class="callout-inner">
<h3 class="callout-title">Challenge: Plot lines by attributes<a class="anchor" aria-label="anchor" href="#challenge-plot-lines-by-attributes"></a>
</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a plot that emphasizes only roads where bicycles are allowed.
To emphasize this, make the lines where bicycles are not allowed THINNER
than the roads where bicycles are allowed. Be sure to add a title and
legend to your map. You might consider a color palette that has all
bike-friendly roads displayed in a bright color. All other lines can be
black.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">lines_Delft_selection</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "factor"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "bridleway"      "busway"         "construction"   "cycleway"      
 [5] "footway"        "living_street"  "motorway"       "motorway_link" 
 [9] "path"           "pedestrian"     "platform"       "primary"       
[13] "primary_link"   "proposed"       "residential"    "secondary"     
[17] "secondary_link" "service"        "services"       "steps"         
[21] "tertiary"       "tertiary_link"  "track"          "trunk"         
[25] "trunk_link"     "unclassified"  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, create a data frame with only those roads where bicycles are allowed</span></span>
<span><span class="va">lines_Delft_bicycle</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Next, visualise using ggplot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_bicycle</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="st">"magenta"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network in Delft"</span>, subtitle <span class="op">=</span> <span class="st">"Roads dedicated to Bikes"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-38-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenge-plot-polygon-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-polygon-by-attribute" class="callout-inner">
<h3 class="callout-title">Challenge: Plot polygon by attribute<a class="anchor" aria-label="anchor" href="#challenge-plot-polygon-by-attribute"></a>
</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a map of the municipal boundaries in the Netherlands using the
data located in your data folder: <code>nl-gemeenten.shp</code>. Apply a
line color to each state using its region value. Add a legend.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">municipal_boundaries_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-gemeenten.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-gemeenten' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-gemeenten.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 344 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">municipal_boundaries_NL</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Classes 'sf' and 'data.frame':	344 obs. of  7 variables:
 $ identifica: chr  "GM0014" "GM0034" "GM0037" "GM0047" ...
 $ naam      : chr  "Groningen" "Almere" "Stadskanaal" "Veendam" ...
 $ code      : chr  "0014" "0034" "0037" "0047" ...
 $ ligtInProv: chr  "20" "24" "20" "20" ...
 $ ligtInPr_1: chr  "Groningen" "Flevoland" "Groningen" "Groningen" ...
 $ fuuid     : chr  "gemeentegebied.ee21436e-5a2d-4a8f-b2bf-113bddd028fc" "gemeentegebied.6e4378d7-0905-4dff-b351-57c1940c9c90" "gemeentegebied.515fbfe4-614e-463d-8b8c-91d35ca93b3b" "gemeentegebied.a3e71341-218c-44bf-ba12-01e2251ea2f6" ...
 $ geometry  :sfc_MULTIPOLYGON of length 344; first list element: List of 1
  ..$ :List of 1
  .. ..$ : num [1:4749, 1:2] 238742 238741 238740 238738 238735 ...
  ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA
  ..- attr(*, "names")= chr [1:6] "identifica" "naam" "code" "ligtInProv" ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">municipal_boundaries_NL</span><span class="op">$</span><span class="va">ligtInPr_1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Drenthe"       "Flevoland"     "Fryslân"       "Gelderland"   
 [5] "Groningen"     "Limburg"       "Noord-Brabant" "Noord-Holland"
 [9] "Overijssel"    "Utrecht"       "Zeeland"       "Zuid-Holland" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundaries_NL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">ligtInPr_1</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-41-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li><p>Spatial objects in <code>sf</code> are similar to standard data
frames and can be manipulated using the same functions.</p></li>
<li><p>Almost any feature of a plot can be customized using the various
functions and options in the <code>ggplot2</code> package.</p></li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div></section><section id="aio-11-plot-multiple-shape-files"><p>Content from <a href="11-plot-multiple-shape-files.html">Plot multiple shapefiles</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/11-plot-multiple-shape-files.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create map compositions with custom legends using
ggplot?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Plot multiple vector layers in the same plot.</li>
<li>Apply custom symbols to spatial objects in a plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode builds upon the <a href="10-explore-and-plot-by-vector-layer-attributes.html">previous
episode</a> to work with vector layers in R and explore how to plot
multiple vector layers.</p>
<section id="load-the-data"><h2 class="section-heading">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>To work with vector data in R, we use the <code>sf</code> library.
Make sure that it is loaded.</p>
<p>We will continue to work with the three ESRI shapefiles that we
loaded in the <a href="09-open-and-plot-vector-layers.html">Open and
Plot Vector Layers</a> episode.</p>
</section><section id="plotting-multiple-vector-layers"><h2 class="section-heading">Plotting Multiple Vector Layers<a class="anchor" aria-label="anchor" href="#plotting-multiple-vector-layers"></a>
</h2>
<hr class="half-width">
<p>So far we learned how to plot information from a single shapefile and
do some plot customization. What if we want to create a more complex
plot with many shapefiles and unique symbols that need to be represented
clearly in a legend?</p>
<p>We will create a plot that combines our leisure locations
(<code>point_Delft</code>), municipal boundary
(<code>boundary_Delft</code>) and streets (<code>lines_Delft</code>)
spatial objects. We will need to build a custom legend as well.</p>
<p>To begin, we will create a plot with the site boundary as the first
layer. Then layer the leisure locations and street data on top using
<code>+</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Next, let’s build a custom legend using the functions
<code>scale_color_manual()</code> and
<code>scale_fill_manual()</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leisure_colors</span> <span class="op">&lt;-</span> <span class="fu">rainbow</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span>, name <span class="op">=</span> <span class="st">"Road Type"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">leisure_colors</span>, name <span class="op">=</span> <span class="st">"Lesiure Location"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network and leisure in Delft"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">22</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span>, name <span class="op">=</span> <span class="st">"Line Type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">leisure_colors</span>, name <span class="op">=</span> <span class="st">"Leisure Location"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network and leisure in Delft"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We notice that there are quite some playgrounds in the residential
parts of Delft, whereas on campus there is a concentration of picnic
tables. So that is what our next challenge is about.</p>
<div id="challenge-visualising-multiple-layers-with-a-custom-legend" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-visualising-multiple-layers-with-a-custom-legend" class="callout-inner">
<h3 class="callout-title">Challenge: Visualising multiple layers with a
custom legend<a class="anchor" aria-label="anchor" href="#challenge-visualising-multiple-layers-with-a-custom-legend"></a>
</h3>
<div class="callout-content">
<p>Create a map of leisure locations only including
<code>playground</code> and <code>picnic_table</code>, with each point
colored by the leisure type. Overlay this layer on top of the
<code>lines_Delft</code> layer (the streets). Create a custom legend
that applies line symbols to lines and point symbols to the points.</p>
<p>Modify the plot above. Tell R to plot each point, using a different
symbol of shape value.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leisure_locations_selection</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-leisure.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">leisure</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"playground"</span>, <span class="st">"picnic_table"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-leisure' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-leisure.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 298 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 81863.21 ymin: 442621.1 xmax: 87370.15 ymax: 449345.1
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">leisure_locations_selection</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table" "playground"  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blue_orange</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="st">"darkorange"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">leisure_locations_selection</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, </span>
<span>          shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Type"</span>, values <span class="op">=</span> <span class="va">road_colors</span>,</span>
<span>     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"solid"</span>, shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Soil Type"</span>, values <span class="op">=</span> <span class="va">blue_orange</span>,</span>
<span>     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"blank"</span>, shape <span class="op">=</span> <span class="fl">21</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Traffic and leisure"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">leisure_locations_selection</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span>, shape <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Leisure Type"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Type"</span>, values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Leisure Type"</span>, values <span class="op">=</span> <span class="fu">rainbow</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"blank"</span>, shape <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span>,</span>
<span>     color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Road network and leisure"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-8-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>+</code> operator to add multiple layers to a
ggplot.</li>
<li>A plot can be a combination of multiple vector layers.</li>
<li>Use the <code>scale_color_manual()</code> and
<code>scale_fill_manual()</code> functions to set legend colors.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-12-handling-spatial-projection-and-crs"><p>Content from <a href="12-handling-spatial-projection-and-crs.html">Handling Spatial Projections &amp; CRS</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/12-handling-spatial-projection-and-crs.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What do I do when vector data don’t line up?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Plot vector objects with different CRSs in the same plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="working-with-spatial-data-from-different-sources"><h2 class="section-heading">Working with spatial data from different sources<a class="anchor" aria-label="anchor" href="#working-with-spatial-data-from-different-sources"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">municipal_boundary_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-gemeenten.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-gemeenten' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-gemeenten.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 344 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can add a country boundary layer to make it look nicer. If we
specify a thicker line width using size = 2 for the country boundary
layer, it will make our map pop!</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_boundary_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-boundary' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-boundary.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_NL</span>, color <span class="op">=</span> <span class="st">"gray18"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span>, color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># st_crs(point_Delft)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">municipal_boundary_NL</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">country_boundary_NL</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-boundary' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-boundary.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 4.320218 ymin: 51.96632 xmax: 4.407911 ymax: 52.0326
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4326</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">boundary_Delft</span>, <span class="fl">28992</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_NL</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span>, color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, color <span class="op">=</span> <span class="st">"purple"</span>, fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-plot-multiple-layers-of-spatial-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-multiple-layers-of-spatial-data" class="callout-inner">
<h3 class="callout-title">Challenge: Plot multiple layers of spatial
data<a class="anchor" aria-label="anchor" href="#challenge-plot-multiple-layers-of-spatial-data"></a>
</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a map of South Holland as follows:</p>
<ol style="list-style-type: decimal">
<li>Import <code>nl-gemeenten.shp</code> and filter only the
municipalities in South Holland.</li>
<li>Plot it and adjust line width as necessary.</li>
<li>Layer the boundary of Delft onto the plot.</li>
<li>Add a title.</li>
<li>Add a legend that shows both the province boundaries (as a line) and
the boundary of Delft (as a filled polygon).</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_ZH</span> <span class="op">&lt;-</span> <span class="va">municipal_boundary_NL</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">ligtInPr_1</span> <span class="op">==</span> <span class="st">"Zuid-Holland"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_ZH</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span><span class="st">"color"</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, labels <span class="op">=</span> <span class="st">"Municipal Boundaries in South Holland"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"color"</span> <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, <span class="fu">aes</span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"shape"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"purple"</span>, fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, labels <span class="op">=</span> <span class="st">"Municipality of Delft"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"shape"</span> <span class="op">=</span> <span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Delft location"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="export-a-shapefile"><h2 class="section-heading">Export a shapefile<a class="anchor" aria-label="anchor" href="#export-a-shapefile"></a>
</h2>
<hr class="half-width">
<p>To save a file, use the <code>st_write()</code> function from the
<code>sf</code> package. Although <code>sf</code> guesses the driver
needed for a specified output file name from its extension, this can be
made explicitly via the <code>driver</code> argument. In our case
<code>driver = "ESRI Shapefile"</code> ensures that the output is
correctly saved as a <code>.shp</code> file.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_write</span><span class="op">(</span><span class="va">leisure_locations_selection</span>,</span>
<span>         <span class="st">"data/leisure_locations_selection.shp"</span>, driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<code>ggplot2</code> automatically converts all objects in a plot to
the same CRS.</li>
<li>Still be aware of the CRS and extent for each object.</li>
<li>You can export an <code>sf</code> object to a shapefile with
<code>st_write()</code>.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-13-intro-to-raster-data"><p>Content from <a href="13-intro-to-raster-data.html">Intro to Raster Data</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/13-intro-to-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a raster dataset?</li>
<li>How do I work with and plot raster data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Explore raster attributes and metadata using R.</li>
<li>Import rasters into R using the <code>terra</code> package.</li>
<li>Plot a raster file in R using the <code>ggplot2</code> package.</li>
<li>Describe the difference between single- and multi-band rasters.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>In this lesson, we will work with raster data. We will start with an
introduction of the fundamental principles and metadata needed to work
with raster data in R. We will discuss some of the core metadata
elements needed to understand raster data in R, including CRS and
resolution.</p>
<p>We continue to work with the <code>tidyverse</code> package and we
will use the <code>terra</code> package to work with raster data. Make
sure that you have those packages loaded.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-data-used-in-this-lesson" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-data-used-in-this-lesson" class="callout-inner">
<h3 class="callout-title">The data used in this lesson<a class="anchor" aria-label="anchor" href="#the-data-used-in-this-lesson"></a>
</h3>
<div class="callout-content">
<p>In this and lesson, we will use:</p>
<ul>
<li>data extracted from the <a href="https://www.ahn.nl/" class="external-link">AHN digital
elevation dataset of the Netherlands</a> for the TU Delft campus area;
and</li>
<li>high-resolution RGB aerial photos of the TU Delft library obtained
from <a href="https://www.beeldmateriaal.nl/download-luchtfotos" class="external-link">Beeldmateriaal
Nederland</a>.</li>
</ul>
</div>
</div>
</div>
<section id="view-raster-file-attributes"><h2 class="section-heading">View Raster File Attributes<a class="anchor" aria-label="anchor" href="#view-raster-file-attributes"></a>
</h2>
<hr class="half-width">
<p>We will be working with a series of GeoTIFF files in this lesson. The
GeoTIFF format contains a set of embedded tags with metadata about the
raster data. We can use the function <code>describe()</code> from the
<code>terra</code> package to get information about our raster data
before we read that data into R. It is recommended to do this before
importing your data. We first examine the file
<code>tud-dsm-5m.tif</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dsm-5m.tif"                                                                                            
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<p>We will be using this information throughout this episode. By the end
of the episode, you will be able to explain and understand the output
above.</p>
</section><section id="open-a-raster-in-r"><h2 class="section-heading">Open a Raster in R<a class="anchor" aria-label="anchor" href="#open-a-raster-in-r"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve previewed the metadata for our GeoTIFF, let’s import
this raster dataset into R and explore its metadata more closely. We can
use the <code>rast()</code> function to import a raster file in R.</p>
<div id="data-tip---object-names" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---object-names" class="callout-inner">
<h3 class="callout-title">Data tip - Object names<a class="anchor" aria-label="anchor" href="#data-tip---object-names"></a>
</h3>
<div class="callout-content">
<p>To improve code readability, use file and object names that make it
clear what is in the file. The raster data for this episode contain the
TU Delft campus and its surroundings so we’ll use a naming convention of
<code>datatype_TUD</code>. The first object is a Digital Surface Model
(DSM) in GeoTIFF format stored in a file <code>tud-dsm-5m.tif</code>
which we will load into an object named according to our naming
convention <code>DSM_TUD</code>.</p>
</div>
</div>
</div>
<p>First we will load our raster file into R and view the data
structure.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span>
<span><span class="va">DSM_TUD</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 386, 722, 1  (nrow, ncol, nlyr)
resolution  : 5, 5  (x, y)
extent      : 83565, 87175, 445250, 447180  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992) 
source      : tud-dsm-5m.tif 
name        : tud-dsm-5m </code></pre>
</div>
<p>The information above includes a report on dimension, resolution,
extent and CRS, but no information about the values. Similar to other
data structures in R like vectors and data frame columns, descriptive
statistics for raster data can be retrieved with the
<code>summary()</code> function.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: [summary] used a sample</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   tud.dsm.5m     
 Min.   :-5.2235  
 1st Qu.:-0.7007  
 Median : 0.5462  
 Mean   : 2.5850  
 3rd Qu.: 4.4596  
 Max.   :89.7838  </code></pre>
</div>
<p>This output gives us information about the range of values in the
DSM. We can see, for instance, that the lowest elevation is
<code>-5.2235</code>, the highest is <code>89.7838</code>. But note the
warning. Unless you force R to calculate these statistics using every
cell in the raster, it will take a random sample of 100,000 cells and
calculate from them instead. To force calculation all the values, you
can use the function <code>values</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   tud-dsm-5m     
 Min.   :-5.3907  
 1st Qu.:-0.7008  
 Median : 0.5573  
 Mean   : 2.5886  
 3rd Qu.: 4.4648  
 Max.   :92.0810  </code></pre>
</div>
<p>With a summary on all cells of the raster, the values range from a
smaller minimum of <code>-5.3907</code> to a higher maximum of
<code>92.0910</code>.</p>
<p>To visualise the DSM in R using <code>ggplot2</code>, we need to
convert it to a data frame. We learned about data frames in an <a href="03-explore-data.html">earlier lesson</a>. The <code>terra</code>
package has the built-in function <code>as.data.frame()</code> for
conversion to a data frame.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now when we view the structure of our data, we will see a standard
data frame format.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	278692 obs. of  3 variables:
 $ x         : num  83568 83572 83578 83582 83588 ...
 $ y         : num  447178 447178 447178 447178 447178 ...
 $ tud-dsm-5m: num  10.34 8.64 1.25 1.12 2.13 ...</code></pre>
</div>
<p>We can use <code>ggplot()</code> to plot this data with a specific
<code>geom_</code> function called <code>geom_raster()</code>. We will
make the colour scale in our plot colour-blindness friendly with
<code>scale_fill_viridis_c</code>, introduced in an <a href="04-intro-to-visualisation.html">earlier lesson</a>. We will also
use the <code>coord_quickmap()</code> function to use an approximate
Mercator projection for our plots. This approximation is suitable for
small areas that are not too close to the poles. Other coordinate
systems are available in <code>ggplot2</code> if needed, you can learn
about them at their help page <code>?coord_map</code>.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># `option = "H"` provides a contrasting colour scale</span></span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-intro-to-raster-data-rendered-first-rast-plot-1.png" alt="Raster plot with `ggplot2` using the viridis color scale" class="figure mx-auto d-block"><figcaption>
Raster plot with <code>ggplot2</code> using the viridis color scale
</figcaption></figure><div id="plotting-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip" class="callout-inner">
<h3 class="callout-title">Plotting tip<a class="anchor" aria-label="anchor" href="#plotting-tip"></a>
</h3>
<div class="callout-content">
<p>More information about the viridis palette used above at <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html" class="external-link">viridis
package documentation</a>.</p>
</div>
</div>
</div>
<div id="plotting-tip-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip-1" class="callout-inner">
<h3 class="callout-title">Plotting tip<a class="anchor" aria-label="anchor" href="#plotting-tip-1"></a>
</h3>
<div class="callout-content">
<p>For faster previews, you can use the <code>plot()</code> function on
a <code>terra</code> object.</p>
</div>
</div>
</div>
<p>This map shows our Digital Surface Model, that is, the elevation of
our study site including buildings and vegetation. From the legend we
can confirm that the maximum elevation is around 90, but we cannot tell
whether this is 90 feet or 90 meters because the legend doesn’t show us
the units. We can look at the metadata of our object to see what the
units are. Much of the metadata that we’re interested in is part of the
CRS.</p>
<p>Now we will see how features of the CRS appear in our data file and
what meanings they have.</p>
</section><section id="view-raster-coordinate-reference-system-crs-in-r"><h2 class="section-heading">View Raster Coordinate Reference System (CRS) in R<a class="anchor" aria-label="anchor" href="#view-raster-coordinate-reference-system-crs-in-r"></a>
</h2>
<hr class="half-width">
<p>We can view the CRS string associated with our R object using the
<code>crs()</code> function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DSM_TUD</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=sterea +lat_0=52.1561605555556 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs"</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>What units are our data in?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>+units=m</code> in the output of the code above tells us that
our data is in meters (m).</p>
</div>
</div>
</div>
</div>
<div id="understanding-crs-in-proj.4-format" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="understanding-crs-in-proj.4-format" class="callout-inner">
<h3 class="callout-title">Understanding CRS in PROJ.4 format<a class="anchor" aria-label="anchor" href="#understanding-crs-in-proj.4-format"></a>
</h3>
<div class="callout-content">
<p>The CRS for our data is given to us by R in PROJ.4 format. Let’s
break down the pieces of a PROJ.4 string. The string contains all of the
individual CRS elements that R or another GIS might need. Each element
is specified with a <code>+</code> sign, similar to how a
<code>.csv</code> file is delimited or broken up by a <code>,</code>.
After each <code>+</code> we see the CRS element such as projection
(<code>proj=</code>) being defined.</p>
<p>See more about CRS and PROJ.4 strings in <a href="https://datacarpentry.org/organization-geospatial/03-crs" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
</section><section id="calculate-raster-min-and-max-values"><h2 class="section-heading">Calculate Raster Min and Max values<a class="anchor" aria-label="anchor" href="#calculate-raster-min-and-max-values"></a>
</h2>
<hr class="half-width">
<p>It is useful to know the minimum and maximum values of a raster
dataset. In this case, as we are working with elevation data, these
values represent the min/max elevation range at our site.</p>
<p>Raster statistics are often calculated and embedded in a GeoTIFF for
us. We can view these values:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">minmax</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    tud-dsm-5m
min        Inf
max       -Inf</code></pre>
</div>
<div id="data-tip---set-min-and-max-values" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---set-min-and-max-values" class="callout-inner">
<h3 class="callout-title">Data tip - Set min and max values<a class="anchor" aria-label="anchor" href="#data-tip---set-min-and-max-values"></a>
</h3>
<div class="callout-content">
<p>If the <code>min</code> and <code>max</code> values are
<code>Inf</code> and <code>-Inf</code> respectively, it means that they
haven’t been calculated. We can calculate them using the
<code>setMinMax()</code> function.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD</span> <span class="op">&lt;-</span> <span class="fu">setMinMax</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -5.39069</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 92.08102</code></pre>
</div>
<p>We can see that the elevation at our site ranges from
<code>-5.39069</code>m to <code>92.08102</code>m.</p>
</section><section id="raster-bands"><h2 class="section-heading">Raster bands<a class="anchor" aria-label="anchor" href="#raster-bands"></a>
</h2>
<hr class="half-width">
<p>The Digital Surface Model object (<code>DSM_TUD</code>) that we’ve
been working with is a single band raster. This means that there is only
one dataset stored in the raster: surface elevation in meters for one
time period.</p>
<figure><img src="https://datacarpentry.org/r-raster-vector-geospatial/fig/dc-spatial-raster/single_multi_raster.png" class="figure mx-auto d-block"></figure><p>A raster dataset can contain one or more bands. We can view the
number of bands in a raster using the <code>nlyr()</code> function.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlyr</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<p>This dataset has only 1 band. However, raster data can also be
multi-band, meaning that one raster file contains data for more than one
variable or time period for each cell. We will discuss multi-band raster
data in a <a href="..episodes/17-work-with-multi-band-rasters.html">later
episode</a>.</p>
</section><section id="creating-a-histogram-of-raster-values"><h2 class="section-heading">Creating a histogram of raster values<a class="anchor" aria-label="anchor" href="#creating-a-histogram-of-raster-values"></a>
</h2>
<hr class="half-width">
<p>A histogram can be used to inspect the distribution of raster values
visually. It can show if there are values above the max or below the min
of the expected range.</p>
<p>We can inspect the distribution of values contained in a raster using
the <code>ggplot2</code> function <code>geom_histogram()</code>.
Histograms are often useful in identifying outliers and bad data values
in our raster data.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/13-intro-to-raster-data-rendered-rast-hist-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice that a message is displayed when R creates the histogram:</p>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p>This message is caused by a default setting in
<code>geom_histogram()</code> enforcing that there are 30 bins for the
data. We can define the number of bins we want in the histogram by
giving another value to the <code>bins</code> argument. 60 bins, for
instance, will give a more detailed histogram of the same
distribution:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/13-intro-to-raster-data-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that the shape of this histogram looks similar to the previous
one that was created using the default of 30 bins. The distribution of
elevation values for our Digital Surface Model (DSM) looks reasonable.
It is likely that there are no bad data values in this particular
raster.</p>
<div id="challenge-explore-raster-metadata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-explore-raster-metadata" class="callout-inner">
<h3 class="callout-title">Challenge: Explore raster metadata<a class="anchor" aria-label="anchor" href="#challenge-explore-raster-metadata"></a>
</h3>
<div class="callout-content">
<p>Use <code>describe()</code> to determine the following about the
<code>tud-dsm-hill.tif</code> file:</p>
<ol style="list-style-type: decimal">
<li>Does this file have the same CRS as <code>DSM_TUD</code>?</li>
<li>What is the resolution of the raster data?</li>
<li>How large would a 5x5 pixel area be on the Earth’s surface?</li>
<li>Is the file a multi- or single-band raster?</li>
</ol>
<p>Note that this file is a hillshade raster. We will learn about
hillshades in the <a href="17-work-with-multi-band-rasters.html">Working
with Multi-band Rasters in R</a> episode.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m-hill.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dsm-5m-hill.tif"                                                                                       
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x11 Type=Byte, ColorInterp=Gray"                                                                       
[57] "  NoData Value=0"                                                                                                      </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="more-resources" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-resources" class="callout-inner">
<h3 class="callout-title">More resources<a class="anchor" aria-label="anchor" href="#more-resources"></a>
</h3>
<div class="callout-content">
<ul>
<li>See the manual and tutorials of the <code>terra</code> package on <a href="https://rspatial.org/" class="external-link">https://rspatial.org/</a>.</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The GeoTIFF file format includes metadata about the raster
data.</li>
<li>To plot raster data with the <code>ggplot2</code> package, we need
to convert them to data frames.</li>
<li>R stores CRS information in the PROJ.4 format.</li>
<li>Histograms are useful to identify missing or bad data values.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-14-plot-raster-data"><p>Content from <a href="14-plot-raster-data.html">Plot Raster Data</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/14-plot-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create categorized or customized maps of raster data?</li>
<li>How can I customize the colour scheme of a raster image?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Build customized plots for a single band raster using the
<code>ggplot2</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>In this part, we will plot our raster object using
<code>ggplot2</code> with customized coloring schemes. We will continue
working with the Digital Surface Model (DSM) raster from the <a href="13-intro-to-raster-data.html">previous episode</a>.</p>
<div class="section level3">
<h3 id="plotting-data-using-breaks">Plotting Data Using Breaks<a class="anchor" aria-label="anchor" href="#plotting-data-using-breaks"></a>
</h3>
<p>In the previous plot, our DSM was coloured with a continuous colour
range. For clarity and visibility, we may prefer to view the data
“symbolized” or coloured according to ranges of values. This is
comparable to a “classified” map. For that, we need to tell
<code>ggplot()</code> how many groups to break our data into and where
those breaks should be. To make these decisions, it is useful to first
explore the distribution of the data using a bar plot. To begin with, we
will use <code>dplyr</code>’s <code>mutate()</code> function combined
with <code>cut()</code> to split the data into 3 bins.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To see the cut-off values for the groups, we can ask for the levels
of <code>fct_elevation</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-5.49,27.1]" "(27.1,59.6]"  "(59.6,92.2]" </code></pre>
</div>
<p>And we can get the count of values (that is, number of pixels) in
each group using <code>dplyr</code>’s <code>count()</code> function:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  fct_elevation      n
1  (-5.49,27.1] 277100
2   (27.1,59.6]   1469
3   (59.6,92.2]    123</code></pre>
</div>
<p>We might prefer to customize the cut-off values for these groups.
Lets round the cut-off values so that we have groups for the ranges of
-10 - 0m, 0 - 5m, and 5 - 100m. To implement this we will give
<code>cut()</code> a numeric vector of break points instead of the
number of breaks we want.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_cb <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation_cb</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-10,0]" "(0,5]"   "(5,100]"</code></pre>
</div>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>Note that 4 break values will result in 3 bins of data.</p>
<p>The bin intervals are shown using <code>(</code> to mean exclusive
and <code>]</code> to mean inclusive. For example: (0, 10] means “from 0
through 10”.</p>
</div>
</div>
</div>
<p>And now we can plot our bar plot again, using the new groups:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And we can get the count of values in each group in the same way we
did before:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">fct_elevation_cb</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  fct_elevation_cb      n
1          (-10,0] 113877
2            (0,5] 101446
3          (5,100]  63369</code></pre>
</div>
<p>We can use those groups to plot our raster data, with each group
being a different colour:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure">
The plot above uses the default colours inside <code>ggplot2</code> for
raster objects. We can specify our own colours to make the plot look a
little nicer. R has a built in set of colours for plotting terrain,
which are built in to the <code>terrain.colors()</code> function. Since
we have three bins, we want to create a 3-colour palette:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "#00A600" "#ECB176" "#F2F2F2"</code></pre>
</div>
<p>The <code>terrain.colors()</code> function returns hex colours - each
of these character strings represents a colour. To use these in our map,
we pass them across using the <code>scale_fill_manual()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<section id="more-plot-formatting"><h2 class="section-heading">More Plot Formatting<a class="anchor" aria-label="anchor" href="#more-plot-formatting"></a>
</h2>
<hr class="half-width">
<p>If we need to create multiple plots using the same colour palette, we
can create an R object (<code>my_col</code>) for the set of colours that
we want to use. We can then quickly change the palette across all plots
by modifying the <code>my_col</code> object, rather than each individual
plot.</p>
<p>We can give the legend a more meaningful title by passing a value to
the <code>name</code> argument of the <code>scale_fill_manual()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure">
The axis labels x and y are not necessary, so we can turn them off by
passing <code>element_blank()</code> to the relevant part of the
<code>theme()</code> function.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-plot-using-custom-breaks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-using-custom-breaks" class="callout-inner">
<h3 class="callout-title">Challenge: Plot Using Custom Breaks<a class="anchor" aria-label="anchor" href="#challenge-plot-using-custom-breaks"></a>
</h3>
<div class="callout-content">
<p>Create a plot of the TU Delft Digital Surface Model
(<code>DSM_TUD</code>) that has:</p>
<ol style="list-style-type: decimal">
<li>Six classified ranges of values (break points) that are evenly
divided among the range of pixel values.</li>
<li>A plot title.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_6 <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation_6</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-5.49,10.9]" "(10.9,27.1]"  "(27.1,43.3]"  "(43.3,59.6]"  "(59.6,75.8]" 
[6] "(75.8,92.2]" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       fill <span class="op">=</span> <span class="va">fct_elevation_6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Elevation Classes of the Digital Surface Model (DSM)"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Continuous data ranges can be grouped into categories using
<code>mutate()</code> and <code>cut()</code>.</li>
<li>Use the built-in <code>terrain.colors()</code> or set your preferred
colour scheme manually.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-15-reproject-raster-data"><p>Content from <a href="15-reproject-raster-data.html">Reproject Raster Data</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/15-reproject-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I work with raster data sets that are in different
projections?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Reproject a raster in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>Sometimes we encounter raster datasets that do not “line up” when
plotted or analysed. Rasters that don’t line up are most often in
different Coordinate Reference Systems (CRS). This episode explains how
to deal with rasters in different CRS. It will walk through reprojecting
rasters in R using the <code>project()</code> function in the
<code>terra</code> package.</p>
<section id="raster-projection"><h2 class="section-heading">Raster Projection<a class="anchor" aria-label="anchor" href="#raster-projection"></a>
</h2>
<hr class="half-width">
<p>For this episode, we will be working with the Digital Terrain Model
data. This differs from the surface model data we’ve been working with
so far in that the digital surface model (DSM) includes the tops of
trees and buildings, while the digital terrain model (DTM) shows the
ground level.</p>
<p>We’ll be looking at another model (the canopy/building height model,
or CHM) in <a href="16-raster-calculations.html">a later episode</a> and
will see how to calculate the CHM from the DSM and DTM. Here, we will
create a map of the Digital Terrain Model (<code>DTM_TUD</code>) of TU
Delft and its surrounding draped (or layered) on top of the hillshade
(<code>DTM_hill_TUD</code>).</p>
<div id="layering-rasters-hillshade" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="layering-rasters-hillshade" class="callout-inner">
<h3 class="callout-title">Layering Rasters: Hillshade<a class="anchor" aria-label="anchor" href="#layering-rasters-hillshade"></a>
</h3>
<div class="callout-content">
<p>We can layer a raster on top of a hillshade raster for the same area,
and use a transparency factor to create a 3-dimensional shaded effect. A
hillshade is a raster that maps the terrain using light and shadow to
create a 3D-looking image that you would see from above when viewing the
terrain. We will add a custom colour, making the plot grey.</p>
<p>Read more about layering raster <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/02-raster-plot.html#layering-rasters" class="external-link">here</a>.</p>
</div>
</div>
</div>
<p>First, we need to import the DTM and DTM hillshade data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dtm-5m.tif"</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dtm-5m-hill-WGS84.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, we will convert each of these datasets to a data frame for
plotting with <code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can create a map of the DTM layered over the hillshade.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_df</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure">
Our results are curious - neither the Digital Terrain Model
(<code>DTM_TUD_df</code>) nor the DTM Hillshade
(<code>DTM_hill_TUD_df</code>) plotted. Let’s try to plot the DTM on its
own to make sure there are data there.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Our DTM seems to contain data and plots just fine.</p>
<p>Next we plot the DTM Hillshade on its own to see whether everything
is OK.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we look at the axes, we can see that the units, and therefore the
projections, of the two rasters are different. When this is the case,
<code>ggplot2</code> won’t render the image. It won’t even throw an
error message to tell you something has gone wrong. We can look at
Coordinate Reference Systems (CRSs) of the DTM and the hillshade data to
see how they differ.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>View the CRS for each of these two datasets. What projection does
each use?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [2] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [3] "        DATUM[\"Amersfoort\","                                                                                         
 [4] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [5] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
 [6] "        PRIMEM[\"Greenwich\",0,"                                                                                       
 [7] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
 [8] "        ID[\"EPSG\",4289]],"                                                                                           
 [9] "    CONVERSION[\"RD New\","                                                                                            
[10] "        METHOD[\"Oblique Stereographic\","                                                                             
[11] "            ID[\"EPSG\",9809]],"                                                                                       
[12] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[14] "            ID[\"EPSG\",8801]],"                                                                                       
[15] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[16] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[17] "            ID[\"EPSG\",8802]],"                                                                                       
[18] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[19] "            SCALEUNIT[\"unity\",1],"                                                                                   
[20] "            ID[\"EPSG\",8805]],"                                                                                       
[21] "        PARAMETER[\"False easting\",155000,"                                                                           
[22] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[23] "            ID[\"EPSG\",8806]],"                                                                                       
[24] "        PARAMETER[\"False northing\",463000,"                                                                          
[25] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[26] "            ID[\"EPSG\",8807]]],"                                                                                      
[27] "    CS[Cartesian,2],"                                                                                                  
[28] "        AXIS[\"easting (X)\",east,"                                                                                    
[29] "            ORDER[1],"                                                                                                 
[30] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[31] "        AXIS[\"northing (Y)\",north,"                                                                                  
[32] "            ORDER[2],"                                                                                                 
[33] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[34] "    USAGE["                                                                                                            
[35] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[36] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[37] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[38] "    ID[\"EPSG\",28992]]"                                                                                               </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "GEOGCRS[\"WGS 84\","                                   
 [2] "    DATUM[\"World Geodetic System 1984\","             
 [3] "        ELLIPSOID[\"WGS 84\",6378137,298.257223563,"   
 [4] "            LENGTHUNIT[\"metre\",1]]],"                
 [5] "    PRIMEM[\"Greenwich\",0,"                           
 [6] "        ANGLEUNIT[\"degree\",0.0174532925199433]],"    
 [7] "    CS[ellipsoidal,2],"                                
 [8] "        AXIS[\"geodetic latitude (Lat)\",north,"       
 [9] "            ORDER[1],"                                 
[10] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[11] "        AXIS[\"geodetic longitude (Lon)\",east,"       
[12] "            ORDER[2],"                                 
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[14] "    ID[\"EPSG\",4326]]"                                </code></pre>
</div>
<p><code>DTM_TUD</code> is in the Amersfoort / RD New projection,
whereas <code>DTM_hill_TUD</code> is in WGS 84.</p>
</div>
</div>
</div>
</div>
<p>Because the two rasters are in different CRS, they don’t line up when
plotted in R. We need to reproject (or change the projection of)
<code>DTM_hill_TUD</code> into the Amersfoort / RD New CRS.</p>
</section><section id="reproject-rasters"><h2 class="section-heading">Reproject Rasters<a class="anchor" aria-label="anchor" href="#reproject-rasters"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>project()</code> function to reproject a raster
into a new CRS. Keep in mind that reprojection only works when you first
have a defined CRS for the raster object that you want to reproject. It
cannot be used if no CRS is defined. Lucky for us, DTM_hill_TUD has a
defined CRS.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>When we reproject a raster, we move it from one “grid” to another.
Thus, we are modifying the data! Keep this in mind as we work with
raster data.</p>
</div>
</div>
</div>
<p>To use the <code>project()</code> function, we need to define two
things:</p>
<ol style="list-style-type: decimal">
<li>the object we want to reproject and</li>
<li>the CRS that we want to reproject it to.</li>
</ol>
<p>The syntax is <code>project(RasterObject, crs)</code></p>
<p>We want the CRS of our hillshade to match the <code>DTM_TUD</code>
raster. We can thus assign the CRS of our <code>DTM_TUD</code> to our
hillshade within the <code>project()</code> function as follows:
<code>crs(DTM_TUD)</code>. Note that we are using the
<code>project()</code> function on the raster object, not the
<code>data.frame()</code> we use for plotting with
<code>ggplot</code>.</p>
<p>First we will reproject our <code>DTM_hill_TUD</code> raster data to
match the <code>DTM_TUD</code> raster CRS:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_EPSG28992_TUD</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>,</span>
<span>                                  <span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can compare the CRS of our original DTM hillshade and our new
DTM hillshade, to see how they are different.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [2] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [3] "        DATUM[\"Amersfoort\","                                                                                         
 [4] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [5] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
 [6] "        PRIMEM[\"Greenwich\",0,"                                                                                       
 [7] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
 [8] "        ID[\"EPSG\",4289]],"                                                                                           
 [9] "    CONVERSION[\"RD New\","                                                                                            
[10] "        METHOD[\"Oblique Stereographic\","                                                                             
[11] "            ID[\"EPSG\",9809]],"                                                                                       
[12] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[14] "            ID[\"EPSG\",8801]],"                                                                                       
[15] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[16] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[17] "            ID[\"EPSG\",8802]],"                                                                                       
[18] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[19] "            SCALEUNIT[\"unity\",1],"                                                                                   
[20] "            ID[\"EPSG\",8805]],"                                                                                       
[21] "        PARAMETER[\"False easting\",155000,"                                                                           
[22] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[23] "            ID[\"EPSG\",8806]],"                                                                                       
[24] "        PARAMETER[\"False northing\",463000,"                                                                          
[25] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[26] "            ID[\"EPSG\",8807]]],"                                                                                      
[27] "    CS[Cartesian,2],"                                                                                                  
[28] "        AXIS[\"easting (X)\",east,"                                                                                    
[29] "            ORDER[1],"                                                                                                 
[30] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[31] "        AXIS[\"northing (Y)\",north,"                                                                                  
[32] "            ORDER[2],"                                                                                                 
[33] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[34] "    USAGE["                                                                                                            
[35] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[36] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[37] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[38] "    ID[\"EPSG\",28992]]"                                                                                               </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "GEOGCRS[\"WGS 84\","                                   
 [2] "    DATUM[\"World Geodetic System 1984\","             
 [3] "        ELLIPSOID[\"WGS 84\",6378137,298.257223563,"   
 [4] "            LENGTHUNIT[\"metre\",1]]],"                
 [5] "    PRIMEM[\"Greenwich\",0,"                           
 [6] "        ANGLEUNIT[\"degree\",0.0174532925199433]],"    
 [7] "    CS[ellipsoidal,2],"                                
 [8] "        AXIS[\"geodetic latitude (Lat)\",north,"       
 [9] "            ORDER[1],"                                 
[10] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[11] "        AXIS[\"geodetic longitude (Lon)\",east,"       
[12] "            ORDER[2],"                                 
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[14] "    ID[\"EPSG\",4326]]"                                </code></pre>
</div>
<p>We can also compare the extent of the two objects.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 83537.3768729672, 87200.5199626113, 445202.584641046, 447230.395994242 (xmin, xmax, ymin, ymax)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">DTM_hill_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 4.34674898644234, 4.39970436836596, 51.9910492930106, 52.0088368700157 (xmin, xmax, ymin, ymax)</code></pre>
</div>
</section><section id="deal-with-raster-resolution"><h2 class="section-heading">Deal with Raster Resolution<a class="anchor" aria-label="anchor" href="#deal-with-raster-resolution"></a>
</h2>
<hr class="half-width">
<p>Let’s next have a look at the resolution of our reprojected hillshade
versus our original data.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5.03179 5.03179</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<p>These two resolutions are different, but they’re representing the
same data. We can tell R to force our newly reprojected raster to be the
same as <code>DTM_TUD</code> by adding a line of code
<code>res = res(DTM_TUD)</code> within the <code>project()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_EPSG28992_TUD</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, </span>
<span>                                  <span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span>,</span>
<span>                                  res <span class="op">=</span> <span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now both our resolutions and our CRSs match, so we can plot these two
data sets together. Let’s double-check our resolution to be sure:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<p>For plotting with <code>ggplot()</code>, we will need to create a
data frame from our newly reprojected raster.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_TUD_2_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now create a plot of this data.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_2_df</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We have now successfully draped the Digital Terrain Model on top of
our hillshade to produce a nice looking, textured map!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>In order to plot two raster data sets together, they must be in the
same CRS.</li>
<li>Use the <code>project()</code> function to convert between
CRSs.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-16-raster-calculations"><p>Content from <a href="16-raster-calculations.html">Raster Calculations</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/16-raster-calculations.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I subtract one raster from another and extract pixel values
for defined locations?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Perform a subtraction between two rasters using raster math.</li>
<li>Export raster data as a GeoTIFF file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>We often want to combine values of and perform calculations on
rasters to create a new output raster. This episode covers how to
subtract one raster from another using basic raster math.</p>
<section id="raster-calculations-in-r"><h2 class="section-heading">Raster calculations in R<a class="anchor" aria-label="anchor" href="#raster-calculations-in-r"></a>
</h2>
<hr class="half-width">
<p>We often want to perform calculations on two or more rasters to
create a new output raster. For example, if we are interested in mapping
the heights of trees and buildings across an entire field site, we might
want to calculate the difference between the Digital Surface Model (DSM,
tops of trees and buildings) and the Digital Terrain Model (DTM, ground
level). The resulting dataset is referred to as a Canopy Height Model
(CHM) and represents the actual height of trees, buildings, etc. with
the influence of ground elevation removed.</p>
<figure><img src="https://datacarpentry.org/r-raster-vector-geospatial/fig/dc-spatial-raster/lidarTree-height.png" alt="" class="figure mx-auto d-block"><figcaption>Source: National Ecological Observatory Network
(NEON).</figcaption></figure></section><section id="load-the-data"><h2 class="section-heading">Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>For this episode, we will use the DTM and DSM data which we already
have loaded from previous episodes.</p>
<p>We use the <code>describe()</code> function to view information about
the DTM and DSM data files.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dtm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dtm-5m.tif"                                                                                            
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dsm-5m.tif"                                                                                            
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<p>We’ve already loaded and worked with these two data files in earlier
episodes. Let’s plot them each once more to remind ourselves what this
data looks like. First we’ll plot the DTM elevation data:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And then the DSM elevation data:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , </span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="raster-math-and-canopy-height-models"><h2 class="section-heading">Raster math and Canopy Height Models<a class="anchor" aria-label="anchor" href="#raster-math-and-canopy-height-models"></a>
</h2>
<hr class="half-width">
<p>We can perform raster calculations by subtracting (or adding,
multiplying, etc.) two rasters. In the geospatial world, we call this
“raster math”.</p>
<p>Let’s subtract the DTM from the DSM to create a Canopy Height Model.
After subtracting, let’s create a data frame so we can plot with
<code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_TUD</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD</span> <span class="op">-</span> <span class="va">DTM_TUD</span></span>
<span><span class="va">CHM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now plot the output CHM.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_TUD_df</span> , </span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Canopy Height"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Let’s have a look at the distribution of values in our newly created
Canopy Height Model (CHM).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/16-raster-calculations-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure">
Notice that the range of values for the output CHM starts right below 0
and ranges to almost 100 meters. Does this make sense for buildings and
trees in Delft?</p>
<div id="challenge-explore-chm-raster-values" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-explore-chm-raster-values" class="callout-inner">
<h3 class="callout-title">Challenge: Explore CHM Raster Values<a class="anchor" aria-label="anchor" href="#challenge-explore-chm-raster-values"></a>
</h3>
<div class="callout-content">
<p>It’s often a good idea to explore the range of values in a raster
dataset just like we might explore a dataset that we collected in the
field.</p>
<ol style="list-style-type: decimal">
<li>What is the minimum and maximum value for the Canopy Height Model
<code>CHM_TUD</code> that we just created?</li>
<li>What is the distribution of all the pixel values in the CHM?</li>
<li>Plot the <code>CHM_TUD</code> raster using breaks that make sense
for the data. Include an appropriate colour palette for the data, plot
title and no axes ticks / labels.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">$</span><span class="va">`tud-dsm-5m`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -3.638057</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">$</span><span class="va">`tud-dsm-5m`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 92.08102</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">CHM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">CHM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>                  <span class="fu">mutate</span><span class="op">(</span>canopy_discrete <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       fill <span class="op">=</span> <span class="va">canopy_discrete</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-7-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="two-ways-to-perform-raster-calculations" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="two-ways-to-perform-raster-calculations" class="callout-inner">
<h3 class="callout-title">Two Ways to Perform Raster Calculations<a class="anchor" aria-label="anchor" href="#two-ways-to-perform-raster-calculations"></a>
</h3>
<div class="callout-content">
<p>We can calculate the difference between two rasters in two different
ways:</p>
<ul>
<li>by directly subtracting the two rasters in R using raster math,</li>
</ul>
<p>or for more efficient processing, particularly if our rasters are
large and/or the calculations we are performing are complex:</p>
<ul>
<li>using the <code>lapp()</code> function.</li>
</ul>
<p>See how <code>lapp()</code> is used in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/04-raster-calculations-in-r.html#efficient-raster-calculations" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
</section><section id="export-a-geotiff"><h2 class="section-heading">Export a GeoTIFF<a class="anchor" aria-label="anchor" href="#export-a-geotiff"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve created a new raster, let’s export the data as a
GeoTIFF file using the <code>writeRaster()</code> function.</p>
<p>When we write this raster object to a GeoTIFF file we’ll name it
<code>CHM_TUD.tiff</code>. This name allows us to quickly remember both
what the data contains (CHM data) and for where (TU Delft campus and
surroundings). The <code>writeRaster()</code> function by default writes
the output file to your working directory unless you specify a full file
path.</p>
<p>We will specify the output format (“GTiff”), the no data value
<code>NAflag = -9999</code>. We will also tell R to overwrite any data
that is already in a file of the same name.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">CHM_TUD</span>, <span class="st">"fig/CHM_TUD.tiff"</span>,</span>
<span>            filetype<span class="op">=</span><span class="st">"GTiff"</span>,</span>
<span>            overwrite<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>            NAflag<span class="op">=</span><span class="op">-</span><span class="fl">9999</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Rasters can be computed on using mathematical functions.</li>
<li>The <code>writeRaster()</code> function can be used to write raster
data to a file.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-17-work-with-multi-band-rasters"><p>Content from <a href="17-work-with-multi-band-rasters.html">Work with Multi-Band Rasters</a></p>
<hr>
<p>Last updated on 2024-02-14 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/17-work-with-multi-band-rasters.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I visualize individual and multiple bands in a raster
object?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Identify a single versus a multi-band raster file.</li>
<li>Import multi-band rasters into R using the <code>terra</code>
package.</li>
<li>Plot multi-band colour image rasters in R using the
<code>ggplot</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>This episode explores how to import and plot a multi-band raster in
R.</p>
<section id="getting-started-with-multi-band-data-in-r"><h2 class="section-heading">Getting Started with Multi-Band Data in R<a class="anchor" aria-label="anchor" href="#getting-started-with-multi-band-data-in-r"></a>
</h2>
<hr class="half-width">
<p>In this episode, the multi-band data that we are working with is <a href="https://opendata.beeldmateriaal.nl/" class="external-link">Beeldmateriaal Open Data</a>
from the Netherlands. Each RGB image is a 3-band raster. The same steps
would apply to working with a multi-spectral image with 4 or more bands
- like Landsat imagery.</p>
<p>By using the <code>rast()</code> function along with the
<code>lyrs</code> parameter, we can read specific raster bands; omitting
this parameter would read instead all bands.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band1_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span>, lyrs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>We need to convert this data to a data frame in order to plot it with
<code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band1_TUD_df</span>  <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_band1_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_band1_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="image-raster-data-values"><h2 class="section-heading">Image Raster Data Values<a class="anchor" aria-label="anchor" href="#image-raster-data-values"></a>
</h2>
<hr class="half-width">
<p>This raster contains values between 0 and 255. These values represent
degrees of brightness associated with the image band. In the case of a
RGB image (red, green and blue), band 1 is the red band. When we plot
the red band, larger numbers (towards 255) represent pixels with more
red in them (a strong red reflection). Smaller numbers (towards 0)
represent pixels with less red in them (less red was reflected). To plot
an RGB image, we mix red + green + blue values into one single colour to
create a full colour image - similar to the colour image a digital
camera creates.</p>
</section><section id="import-a-specific-band"><h2 class="section-heading">Import a Specific Band<a class="anchor" aria-label="anchor" href="#import-a-specific-band"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>rast()</code> function to import specific bands
in our raster object by specifying which band we want with
<code>lyrs = N</code> (N represents the band number we want to work
with). To import the green band, we would use <code>lyrs = 2</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band2_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span>, lyrs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<p>We can convert this data to a data frame and plot the same way we
plotted the red band:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band2_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_band2_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_band2_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_2`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="raster-stacks"><h2 class="section-heading">Raster Stacks<a class="anchor" aria-label="anchor" href="#raster-stacks"></a>
</h2>
<hr class="half-width">
<p>Next, we will work with all three image bands (red, green and blue)
as an R raster object. We will then plot a 3-band composite, or
full-colour, image.</p>
<p>To bring in all bands of a multi-band raster, we use the
<code>rast()</code> function.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s preview the attributes of our stack object:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 4988, 4866, 3  (nrow, ncol, nlyr)
resolution  : 0.08, 0.08  (x, y)
extent      : 85272, 85661.28, 446295.2, 446694.2  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992) 
source      : tudlib-rgb.tif 
colors RGB  : 1, 2, 3 
names       : tudlib-rgb_1, tudlib-rgb_2, tudlib-rgb_3 </code></pre>
</div>
<p>We can view the attributes of each band in the stack in a single
output. For example, if we had hundreds of bands, we could specify which
band we’d like to view attributes for using an index value:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 4988, 4866, 1  (nrow, ncol, nlyr)
resolution  : 0.08, 0.08  (x, y)
extent      : 85272, 85661.28, 446295.2, 446694.2  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992) 
source      : tudlib-rgb.tif 
name        : tudlib-rgb_2 </code></pre>
</div>
<p>We can also use <code>ggplot2</code> to plot the data in any layer of
our raster object. Remember, we need to convert to a data frame
first.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_stack_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Each band in our RasterStack gets its own column in the data frame.
Thus we have:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">RGB_stack_TUD_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	24271608 obs. of  5 variables:
 $ x           : num  85272 85272 85272 85272 85272 ...
 $ y           : num  446694 446694 446694 446694 446694 ...
 $ tudlib-rgb_1: int  52 48 47 49 47 45 47 48 49 54 ...
 $ tudlib-rgb_2: int  64 58 57 60 57 55 58 59 62 69 ...
 $ tudlib-rgb_3: int  57 49 49 53 50 47 51 54 57 68 ...</code></pre>
</div>
<p>Let’s create a histogram of the first band:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_stack_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">`tudlib-rgb_1`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure">
And a raster plot of the second band:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_stack_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_2`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can access any individual band in the same way.</p>
</section><section id="create-a-three-band-image"><h2 class="section-heading">Create a three-band image<a class="anchor" aria-label="anchor" href="#create-a-three-band-image"></a>
</h2>
<hr class="half-width">
<p>To render a final three-band, coloured image in R, we use the
<code>plotRGB()</code> function.</p>
<p>This function allows us to:</p>
<ul>
<li>Identify what bands we want to render in the red, green and blue
regions. The <code>plotRGB()</code> function defaults to a 1=red,
2=green, and 3=blue band order. However, you can define what bands you’d
like to plot manually. Manual definition of bands is useful if you have,
for example a near-infrared band and want to create a colour infrared
image.</li>
<li>Adjust the stretch of the image to increase or decrease
contrast.</li>
</ul>
<p>Let’s plot our 3-band image. Note that we can use the
<code>plotRGB()</code> function directly with our RasterStack object (we
don’t need a data frame as this function isn’t part of the
<code>ggplot2</code> package).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">RGB_stack_TUD</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The image above looks pretty good. We can explore whether applying a
stretch to the image might improve clarity and contrast using
stretch=“lin” or stretch=“hist”, as explained in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html#create-a-three-band-image" class="external-link">this
lesson</a>.</p>
<div id="spatraster-in-r" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="spatraster-in-r" class="callout-inner">
<h3 class="callout-title">SpatRaster in R<a class="anchor" aria-label="anchor" href="#spatraster-in-r"></a>
</h3>
<div class="callout-content">
<p>The R SpatRaster object type can handle rasters with multiple bands.
The SpatRaster only holds parameters that describe the properties of
raster data that is located somewhere on our computer.</p>
<p>A SpatRasterDataset object can hold references to sub-datasets, that
is, SpatRaster objects. In most cases, we can work with a SpatRaster in
the same way we might work with a SpatRasterDataset.</p>
<p>Read more about SpatRasters in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html#spatraster-in-r" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>A single raster file can contain multiple bands or layers.</li>
<li>Use the <code>rast()</code> function to load all bands in a
multi-layer raster file into R.</li>
<li>Individual bands within a SpatRaster can be accessed, analysed, and
visualized using the same functions no matter how many bands it
holds.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/r-geospatial-urban/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/r-geospatial-urban/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/r-geospatial-urban/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:c.forgaci@tudelft.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/r-geospatial-urban/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, geospatial",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/r-geospatial-urban/aio.html",
  "identifier": "https://carpentries-incubator.github.io/r-geospatial-urban/aio.html",
  "dateCreated": "2024-02-14",
  "dateModified": "2024-02-14",
  "datePublished": "2024-02-14"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

