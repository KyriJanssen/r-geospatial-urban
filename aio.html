<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Geospatial Data Carpentry with R for Urbanists: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Geospatial Data Carpentry with R for Urbanists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Geospatial Data Carpentry with R for Urbanists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Geospatial Data Carpentry with R for Urbanists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="09-open-and-plot-vector-layers.html">1. Open and Plot Vector Layers</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="10-explore-and-plot-by-vector-layer-attributes.html">2. Explore and plot by vector layer attributes</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="11-plot-multiple-shape-files.html">3. Plot multiple shapefiles</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="12-handling-spatial-projection-and-crs.html">4. Handling Spatial Projections &amp; CRS</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="13-intro-to-raster-data.html">5. Intro to Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="14-plot-raster-data.html">6. Plot Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="15-reproject-raster-data.html">7. Reproject Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="16-raster-calculations.html">8. Raster Calculations</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="17-work-with-multi-band-rasters.html">9. Work with Multi-Band Rasters</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-09-open-and-plot-vector-layers"><p>Content from <a href="09-open-and-plot-vector-layers.html">Open and Plot Vector Layers</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/09-open-and-plot-vector-layers.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I read, examine and visualize point, line and polygon vector
data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Know the difference between point, line, and polygon vector
data.</li>
<li>Load vector data into R.</li>
<li>Access the attributes of a vector object in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite<a class="anchor" aria-label="anchor" href="#prereq1"></a>
</h3>
<div class="callout-content">
<p>If you have not installed the <code>sf</code> package yet, run
<code>install.packages("sf")</code> first. Note that the <code>sf</code>
package has some external dependencies, namely GEOS, PROJ.4, GDAL and
UDUNITS, which need to be installed beforehand. Follow the workshop <a href="">setup instructions</a> for the installation of <code>sf</code>
and its dependencies.</p>
</div>
</div>
</div>
<p>First we need to load the packages we will use in this lesson. We
will use the packages <code>tidyverse</code> and <code>here</code> with
which you are already familiar from the previous lesson. In addition, we
need to load the <a href="https://r-spatial.github.io/sf/" class="external-link"><code>sf</code></a> package for
working with spatial vector data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>  <span class="co"># tools for wrangling, reshaping and visualizing data</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span>       <span class="co"># managing paths</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span>         <span class="co"># work with spatial vector data</span></span></code></pre>
</div>
<div id="the-sf-package" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-sf-package" class="callout-inner">
<h3 class="callout-title">The<code>sf</code>package<a class="anchor" aria-label="anchor" href="#the-sf-package"></a>
</h3>
<div class="callout-content">
<p><code>sf</code> stands for Simple Features which is a standard
defined by the Open Geospatial Consortium for storing and accessing
geospatial vector data. PostGIS uses the same standard; so those of you
who used PostGIS, might find some resemblances with the functions used
by the <code>sf</code> package.</p>
</div>
</div>
</div>
<section id="import-shapefiles"><h2 class="section-heading">Import shapefiles<a class="anchor" aria-label="anchor" href="#import-shapefiles"></a>
</h2>
<hr class="half-width">
<p>Let’s start by opening a shapefile. Shapefiles a common file format
to store spatial vector data used in GIS software. We will read a
shapefile with the administrative boundary of Delft with the function
<code>st_read()</code> from the <code>sf</code> package.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div id="all-sf-functions-start-with-st_" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="all-sf-functions-start-with-st_" class="callout-inner">
<h3 class="callout-title">All<code>sf</code>functions start with<code>st_</code><a class="anchor" aria-label="anchor" href="#all-sf-functions-start-with-st_"></a>
</h3>
<div class="callout-content">
<p>Note that all functions from the <code>sf</code> package start with
the standard prefix <code>st_</code> which stands for Spatial Type. This
is helpful in at least two ways: (1) it makes the interaction with or
translation to/from software using the simple features standard like
PostGIS easy, and (2) it allows for easy autocompletion of function
names in RStudio.</p>
</div>
</div>
</div>
</section><section id="spatial-metadata"><h2 class="section-heading">Spatial Metadata<a class="anchor" aria-label="anchor" href="#spatial-metadata"></a>
</h2>
<hr class="half-width">
<p>The <code>st_read()</code> function gave us a message with a summary
of metadata about the file that was read in. To examine the metadata in
more detail, we can use other, more specialised, functions from the
<code>sf</code> package. The <code>st_geometry_type()</code> function,
for instance, gives us information about the geometry type, which in
this case is <code>POLYGON</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POLYGON
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<p>The <code>st_crs()</code> function returns the coordinate reference
system (CRS) used by the shapefile, which in this case is
<code>WGS84</code> and has the unique reference code
<code>EPSG: 4326</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
<div id="examining-the-output-of-st_crs" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="examining-the-output-of-st_crs" class="callout-inner">
<h3 class="callout-title">Examining the output of<code>st_crs()</code><a class="anchor" aria-label="anchor" href="#examining-the-output-of-st_crs"></a>
</h3>
<div class="callout-content">
<p>As the output of <code>st_crs()</code> can be long, you can use
<code>$Name</code> and <code>$epsg</code> after the <code>crs()</code>
call to extract the projection name and EPSG code respectively.</p>
</div>
</div>
</div>
<p>The <code>st_bbox()</code> function shows the extent of the layer. As
<code>WGS84</code> is a <strong>geographic CRS</strong>, the extent of
the shapefile is displayed in degrees.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 4.320218 51.966316  4.407911 52.032599 </code></pre>
</div>
<p>We need a <strong>projected CRS</strong>, which in the case of the
Netherlands is typically the Amersfort / RD New projection. To reproject
our shapefile, we will use the <code>st_transform()</code> function. For
the <code>crs</code> argument we can use the EPSG code of the CRS we
want to use, which is <code>28992</code> for the
<code>Amersfort / RD New</code> projection.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">boundary_Delft</span>, <span class="fl">28992</span><span class="op">)</span></span>
<span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: EPSG:28992 
  wkt:
PROJCRS["Amersfoort / RD New",
    BASEGEOGCRS["Amersfoort",
        DATUM["Amersfoort",
            ELLIPSOID["Bessel 1841",6377397.155,299.1528128,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4289]],
    CONVERSION["RD New",
        METHOD["Oblique Stereographic",
            ID["EPSG",9809]],
        PARAMETER["Latitude of natural origin",52.1561605555556,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",5.38763888888889,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9999079,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",155000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",463000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting (X)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["northing (Y)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone."],
        BBOX[50.75,3.2,53.7,7.22]],
    ID["EPSG",28992]]</code></pre>
</div>
<p>Notice that the bounding box is measured in meters after the
transformation.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 81743.00 442446.21  87703.78 449847.95 </code></pre>
</div>
<p>We confirm the transformation by examining the reprojected
shapefile.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 81743 ymin: 442446.2 xmax: 87703.78 ymax: 449848
Projected CRS: Amersfoort / RD New
  osm_id                       geometry
1 324269 POLYGON ((87703.78 442651, ...</code></pre>
</div>
<div id="callout4" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout4"></a>
</h3>
<div class="callout-content">
<p>More about CRS in <a href="">Handling Spatial Projection &amp;
CRS</a>.</p>
</div>
</div>
</div>
</section><section id="plot-a-vector-layer"><h2 class="section-heading">Plot a vector layer<a class="anchor" aria-label="anchor" href="#plot-a-vector-layer"></a>
</h2>
<hr class="half-width">
<p>Now, let’s plot this shapefile. You are already familiar with the
<code>ggplot2</code> package from <a href="">Introduction to
Visualisation</a>. <code>ggplot2</code> has special <code>geom_</code>
functions for spatial data. We will use the <code>geom_sf()</code>
function for <code>sf</code> data.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"cyan1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Delft Administrative Boundary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span>  <span class="co"># this is needed to display the axes in meters</span></span></code></pre>
</div>
<figure><img src="fig/09-open-and-plot-vector-layers-rendered-unnamed-chunk-8-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1-import-line-and-point-vector-layers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-import-line-and-point-vector-layers" class="callout-inner">
<h3 class="callout-title">Challenge 1: Import line and point vector
layers<a class="anchor" aria-label="anchor" href="#challenge-1-import-line-and-point-vector-layers"></a>
</h3>
<div class="callout-content">
<p>Read in <code>delft-streets.shp</code> and
<code>delft-leisure.shp</code> and assign them to
<code>lines_Delft</code> and <code>point_Delft</code> respectively.
Answer the following questions:</p>
<ol style="list-style-type: decimal">
<li>What type of R spatial object is created when you import each
layer?</li>
<li>What is the CRS and extent for each object?</li>
<li>Do the files contain points, lines, or polygons?</li>
<li>How many features are in each file?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-streets.shp"</span><span class="op">)</span></span>
<span><span class="va">point_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-leisure.shp"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can check the type of data with the <code>class()</code> function
from base R. Both <code>lines_Delft</code> and <code>point_Delft</code>
are objects of class <code>"sf"</code>, which extends the
<code>"data.frame"</code> class.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "sf"         "data.frame"</code></pre>
</div>
<p><code>lines_Delft</code> and <code>point_Delft</code> are in the
correct CRS.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<p>When looking at the bounding boxes with the <code>st_bbox()</code>
function, we see the spatial extent of the two objects in a projected
CRS using meters as units. <code>lines_Delft()</code> and
<code>point_Delft</code> have similar extents.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 81759.58 441223.13  89081.41 449845.81 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 81863.21 442621.15  87370.15 449345.08 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Metadata for vector layers include geometry type, CRS, and
extent.</li>
<li>Load spatial objects into R with the <code>st_read()</code>
function.</li>
<li>Spatial objects can be plotted directly with <code>ggplot</code>
using the <code>geom_sf()</code> function. No need to convert to a data
frame.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-10-explore-and-plot-by-vector-layer-attributes"><p>Content from <a href="10-explore-and-plot-by-vector-layer-attributes.html">Explore and plot by vector layer attributes</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/10-explore-and-plot-by-vector-layer-attributes.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I examine the attributes of a vector layer?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li><p>Query attributes of a vector object.</p></li>
<li><p>Subset vector objects using specific attribute values.</p></li>
<li><p>Plot a vector feature, colored by unique attribute
values.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="query-vector-feature-metadata">Query Vector Feature Metadata<a class="anchor" aria-label="anchor" href="#query-vector-feature-metadata"></a>
</h1>
<p>Let’s have a look at the content of the loaded data, starting with
<code>lines_Delft</code>. In essence, an <code>"sf"</code> object is a
data.frame with a “sticky” geometry column and some extra metadata, like
the CRS, extent and geometry type we examined earlier.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 11244 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 81759.58 ymin: 441223.1 xmax: 89081.41 ymax: 449845.8
Projected CRS: Amersfoort / RD New
First 10 features:
    osm_id  highway                       geometry
1  4239535 cycleway LINESTRING (86399.68 448599...
2  4239536 cycleway LINESTRING (85493.66 448740...
3  4239537 cycleway LINESTRING (85493.66 448740...
4  4239620  footway LINESTRING (86299.01 448536...
5  4239621  footway LINESTRING (86307.35 448738...
6  4239674  footway LINESTRING (86299.01 448536...
7  4310407  service LINESTRING (84049.47 447778...
8  4310808    steps LINESTRING (84588.83 447828...
9  4348553  footway LINESTRING (84527.26 447861...
10 4348575  footway LINESTRING (84500.15 447255...</code></pre>
</div>
<p>This means that we can examine and manipulate them as data frames.
For instance, we can look at the number of variables (columns in a data
frame) with <code>ncol()</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>In the case of <code>point_Delft</code> those columns are
<code>"osm_id"</code>, <code>"highway"</code> and
<code>"geometry"</code>. We can check the names of the columns with the
base R function <code>names()</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "osm_id"   "highway"  "geometry"</code></pre>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>Note that in R the geometry is just another column and counts towards
the number returned by <code>ncol()</code>. This is different from GIS
software with graphical user interfaces, where the geometry is displayed
in a viewport not as a column in the attribute table.</p>
</div>
</div>
</div>
<p>We can also preview the content of the object by looking at the first
6 rows with the <code>head()</code> function, which is in the case of an
<code>sf</code> object the same as examining the object directly.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 85107.1 ymin: 448400.3 xmax: 86399.68 ymax: 449076.2
Projected CRS: Amersfoort / RD New
   osm_id  highway                       geometry
1 4239535 cycleway LINESTRING (86399.68 448599...
2 4239536 cycleway LINESTRING (85493.66 448740...
3 4239537 cycleway LINESTRING (85493.66 448740...
4 4239620  footway LINESTRING (86299.01 448536...
5 4239621  footway LINESTRING (86307.35 448738...
6 4239674  footway LINESTRING (86299.01 448536...</code></pre>
</div>
<div class="section level2">
<h2 id="explore-values-within-one-attribute">Explore values within one attribute<a class="anchor" aria-label="anchor" href="#explore-values-within-one-attribute"></a>
</h2>
<p>Using the <code>$</code> operator, we can examine the content of a
single field of our lines feature.</p>
<p>We can see the contents of the <code>highway</code> field of our
lines feature:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway" "cycleway" "cycleway" "footway"  "footway"  "footway" 
 [7] "service"  "steps"    "footway"  "footway" </code></pre>
</div>
<p>To see only unique values within the <code>highway</code> field, we
can use the <code>unique()</code> function. This function extracts all
possible values of a character variable.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"         
 [5] "residential"    "unclassified"   "construction"   "secondary"     
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"      
[13] "track"          "motorway"       "path"           "pedestrian"    
[17] "primary"        "bridleway"      "trunk"          "tertiary_link" 
[21] "services"       "secondary_link" "trunk_link"     "primary_link"  
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>R is also able to handle categorical variables called factors. With
factors, we can use the <code>levels()</code> function to show unique
values. To examine unique values of the <code>highway</code> variable
this way, we have to first transform it into a factor with the
<code>factor()</code> function:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "bridleway"      "busway"         "construction"   "cycleway"      
 [5] "footway"        "living_street"  "motorway"       "motorway_link" 
 [9] "path"           "pedestrian"     "platform"       "primary"       
[13] "primary_link"   "proposed"       "residential"    "secondary"     
[17] "secondary_link" "service"        "services"       "steps"         
[21] "tertiary"       "tertiary_link"  "track"          "trunk"         
[25] "trunk_link"     "unclassified"  </code></pre>
</div>
</div>
</div>
</div>
<div id="challenge-attributes-for-different-spatial-classes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-attributes-for-different-spatial-classes" class="callout-inner">
<h3 class="callout-title">Challenge: Attributes for different spatial
classes<a class="anchor" aria-label="anchor" href="#challenge-attributes-for-different-spatial-classes"></a>
</h3>
<div class="callout-content">
<!-- 3 minutes -->
<p>Explore the attributes associated with the <code>point_Delft</code>
spatial object.</p>
<ol style="list-style-type: decimal">
<li>How many attributes does it have?</li>
<li>What types of leisure points do the points represent? Give three
examples.</li>
<li>Which of the following is NOT an attribute of the
<code>point_Delft</code> data object?</li>
</ol>
<ol style="list-style-type: upper-alpha">
<li>location B) leisure C) osm_id</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To find the number of attributes, we use the <code>ncol()</code>
function:</li>
</ol>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>The types of leisure point are in the column named
<code>leisure</code>.</li>
</ol>
<p>Using the <code>head()</code> function which displays 6 rows by
default, we only see two values and <code>NA</code>s.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 83839.59 ymin: 443827.4 xmax: 84967.67 ymax: 447475.5
Projected CRS: Amersfoort / RD New
     osm_id      leisure                  geometry
1 472312297 picnic_table POINT (84144.72 443827.4)
2 480470725       marina POINT (84967.67 446120.1)
3 484697679         &lt;NA&gt; POINT (83912.28 447431.8)
4 484697682         &lt;NA&gt; POINT (83895.43 447420.4)
5 484697691         &lt;NA&gt;   POINT (83839.59 447455)
6 484697814         &lt;NA&gt; POINT (83892.53 447475.5)</code></pre>
</div>
<p>We can increase the number of rows with the n argument (e.g.,
<code>head(n = 10)</code> to show 10 rows) until we see at least three
distinct values in the leisure column. Note that printing an
<code>sf</code> object will also display the first 10 rows.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">point_Delft</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># you might be lucky to see three distinct values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 10 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 82485.72 ymin: 443827.4 xmax: 85385.25 ymax: 448341.3
Projected CRS: Amersfoort / RD New
       osm_id       leisure                  geometry
1   472312297  picnic_table POINT (84144.72 443827.4)
2   480470725        marina POINT (84967.67 446120.1)
3   484697679          &lt;NA&gt; POINT (83912.28 447431.8)
4   484697682          &lt;NA&gt; POINT (83895.43 447420.4)
5   484697691          &lt;NA&gt;   POINT (83839.59 447455)
6   484697814          &lt;NA&gt; POINT (83892.53 447475.5)
7   549139430        marina POINT (84479.99 446823.5)
8   603300994 sports_centre POINT (82485.72 445237.5)
9   883518959 sports_centre POINT (85385.25 448341.3)
10 1148515039    playground    POINT (84661.3 446818)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># point_Delft</span></span></code></pre>
</div>
<p>However, this is not a good approach as the first rows might still
have many <code>NA</code>s and three distinct values might still not be
present in the first <code>n</code> rows of the data frame. To remove
<code>NA</code>s, we can use the function <code>na.omit()</code> on the
leisure column to remove <code>NA</code>s completely. Note that we use
the <code>$</code> operator to examine the content of a single
variable.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">na.omit</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span><span class="op">)</span>  <span class="co"># this is better</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table"  "marina"        "marina"        "sports_centre"
[5] "sports_centre" "playground"   </code></pre>
</div>
<p>To show only unique values, we can use the <code>unique()</code>
function to only see the first occurrence of each distinct value (note
that <code>NA</code> will still be included once).</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">unique</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>   <span class="co"># this is even better</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table" "marina"       NA            </code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>To see a list of all attribute names, we can use the
<code>names()</code> function.</li>
</ol>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "osm_id"   "leisure"  "geometry"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="subset-features">Subset features<a class="anchor" aria-label="anchor" href="#subset-features"></a>
</h2>
<p>We can use the <code>filter()</code> function to select a subset of
features from a spatial object, just like with data frames. Let’s select
only cycleways from our street data.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleway_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span></code></pre>
</div>
<p>Our subsetting operation reduces the number of features from 11244 to
1397.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 11244</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">cycleway_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1397</code></pre>
</div>
<p>This can be useful, for instance, to calculate the total length of
cycleways.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleway_Delft</span> <span class="op">&lt;-</span> <span class="va">cycleway_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cycleway_Delft</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 81759.58 ymin: 441227.3 xmax: 87326.76 ymax: 449834.5
Projected CRS: Amersfoort / RD New
  total_length                       geometry
1 115550.1 [m] MULTILINESTRING ((86399.68 ...</code></pre>
</div>
<p>Now we can plot only the cycleways.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cycleway_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Slow mobility network in Delft"</span>, subtitle <span class="op">=</span> <span class="st">"Cycleways"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-17-1.png" alt="Map of cycleways in Delft." class="figure mx-auto d-block"><figcaption>
Map of cycleways in Delft.
</figcaption></figure><div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<!-- 7 minutes -->
<ol style="list-style-type: decimal">
<li>Create a new object that only contains the motorways in Delft.</li>
<li>How many features does the new object have?</li>
<li>What is the total length of motorways?</li>
<li>Plot the motorways.</li>
<li>Extra: follow the same steps with pedestrian streets.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To create the new object, we first need to see which value of the
<code>highway</code> column holds motorways. There is a value called
<code>motorway</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"         
 [5] "residential"    "unclassified"   "construction"   "secondary"     
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"      
[13] "track"          "motorway"       "path"           "pedestrian"    
[17] "primary"        "bridleway"      "trunk"          "tertiary_link" 
[21] "services"       "secondary_link" "trunk_link"     "primary_link"  
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<p>We extract only the features with the value
<code>motorway</code>.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">motorway_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"motorway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">motorway_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 48 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 84501.66 ymin: 442458.2 xmax: 87401.87 ymax: 449205.9
Projected CRS: Amersfoort / RD New
First 10 features:
      osm_id  highway                       geometry
1    7531946 motorway LINESTRING (87395.68 442480...
2    7531976 motorway LINESTRING (87401.87 442467...
3   46212227 motorway LINESTRING (86103.56 446928...
4  120945066 motorway LINESTRING (85724.87 447473...
5  120945068 motorway LINESTRING (85710.31 447466...
6  126548650 motorway LINESTRING (86984.12 443630...
7  126548651 motorway LINESTRING (86714.75 444772...
8  126548653 motorway LINESTRING (86700.23 444769...
9  126548654 motorway LINESTRING (86716.35 444766...
10 126548655 motorway LINESTRING (84961.78 448566...</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>There are 48 features with the value <code>motorway</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">motorway_Delft_length</span> <span class="op">&lt;-</span> <span class="va">motorway_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>The total length of motorways is 14877.4361477941.</li>
</ol>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">motorway_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 48</code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Plot the motorways</li>
</ol>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">motorway_Delft</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fast mobility network"</span>, subtitle <span class="op">=</span> <span class="st">"Motorways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-22-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><ol start="5" style="list-style-type: decimal">
<li>Same steps with pedestrian streets</li>
</ol>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pedestrian_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"pedestrian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pedestrian_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 82388.15 ymin: 444400.2 xmax: 85875.95 ymax: 447987.8
Projected CRS: Amersfoort / RD New
  total_length                       geometry
1 12778.84 [m] MULTILINESTRING ((85538.03 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">pedestrian_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 234</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pedestrian_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Slow mobility network"</span>, subtitle <span class="op">=</span> <span class="st">"Pedestrian"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-24-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="customize-plots">Customize plots<a class="anchor" aria-label="anchor" href="#customize-plots"></a>
</h2>
<p>Let’s say that we want to color different road types with different
colors and that we want to determine those colors.</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"         
 [5] "residential"    "unclassified"   "construction"   "secondary"     
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"      
[13] "track"          "motorway"       "path"           "pedestrian"    
[17] "primary"        "bridleway"      "trunk"          "tertiary_link" 
[21] "services"       "secondary_link" "trunk_link"     "primary_link"  
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<p>If we look at all the unique values of the highway field of our
street network we see more than 20 values. Let’s focus on a subset of
four values to illustrate the use of distinct colors. We use a piped
expression in which we only filter the rows of our data frame that have
one of the four given values <code>"motorway"</code>,
<code>"primary"</code>, <code>"secondary"</code>, and
<code>"cycleway"</code>. We also make sure that the highway column is a
factor column.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_types</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>, <span class="st">"cycleway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lines_Delft_selection</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">%in%</span> <span class="va">road_types</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>highway <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">highway</span>, levels <span class="op">=</span> <span class="va">road_types</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Next we define the four colors we want to use, one for each type of
road in our vector object. Note that in R you can use named colors like
<code>"blue"</code>, <code>"green"</code>, <code>"navy"</code>, and
<code>"purple"</code>. A full list of named colors can be listed with
the <code>colors()</code> function.</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"navy"</span>, <span class="st">"purple"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can use the defined color palette in ggplot.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Road network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-28-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div class="section level2">
<h2 id="adjust-line-width">Adjust line width<a class="anchor" aria-label="anchor" href="#adjust-line-width"></a>
</h2>
<p>Earlier we adjusted the line width universally. We can also adjust
line widths for every factor level. Note that in this case the
<code>size</code> argument, like the <code>color</code> argument, are
within the <code>aes()</code> mapping function. This means that the
values of that visual property will be mapped from a variable of the
object that is being plotted.</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_widths</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span>, linewidth <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span>,</span>
<span>       linewidth <span class="op">=</span> <span class="st">'Road Type'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_widths</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-30-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="plot-line-width-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plot-line-width-by-attribute" class="callout-inner">
<h3 class="callout-title">Plot line width by attribute<a class="anchor" aria-label="anchor" href="#plot-line-width-by-attribute"></a>
</h3>
<div class="callout-content">
<p>In the example above, we set the line widths to be 1, 0.75, 0.5, and
0.25. In our case line thicknesses are consistent with the hierarchy of
the selected road types, but in some cases we might want to show a
different hierarchy.</p>
<p>Let’s create another plot where we show the different line types with
the following thicknesses:</p>
<ul>
<li>motorways linewidth = 0.25</li>
<li>primary linewidth = 0.75</li>
<li>secondary linewidth = 0.5</li>
<li>cycleway linewidth = 1</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft_selection</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "motorway"  "primary"   "secondary" "cycleway" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_width</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_width</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways - Line width varies"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-33-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="add-plot-legend">Add plot legend<a class="anchor" aria-label="anchor" href="#add-plot-legend"></a>
</h2>
<p>Let’s add a legend to our plot. We will use the
<code>road_colors</code> object that we created above to color the
legend. We can customize the appearance of our legend by manually
setting different parameters.</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways - Default Legend"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-34-1.png" alt="Mobility network in Delft using thicker lines than the previous example." class="figure mx-auto d-block"><figcaption>
Mobility network in Delft using thicker lines than the previous example.
</figcaption></figure><div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>        legend.box.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways - Modified Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
generated.</code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-35-1.png" alt="Map of the mobility network in Delft with large-font and border around the legend." class="figure mx-auto d-block"><figcaption>
Map of the mobility network in Delft with large-font and border around
the legend.
</figcaption></figure><div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"springgreen"</span>, <span class="st">"blue"</span>, <span class="st">"magenta"</span>, <span class="st">"orange"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">new_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Road Type'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>        legend.box.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Cycleways - Modified Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-36-1.png" alt="Map of the mobility network in Delft using a different color palette." class="figure mx-auto d-block"><figcaption>
Map of the mobility network in Delft using a different color palette.
</figcaption></figure><div id="plot-lines-by-attributes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plot-lines-by-attributes" class="callout-inner">
<h3 class="callout-title">Plot lines by attributes<a class="anchor" aria-label="anchor" href="#plot-lines-by-attributes"></a>
</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a plot that emphasizes only roads where bicycles are allowed.
To emphasize this, make the lines where bicycles are not allowed THINNER
than the roads where bicycles are allowed. Be sure to add a title and
legend to your map. You might consider a color palette that has all
bike-friendly roads displayed in a bright color. All other lines can be
black.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">lines_Delft_selection</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "factor"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "bridleway"      "busway"         "construction"   "cycleway"      
 [5] "footway"        "living_street"  "motorway"       "motorway_link" 
 [9] "path"           "pedestrian"     "platform"       "primary"       
[13] "primary_link"   "proposed"       "residential"    "secondary"     
[17] "secondary_link" "service"        "services"       "steps"         
[21] "tertiary"       "tertiary_link"  "track"          "trunk"         
[25] "trunk_link"     "unclassified"  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, create a data frame with only those roads where bicycles are allowed</span></span>
<span><span class="va">lines_Delft_bicycle</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Next, visualise using ggplot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_bicycle</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="st">"magenta"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network in Delft"</span>, subtitle <span class="op">=</span> <span class="st">"Roads dedicated to Bikes"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-39-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="plot-polygon-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plot-polygon-by-attribute" class="callout-inner">
<h3 class="callout-title">Plot polygon by attribute<a class="anchor" aria-label="anchor" href="#plot-polygon-by-attribute"></a>
</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a map of the municipal boundaries in the Netherlands using the
data located in your data folder: <code>nl-gemeenten.shp</code>. Apply a
line color to each state using its region value. Add a legend.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">municipal_boundaries_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"nl-gemeenten.shp"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-gemeenten' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-gemeenten.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 344 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">municipal_boundaries_NL</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Classes 'sf' and 'data.frame':	344 obs. of  7 variables:
 $ identifica: chr  "GM0014" "GM0034" "GM0037" "GM0047" ...
 $ naam      : chr  "Groningen" "Almere" "Stadskanaal" "Veendam" ...
 $ code      : chr  "0014" "0034" "0037" "0047" ...
 $ ligtInProv: chr  "20" "24" "20" "20" ...
 $ ligtInPr_1: chr  "Groningen" "Flevoland" "Groningen" "Groningen" ...
 $ fuuid     : chr  "gemeentegebied.ee21436e-5a2d-4a8f-b2bf-113bddd028fc" "gemeentegebied.6e4378d7-0905-4dff-b351-57c1940c9c90" "gemeentegebied.515fbfe4-614e-463d-8b8c-91d35ca93b3b" "gemeentegebied.a3e71341-218c-44bf-ba12-01e2251ea2f6" ...
 $ geometry  :sfc_MULTIPOLYGON of length 344; first list element: List of 1
  ..$ :List of 1
  .. ..$ : num [1:4749, 1:2] 238742 238741 238740 238738 238735 ...
  ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA
  ..- attr(*, "names")= chr [1:6] "identifica" "naam" "code" "ligtInProv" ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">municipal_boundaries_NL</span><span class="op">$</span><span class="va">ligtInPr_1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Drenthe"       "Flevoland"     "Fryslân"       "Gelderland"   
 [5] "Groningen"     "Limburg"       "Noord-Brabant" "Noord-Holland"
 [9] "Overijssel"    "Utrecht"       "Zeeland"       "Zuid-Holland" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundaries_NL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">ligtInPr_1</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-explore-and-plot-by-vector-layer-attributes-rendered-unnamed-chunk-42-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li><p>Spatial objects in <code>sf</code> are similar to standard data
frames and can be manipulated using the same functions.</p></li>
<li><p>Almost any feature of a plot can be customized using the various
functions and options in the <code>ggplot2</code> package.</p></li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div></section><section id="aio-11-plot-multiple-shape-files"><p>Content from <a href="11-plot-multiple-shape-files.html">Plot multiple shapefiles</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/11-plot-multiple-shape-files.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create map compositions with custom legends using
ggplot?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Plot multiple vector layers in the same plot.</li>
<li>Apply custom symbols to spatial objects in a plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode builds upon the <a href="">previous episode</a> to work
with vector layers in R and explore how to plot multiple vector
layers.</p>
<section id="load-the-data"><h2 class="section-heading">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>To work with vector data in R, we can use the <code>sf</code>
library. The <code>terra</code> package also allows us to explore
metadata using similar commands for both raster and vector files. Make
sure that you have these packages loaded.</p>
<p>We will continue to work with the three ESRI shapefiles that we
loaded in the <a href="">Open and Plot Vector Layers</a> episode.</p>
</section><section id="plotting-multiple-vector-layers"><h2 class="section-heading">Plotting Multiple Vector Layers<a class="anchor" aria-label="anchor" href="#plotting-multiple-vector-layers"></a>
</h2>
<hr class="half-width">
<p>So far we learned how to plot information from a single shapefile and
do some plot customization. What if we want to create a more complex
plot with many shapefiles and unique symbols that need to be represented
clearly in a legend?</p>
<p>We will create a plot that combines our leisure locations
(<code>point_Delft</code>), municipal boundary
(<code>boundary_Delft</code>) and streets (<code>lines_Delft</code>)
spatial objects. We will need to build a custom legend as well.</p>
<p>To begin, we will create a plot with the site boundary as the first
layer. Then layer the leisure locations and street data on top using
<code>+</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Next, let’s build a custom legend using the symbology (the colors and
symbols) that we used to create the plot above. For example, it might be
good if the lines were symbolized as lines. In the previous episode, you
may have noticed that the default legend behavior for
<code>geom_sf</code> is to draw a ‘patch’ for each legend entry. If you
want the legend to draw lines or points, you need to add an instruction
to the <code>geom_sf</code> call - in this case,
<code>show.legend = 'line'</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leisure_colors</span> <span class="op">&lt;-</span> <span class="fu">rainbow</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span>, name <span class="op">=</span> <span class="st">"Road Type"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">leisure_colors</span>, name <span class="op">=</span> <span class="st">"Lesiure Location"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network and leisure in Delft"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">22</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span>, name <span class="op">=</span> <span class="st">"Line Type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">leisure_colors</span>, name <span class="op">=</span> <span class="st">"Leisure Location"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network and leisure in Delft"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We notice that there are quite some playgrounds in the residential
parts of Delft, whereas on campus there is a concentration of picnic
tables. So that is what our next challenge is about.</p>
<div class="section level3">
<h3 id="challenge-7-5-minutes">Challenge 7 (5 minutes)<a class="anchor" aria-label="anchor" href="#challenge-7-5-minutes"></a>
</h3>
<p>Create a map of leisure locations only including
<code>playground</code> and <code>picnic_table</code>, with each point
colored by the leisure type. Overlay this layer on top of the
<code>lines_Delft</code> layer (the streets). Create a custom legend
that applies line symbols to lines and point symbols to the points.</p>
<p>Modify the plot above. Tell R to plot each point, using a different
symbol of shape value.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leisure_locations_selection</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-leisure.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">leisure</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"playground"</span>, <span class="st">"picnic_table"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-leisure' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-leisure.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 298 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 81863.21 ymin: 442621.1 xmax: 87370.15 ymax: 449345.1
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">leisure_locations_selection</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table" "playground"  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blue_orange</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="st">"darkorange"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">leisure_locations_selection</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, </span>
<span>          shape <span class="op">=</span> <span class="fl">21</span>, show.legend <span class="op">=</span> <span class="st">'point'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Type"</span>, values <span class="op">=</span> <span class="va">road_colors</span>,</span>
<span>     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"solid"</span>, shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Soil Type"</span>, values <span class="op">=</span> <span class="va">blue_orange</span>,</span>
<span>     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"blank"</span>, shape <span class="op">=</span> <span class="fl">21</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Traffic and leisure"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">leisure_locations_selection</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span>, shape <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Leisure Type"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Type"</span>, values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Leisure Type"</span>, values <span class="op">=</span> <span class="fu">rainbow</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"blank"</span>, shape <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span>,</span>
<span>     color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Road network and leisure"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-plot-multiple-shape-files-rendered-unnamed-chunk-8-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><!-- End of challenge --><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>+</code> operator to add multiple layers to a
ggplot.</li>
<li>A plot can be a combination of multiple vector layers.</li>
<li>Use the <code>show.legend</code> argument to set legend symbol
types.</li>
<li>Use the <code>scale_fill_manual()</code> function to set legend
colors.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></section><section id="aio-12-handling-spatial-projection-and-crs"><p>Content from <a href="12-handling-spatial-projection-and-crs.html">Handling Spatial Projections &amp; CRS</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/12-handling-spatial-projection-and-crs.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What do I do when vector data don’t line up?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Plot vector objects with different CRSs in the same plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="working-with-spatial-data-from-different-sources"><h2 class="section-heading">Working with spatial data from different sources<a class="anchor" aria-label="anchor" href="#working-with-spatial-data-from-different-sources"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">municipal_boundary_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-gemeenten.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-gemeenten' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-gemeenten.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 344 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can add a country boundary layer to make it look nicer. If we
specify a thicker line width using size = 2 for the country boundary
layer, it will make our map pop!</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_boundary_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-boundary' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-boundary.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_NL</span>, color <span class="op">=</span> <span class="st">"gray18"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span>, color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># st_crs(point_Delft)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">municipal_boundary_NL</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">country_boundary_NL</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-boundary' from data source 
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-boundary.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 4.320218 ymin: 51.96632 xmax: 4.407911 ymax: 52.0326
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4326</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">boundary_Delft</span>, <span class="fl">28992</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_NL</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span>, color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, color <span class="op">=</span> <span class="st">"purple"</span>, fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="plot-multiple-layers-of-spatial-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plot-multiple-layers-of-spatial-data" class="callout-inner">
<h3 class="callout-title">Plot multiple layers of spatial data<a class="anchor" aria-label="anchor" href="#plot-multiple-layers-of-spatial-data"></a>
</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a map of South Holland as follows:</p>
<ol style="list-style-type: decimal">
<li>Import and plot <code>nl-gemeenten.shp</code>. Adjust line width as
necessary.</li>
<li>Layer the boundary of Delft onto the plot.</li>
<li>Add a title.</li>
<li>Add a legend that shows both the province boundaries (as a line) and
the boundary of Delft (as a filled polygon).</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_ZH</span> <span class="op">&lt;-</span> <span class="va">municipal_boundary_NL</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">ligtInPr_1</span> <span class="op">==</span> <span class="st">"Zuid-Holland"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_ZH</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span><span class="st">"color"</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, labels <span class="op">=</span> <span class="st">"Municipal Boundaries in South Holland"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"color"</span> <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, <span class="fu">aes</span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"shape"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"purple"</span>, fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, labels <span class="op">=</span> <span class="st">"Municipality of Delft"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"shape"</span> <span class="op">=</span> <span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Delft location"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-handling-spatial-projection-and-crs-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="export-a-shapefile"><h2 class="section-heading">Export a shapefile<a class="anchor" aria-label="anchor" href="#export-a-shapefile"></a>
</h2>
<hr class="half-width">
<p>To save a file, use the <code>st_write()</code> function from the
<code>sf</code> package.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(leisure_locations_selection,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data/leisure_locations_selection.shp"</span>), driver <span class="ot">=</span> <span class="st">"ESRI Shapefile"</span><span class="er">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<code>ggplot2</code> automatically converts all objects in a plot to
the same CRS.</li>
<li>Still be aware of the CRS and extent for each object.</li>
<li>You can export an <code>sf</code> object to a shapefile with
<code>st_write()</code>.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-13-intro-to-raster-data"><p>Content from <a href="13-intro-to-raster-data.html">Intro to Raster Data</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/13-intro-to-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a raster dataset?</li>
<li>How do I work with and plot raster data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Explore raster attributes and metadata using R.</li>
<li>Import rasters into R using the <code>terra</code> package.</li>
<li>Plot a raster file in R using the <code>ggplot2</code> package.</li>
<li>Describe the difference between single- and multi-band rasters.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>In this lesson, we will work with raster data. We will start with an
introduction of the fundamental principles and metadata needed to work
with raster data in R. We will discuss some of the core metadata
elements needed to understand raster data in R, including CRS and
resolution.</p>
<p>We continue to work with the <code>tidyverse</code> package and we
will use the <code>terra</code> package to work with raster data. Make
sure that you have those packages loaded.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-data-used-in-this-lesson" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-data-used-in-this-lesson" class="callout-inner">
<h3 class="callout-title">The data used in this lesson<a class="anchor" aria-label="anchor" href="#the-data-used-in-this-lesson"></a>
</h3>
<div class="callout-content">
<p>In this and lesson, we will use:</p>
<ul>
<li>data extracted from the <a href="https://www.ahn.nl/" class="external-link">AHN digital
elevation dataset of the Netherlands</a> for the TU Delft campus area;
and</li>
<li>high-resolution RGB aerial photos of the TU Delft library obtained
from <a href="https://www.beeldmateriaal.nl/download-luchtfotos" class="external-link">Beeldmateriaal
Nederland</a>.</li>
</ul>
</div>
</div>
</div>
<section id="view-raster-file-attributes"><h2 class="section-heading">View Raster File Attributes<a class="anchor" aria-label="anchor" href="#view-raster-file-attributes"></a>
</h2>
<hr class="half-width">
<p>We will be working with a series of GeoTIFF files in this lesson. The
GeoTIFF format contains a set of embedded tags with metadata about the
raster data. We can use the function <code>describe()</code> from the
<code>terra</code> package to get information about our raster data
before we read that data into R. It is recommended to do this before
importing your data. We first examine the file
<code>tud-dsm-5m.tif</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dsm-5m.tif"                                                                                            
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<p>We will be using this information throughout this episode. By the end
of the episode, you will be able to explain and understand the output
above.</p>
</section><section id="open-a-raster-in-r"><h2 class="section-heading">Open a Raster in R<a class="anchor" aria-label="anchor" href="#open-a-raster-in-r"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve previewed the metadata for our GeoTIFF, let’s import
this raster dataset into R and explore its metadata more closely. We can
use the <code>rast()</code> function to import a raster file in R.</p>
<div id="data-tip---object-names" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---object-names" class="callout-inner">
<h3 class="callout-title">Data tip - Object names<a class="anchor" aria-label="anchor" href="#data-tip---object-names"></a>
</h3>
<div class="callout-content">
<p>To improve code readability, use file and object names that make it
clear what is in the file. The raster data for this episode contain the
TU Delft campus and its surroundings so we’ll use a naming convention of
<code>datatype_TUD</code>. The first object is a Digital Surface Model
(DSM) in GeoTIFF format stored in a file <code>tud-dsm-5m.tif</code>
which we will load into an object named according to our naming
convention <code>DSM_TUD</code>.</p>
</div>
</div>
</div>
<p>First we will load our raster file into R and view the data
structure.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span>
<span><span class="va">DSM_TUD</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 386, 722, 1  (nrow, ncol, nlyr)
resolution  : 5, 5  (x, y)
extent      : 83565, 87175, 445250, 447180  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992) 
source      : tud-dsm-5m.tif 
name        : tud-dsm-5m </code></pre>
</div>
<p>The information above includes a report on dimension, resolution,
extent and CRS, but no information about the values. Similar to other
data structures in R like vectors and data frame columns, descriptive
statistics for raster data can be retrieved with the
<code>summary()</code> function.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: [summary] used a sample</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   tud.dsm.5m     
 Min.   :-5.2235  
 1st Qu.:-0.7007  
 Median : 0.5462  
 Mean   : 2.5850  
 3rd Qu.: 4.4596  
 Max.   :89.7838  </code></pre>
</div>
<p>This output gives us information about the range of values in the
DSM. We can see, for instance, that the lowest elevation is
<code>-5.2235</code>, the highest is <code>89.7838</code>. But note the
warning. Unless you force R to calculate these statistics using every
cell in the raster, it will take a random sample of 100,000 cells and
calculate from them instead. To force calculation all the values, you
can use the function <code>values</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   tud-dsm-5m     
 Min.   :-5.3907  
 1st Qu.:-0.7008  
 Median : 0.5573  
 Mean   : 2.5886  
 3rd Qu.: 4.4648  
 Max.   :92.0810  </code></pre>
</div>
<p>With a summary on all cells of the raster, the values range from a
smaller minimum of <code>-5.3907</code> to a higher maximum of
<code>92.0910</code>.</p>
<p>To visualise the DSM in R using <code>ggplot2</code>, we need to
convert it to a data frame. We learned about data frames in an <a href="03-explore-data.html">earlier lesson</a>. The <code>terra</code>
package has the built-in function <code>as.data.frame()</code> for
conversion to a data frame.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now when we view the structure of our data, we will see a standard
data frame format.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	278692 obs. of  3 variables:
 $ x         : num  83568 83572 83578 83582 83588 ...
 $ y         : num  447178 447178 447178 447178 447178 ...
 $ tud-dsm-5m: num  10.34 8.64 1.25 1.12 2.13 ...</code></pre>
</div>
<p>We can use <code>ggplot()</code> to plot this data with a specific
<code>geom_</code> function called <code>geom_raster()</code>. We will
make the colour scale in our plot colour-blindness friendly with
<code>scale_fill_viridis_c</code>, introduced in an <a href="04-intro-to-visualisation.html">earlier lesson</a>. We will also
use the <code>coord_quickmap()</code> function to use an approximate
Mercator projection for our plots. This approximation is suitable for
small areas that are not too close to the poles. Other coordinate
systems are available in <code>ggplot2</code> if needed, you can learn
about them at their help page <code>?coord_map</code>.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># `option = "H"` provides a contrasting colour scale</span></span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-intro-to-raster-data-rendered-first-rast-plot-1.png" alt="Raster plot with `ggplot2` using the viridis color scale" class="figure mx-auto d-block"><figcaption>
Raster plot with <code>ggplot2</code> using the viridis color scale
</figcaption></figure><div id="plotting-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip" class="callout-inner">
<h3 class="callout-title">Plotting tip<a class="anchor" aria-label="anchor" href="#plotting-tip"></a>
</h3>
<div class="callout-content">
<p>More information about the viridis palette used above at <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html" class="external-link">viridis
package documentation</a>.</p>
</div>
</div>
</div>
<div id="plotting-tip-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip-1" class="callout-inner">
<h3 class="callout-title">Plotting tip<a class="anchor" aria-label="anchor" href="#plotting-tip-1"></a>
</h3>
<div class="callout-content">
<p>For faster previews, you can use the <code>plot()</code> function on
a <code>terra</code> object.</p>
</div>
</div>
</div>
<p>This map shows our Digital Surface Model, that is, the elevation of
our study site including buildings and vegetation. From the legend we
can confirm that the maximum elevation is around 90, but we cannot tell
whether this is 90 feet or 90 meters because the legend doesn’t show us
the units. We can look at the metadata of our object to see what the
units are. Much of the metadata that we’re interested in is part of the
CRS.</p>
<p>Now we will see how features of the CRS appear in our data file and
what meanings they have.</p>
</section><section id="view-raster-coordinate-reference-system-crs-in-r"><h2 class="section-heading">View Raster Coordinate Reference System (CRS) in R<a class="anchor" aria-label="anchor" href="#view-raster-coordinate-reference-system-crs-in-r"></a>
</h2>
<hr class="half-width">
<p>We can view the CRS string associated with our R object using the
<code>crs()</code> function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DSM_TUD</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=sterea +lat_0=52.1561605555556 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs"</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>What units are our data in?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><code>+units=m</code> in the output of the code above tells us that
our data is in meters (m).</p>
</div>
</div>
</div>
</div>
<div id="understanding-crs-in-proj.4-format" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="understanding-crs-in-proj.4-format" class="callout-inner">
<h3 class="callout-title">Understanding CRS in PROJ.4 format<a class="anchor" aria-label="anchor" href="#understanding-crs-in-proj.4-format"></a>
</h3>
<div class="callout-content">
<p>The CRS for our data is given to us by R in PROJ.4 format. Let’s
break down the pieces of a PROJ.4 string. The string contains all of the
individual CRS elements that R or another GIS might need. Each element
is specified with a <code>+</code> sign, similar to how a
<code>.csv</code> file is delimited or broken up by a <code>,</code>.
After each <code>+</code> we see the CRS element such as projection
(<code>proj=</code>) being defined.</p>
<p>See more about CRS and PROJ.4 strings in <a href="https://datacarpentry.org/organization-geospatial/03-crs" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
</section><section id="calculate-raster-min-and-max-values"><h2 class="section-heading">Calculate Raster Min and Max values<a class="anchor" aria-label="anchor" href="#calculate-raster-min-and-max-values"></a>
</h2>
<hr class="half-width">
<p>It is useful to know the minimum and maximum values of a raster
dataset. In this case, as we are working with elevation data, these
values represent the min/max elevation range at our site.</p>
<p>Raster statistics are often calculated and embedded in a GeoTIFF for
us. We can view these values:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">minmax</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    tud-dsm-5m
min        Inf
max       -Inf</code></pre>
</div>
<div id="data-tip---set-min-and-max-values" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---set-min-and-max-values" class="callout-inner">
<h3 class="callout-title">Data tip - Set min and max values<a class="anchor" aria-label="anchor" href="#data-tip---set-min-and-max-values"></a>
</h3>
<div class="callout-content">
<p>If the <code>min</code> and <code>max</code> values are
<code>Inf</code> and <code>-Inf</code> respectively, it means that they
haven’t been calculated. We can calculate them using the
<code>setMinMax()</code> function.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD</span> <span class="op">&lt;-</span> <span class="fu">setMinMax</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -5.39069</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 92.08102</code></pre>
</div>
<p>We can see that the elevation at our site ranges from
<code>-5.39069</code>m to <code>92.08102</code>m.</p>
</section><section id="raster-bands"><h2 class="section-heading">Raster bands<a class="anchor" aria-label="anchor" href="#raster-bands"></a>
</h2>
<hr class="half-width">
<p>The Digital Surface Model object (<code>DSM_TUD</code>) that we’ve
been working with is a single band raster. This means that there is only
one dataset stored in the raster: surface elevation in meters for one
time period.</p>
<figure><img src="https://datacarpentry.org/r-raster-vector-geospatial/fig/dc-spatial-raster/single_multi_raster.png" class="figure mx-auto d-block"></figure><p>A raster dataset can contain one or more bands. We can view the
number of bands in a raster using the <code>nlyr()</code> function.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlyr</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<p>This dataset has only 1 band. However, raster data can also be
multi-band, meaning that one raster file contains data for more than one
variable or time period for each cell. We will discuss multi-band raster
data in a <a href="..episodes/17-work-with-multi-band-rasters.html">later
episode</a>.</p>
</section><section id="creating-a-histogram-of-raster-values"><h2 class="section-heading">Creating a histogram of raster values<a class="anchor" aria-label="anchor" href="#creating-a-histogram-of-raster-values"></a>
</h2>
<hr class="half-width">
<p>A histogram can be used to inspect the distribution of raster values
visually. It can show if there are values above the max or below the min
of the expected range.</p>
<p>We can inspect the distribution of values contained in a raster using
the <code>ggplot2</code> function <code>geom_histogram()</code>.
Histograms are often useful in identifying outliers and bad data values
in our raster data.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/13-intro-to-raster-data-rendered-rast-hist-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice that a message is displayed when R creates the histogram:</p>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p>This message is caused by a default setting in
<code>geom_histogram()</code> enforcing that there are 30 bins for the
data. We can define the number of bins we want in the histogram by
giving another value to the <code>bins</code> argument. 60 bins, for
instance, will give a more detailed histogram of the same
distribution:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/13-intro-to-raster-data-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that the shape of this histogram looks similar to the previous
one that was created using the default of 30 bins. The distribution of
elevation values for our Digital Surface Model (DSM) looks reasonable.
It is likely that there are no bad data values in this particular
raster.</p>
<div id="challenge-explore-raster-metadata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-explore-raster-metadata" class="callout-inner">
<h3 class="callout-title">Challenge: Explore raster metadata<a class="anchor" aria-label="anchor" href="#challenge-explore-raster-metadata"></a>
</h3>
<div class="callout-content">
<p>Use <code>describe()</code> to determine the following about the
<code>tud-dsm-hill.tif</code> file:</p>
<ol style="list-style-type: decimal">
<li>Does this file have the same CRS as <code>DSM_TUD</code>?</li>
<li>What is the resolution of the raster data?</li>
<li>How large would a 5x5 pixel area be on the Earth’s surface?</li>
<li>Is the file a multi- or single-band raster?</li>
</ol>
<p>Note that this file is a hillshade raster. We will learn about
hillshades in the <a href="17-work-with-multi-band-rasters.html">Working
with Multi-band Rasters in R</a> episode.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m-hill.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dsm-5m-hill.tif"                                                                                       
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x11 Type=Byte, ColorInterp=Gray"                                                                       
[57] "  NoData Value=0"                                                                                                      </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="more-resources" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-resources" class="callout-inner">
<h3 class="callout-title">More resources<a class="anchor" aria-label="anchor" href="#more-resources"></a>
</h3>
<div class="callout-content">
<ul>
<li>See the manual and tutorials of the <code>terra</code> package on <a href="https://rspatial.org/" class="external-link">https://rspatial.org/</a>.</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The GeoTIFF file format includes metadata about the raster
data.</li>
<li>To plot raster data with the <code>ggplot2</code> package, we need
to convert them to data frames.</li>
<li>R stores CRS information in the PROJ.4 format.</li>
<li>Histograms are useful to identify missing or bad data values.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-14-plot-raster-data"><p>Content from <a href="14-plot-raster-data.html">Plot Raster Data</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/14-plot-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create categorized or customized maps of raster data?</li>
<li>How can I customize the colour scheme of a raster image?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Build customized plots for a single band raster using the
<code>ggplot2</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>In this part, we will plot our raster object using
<code>ggplot2</code> with customized coloring schemes. We will continue
working with the Digital Surface Model (DSM) raster from the <a href="13-intro-to-raster-data.html">previous episode</a>.</p>
<div class="section level3">
<h3 id="plotting-data-using-breaks">Plotting Data Using Breaks<a class="anchor" aria-label="anchor" href="#plotting-data-using-breaks"></a>
</h3>
<p>In the previous plot, our DSM was coloured with a continuous colour
range. For clarity and visibility, we may prefer to view the data
“symbolized” or coloured according to ranges of values. This is
comparable to a “classified” map. For that, we need to tell
<code>ggplot()</code> how many groups to break our data into and where
those breaks should be. To make these decisions, it is useful to first
explore the distribution of the data using a bar plot. To begin with, we
will use <code>dplyr</code>’s <code>mutate()</code> function combined
with <code>cut()</code> to split the data into 3 bins.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To see the cut-off values for the groups, we can ask for the levels
of <code>fct_elevation</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-5.49,27.1]" "(27.1,59.6]"  "(59.6,92.2]" </code></pre>
</div>
<p>And we can get the count of values (that is, number of pixels) in
each group using <code>dplyr</code>’s <code>count()</code> function:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  fct_elevation      n
1  (-5.49,27.1] 277100
2   (27.1,59.6]   1469
3   (59.6,92.2]    123</code></pre>
</div>
<p>We might prefer to customize the cut-off values for these groups.
Lets round the cut-off values so that we have groups for the ranges of
-10 - 0m, 0 - 5m, and 5 - 100m. To implement this we will give
<code>cut()</code> a numeric vector of break points instead of the
number of breaks we want.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_cb <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation_cb</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-10,0]" "(0,5]"   "(5,100]"</code></pre>
</div>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>Note that 4 break values will result in 3 bins of data.</p>
<p>The bin intervals are shown using <code>(</code> to mean exclusive
and <code>]</code> to mean inclusive. For example: (0, 10] means “from 0
through 10”.</p>
</div>
</div>
</div>
<p>And now we can plot our bar plot again, using the new groups:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And we can get the count of values in each group in the same way we
did before:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">fct_elevation_cb</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  fct_elevation_cb      n
1          (-10,0] 113877
2            (0,5] 101446
3          (5,100]  63369</code></pre>
</div>
<p>We can use those groups to plot our raster data, with each group
being a different colour:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure">
The plot above uses the default colours inside <code>ggplot2</code> for
raster objects. We can specify our own colours to make the plot look a
little nicer. R has a built in set of colours for plotting terrain,
which are built in to the <code>terrain.colors()</code> function. Since
we have three bins, we want to create a 3-colour palette:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "#00A600" "#ECB176" "#F2F2F2"</code></pre>
</div>
<p>The <code>terrain.colors()</code> function returns hex colours - each
of these character strings represents a colour. To use these in our map,
we pass them across using the <code>scale_fill_manual()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<section id="more-plot-formatting"><h2 class="section-heading">More Plot Formatting<a class="anchor" aria-label="anchor" href="#more-plot-formatting"></a>
</h2>
<hr class="half-width">
<p>If we need to create multiple plots using the same colour palette, we
can create an R object (<code>my_col</code>) for the set of colours that
we want to use. We can then quickly change the palette across all plots
by modifying the <code>my_col</code> object, rather than each individual
plot.</p>
<p>We can give the legend a more meaningful title by passing a value to
the <code>name</code> argument of the <code>scale_fill_manual()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure">
The axis labels x and y are not necessary, so we can turn them off by
passing <code>element_blank()</code> to the relevant part of the
<code>theme()</code> function.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-plot-using-custom-breaks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-using-custom-breaks" class="callout-inner">
<h3 class="callout-title">Challenge: Plot Using Custom Breaks<a class="anchor" aria-label="anchor" href="#challenge-plot-using-custom-breaks"></a>
</h3>
<div class="callout-content">
<p>Create a plot of the TU Delft Digital Surface Model
(<code>DSM_TUD</code>) that has:</p>
<ol style="list-style-type: decimal">
<li>Six classified ranges of values (break points) that are evenly
divided among the range of pixel values.</li>
<li>A plot title.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_6 <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation_6</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-5.49,10.9]" "(10.9,27.1]"  "(27.1,43.3]"  "(43.3,59.6]"  "(59.6,75.8]" 
[6] "(75.8,92.2]" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       fill <span class="op">=</span> <span class="va">fct_elevation_6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Elevation Classes of the Digital Surface Model (DSM)"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-plot-raster-data-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Continuous data ranges can be grouped into categories using
<code>mutate()</code> and <code>cut()</code>.</li>
<li>Use the built-in <code>terrain.colors()</code> or set your preferred
colour scheme manually.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-15-reproject-raster-data"><p>Content from <a href="15-reproject-raster-data.html">Reproject Raster Data</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/15-reproject-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I work with raster data sets that are in different
projections?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Reproject a raster in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>Sometimes we encounter raster datasets that do not “line up” when
plotted or analysed. Rasters that don’t line up are most often in
different Coordinate Reference Systems (CRS). This episode explains how
to deal with rasters in different CRS. It will walk through reprojecting
rasters in R using the <code>project()</code> function in the
<code>terra</code> package.</p>
<section id="raster-projection"><h2 class="section-heading">Raster Projection<a class="anchor" aria-label="anchor" href="#raster-projection"></a>
</h2>
<hr class="half-width">
<p>For this episode, we will be working with the Digital Terrain Model
data. This differs from the surface model data we’ve been working with
so far in that the digital surface model (DSM) includes the tops of
trees and buildings, while the digital terrain model (DTM) shows the
ground level.</p>
<p>We’ll be looking at another model (the canopy/building height model,
or CHM) in <a href="16-raster-calculations.html">a later episode</a> and
will see how to calculate the CHM from the DSM and DTM. Here, we will
create a map of the Digital Terrain Model (<code>DTM_TUD</code>) of TU
Delft and its surrounding draped (or layered) on top of the hillshade
(<code>DTM_hill_TUD</code>).</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<p>We can layer a raster on top of a hillshade raster for the same area,
and use a transparency factor to create a 3-dimensional shaded effect. A
hillshade is a raster that maps the terrain using light and shadow to
create a 3D-looking image that you would see from above when viewing the
terrain. We will add a custom colour, making the plot grey.</p>
<p>Read more about layering raster <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/02-raster-plot.html#layering-rasters" class="external-link">here</a>.</p>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Reproject a raster in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>First, we need to import the DTM and DTM hillshade data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dtm-5m.tif"</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dtm-5m-hill-WGS84.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, we will convert each of these datasets to a data frame for
plotting with <code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can create a map of the DTM layered over the hillshade.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_df</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure">
Our results are curious - neither the Digital Terrain Model
(<code>DTM_TUD_df</code>) nor the DTM Hillshade
(<code>DTM_hill_TUD_df</code>) plotted. Let’s try to plot the DTM on its
own to make sure there are data there.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Our DTM seems to contain data and plots just fine.</p>
<p>Next we plot the DTM Hillshade on its own to see whether everything
is OK.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we look at the axes, we can see that the units, and therefore the
projections, of the two rasters are different. When this is the case,
<code>ggplot2</code> won’t render the image. It won’t even throw an
error message to tell you something has gone wrong. We can look at
Coordinate Reference Systems (CRSs) of the DTM and the hillshade data to
see how they differ.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<div class="callout-content">
<p>View the CRS for each of these two datasets. What projection does
each use?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [2] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [3] "        DATUM[\"Amersfoort\","                                                                                         
 [4] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [5] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
 [6] "        PRIMEM[\"Greenwich\",0,"                                                                                       
 [7] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
 [8] "        ID[\"EPSG\",4289]],"                                                                                           
 [9] "    CONVERSION[\"RD New\","                                                                                            
[10] "        METHOD[\"Oblique Stereographic\","                                                                             
[11] "            ID[\"EPSG\",9809]],"                                                                                       
[12] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[14] "            ID[\"EPSG\",8801]],"                                                                                       
[15] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[16] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[17] "            ID[\"EPSG\",8802]],"                                                                                       
[18] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[19] "            SCALEUNIT[\"unity\",1],"                                                                                   
[20] "            ID[\"EPSG\",8805]],"                                                                                       
[21] "        PARAMETER[\"False easting\",155000,"                                                                           
[22] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[23] "            ID[\"EPSG\",8806]],"                                                                                       
[24] "        PARAMETER[\"False northing\",463000,"                                                                          
[25] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[26] "            ID[\"EPSG\",8807]]],"                                                                                      
[27] "    CS[Cartesian,2],"                                                                                                  
[28] "        AXIS[\"easting (X)\",east,"                                                                                    
[29] "            ORDER[1],"                                                                                                 
[30] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[31] "        AXIS[\"northing (Y)\",north,"                                                                                  
[32] "            ORDER[2],"                                                                                                 
[33] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[34] "    USAGE["                                                                                                            
[35] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[36] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[37] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[38] "    ID[\"EPSG\",28992]]"                                                                                               </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "GEOGCRS[\"WGS 84\","                                   
 [2] "    DATUM[\"World Geodetic System 1984\","             
 [3] "        ELLIPSOID[\"WGS 84\",6378137,298.257223563,"   
 [4] "            LENGTHUNIT[\"metre\",1]]],"                
 [5] "    PRIMEM[\"Greenwich\",0,"                           
 [6] "        ANGLEUNIT[\"degree\",0.0174532925199433]],"    
 [7] "    CS[ellipsoidal,2],"                                
 [8] "        AXIS[\"geodetic latitude (Lat)\",north,"       
 [9] "            ORDER[1],"                                 
[10] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[11] "        AXIS[\"geodetic longitude (Lon)\",east,"       
[12] "            ORDER[2],"                                 
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[14] "    ID[\"EPSG\",4326]]"                                </code></pre>
</div>
<p><code>DTM_TUD</code> is in the Amersfoort / RD New projection,
whereas <code>DTM_hill_TUD</code> is in WGS 84.</p>
</div>
</div>
</div>
</div>
<p>Because the two rasters are in different CRS, they don’t line up when
plotted in R. We need to reproject (or change the projection of)
<code>DTM_hill_TUD</code> into the Amersfoort / RD New CRS.</p>
</section><section id="reproject-rasters"><h2 class="section-heading">Reproject Rasters<a class="anchor" aria-label="anchor" href="#reproject-rasters"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>project()</code> function to reproject a raster
into a new CRS. Keep in mind that reprojection only works when you first
have a defined CRS for the raster object that you want to reproject. It
cannot be used if no CRS is defined. Lucky for us, DTM_hill_TUD has a
defined CRS.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>When we reproject a raster, we move it from one “grid” to another.
Thus, we are modifying the data! Keep this in mind as we work with
raster data.</p>
</div>
</div>
</div>
<p>To use the <code>project()</code> function, we need to define two
things:</p>
<ol style="list-style-type: decimal">
<li>the object we want to reproject and</li>
<li>the CRS that we want to reproject it to.</li>
</ol>
<p>The syntax is <code>project(RasterObject, crs)</code></p>
<p>We want the CRS of our hillshade to match the <code>DTM_TUD</code>
raster. We can thus assign the CRS of our <code>DTM_TUD</code> to our
hillshade within the <code>project()</code> function as follows:
<code>crs(DTM_TUD)</code>. Note that we are using the
<code>project()</code> function on the raster object, not the
<code>data.frame()</code> we use for plotting with
<code>ggplot</code>.</p>
<p>First we will reproject our <code>DTM_hill_TUD</code> raster data to
match the <code>DTM_TUD</code> raster CRS:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_EPSG28992_TUD</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>,</span>
<span>                                  <span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can compare the CRS of our original DTM hillshade and our new
DTM hillshade, to see how they are different.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [2] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [3] "        DATUM[\"Amersfoort\","                                                                                         
 [4] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [5] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
 [6] "        PRIMEM[\"Greenwich\",0,"                                                                                       
 [7] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
 [8] "        ID[\"EPSG\",4289]],"                                                                                           
 [9] "    CONVERSION[\"RD New\","                                                                                            
[10] "        METHOD[\"Oblique Stereographic\","                                                                             
[11] "            ID[\"EPSG\",9809]],"                                                                                       
[12] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[14] "            ID[\"EPSG\",8801]],"                                                                                       
[15] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[16] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[17] "            ID[\"EPSG\",8802]],"                                                                                       
[18] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[19] "            SCALEUNIT[\"unity\",1],"                                                                                   
[20] "            ID[\"EPSG\",8805]],"                                                                                       
[21] "        PARAMETER[\"False easting\",155000,"                                                                           
[22] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[23] "            ID[\"EPSG\",8806]],"                                                                                       
[24] "        PARAMETER[\"False northing\",463000,"                                                                          
[25] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[26] "            ID[\"EPSG\",8807]]],"                                                                                      
[27] "    CS[Cartesian,2],"                                                                                                  
[28] "        AXIS[\"easting (X)\",east,"                                                                                    
[29] "            ORDER[1],"                                                                                                 
[30] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[31] "        AXIS[\"northing (Y)\",north,"                                                                                  
[32] "            ORDER[2],"                                                                                                 
[33] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[34] "    USAGE["                                                                                                            
[35] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[36] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[37] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[38] "    ID[\"EPSG\",28992]]"                                                                                               </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "GEOGCRS[\"WGS 84\","                                   
 [2] "    DATUM[\"World Geodetic System 1984\","             
 [3] "        ELLIPSOID[\"WGS 84\",6378137,298.257223563,"   
 [4] "            LENGTHUNIT[\"metre\",1]]],"                
 [5] "    PRIMEM[\"Greenwich\",0,"                           
 [6] "        ANGLEUNIT[\"degree\",0.0174532925199433]],"    
 [7] "    CS[ellipsoidal,2],"                                
 [8] "        AXIS[\"geodetic latitude (Lat)\",north,"       
 [9] "            ORDER[1],"                                 
[10] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[11] "        AXIS[\"geodetic longitude (Lon)\",east,"       
[12] "            ORDER[2],"                                 
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[14] "    ID[\"EPSG\",4326]]"                                </code></pre>
</div>
<p>We can also compare the extent of the two objects.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 83537.3768729672, 87200.5199626113, 445202.584641046, 447230.395994242 (xmin, xmax, ymin, ymax)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">DTM_hill_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 4.34674898644234, 4.39970436836596, 51.9910492930106, 52.0088368700157 (xmin, xmax, ymin, ymax)</code></pre>
</div>
</section><section id="deal-with-raster-resolution"><h2 class="section-heading">Deal with Raster Resolution<a class="anchor" aria-label="anchor" href="#deal-with-raster-resolution"></a>
</h2>
<hr class="half-width">
<p>Let’s next have a look at the resolution of our reprojected hillshade
versus our original data.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5.03179 5.03179</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<p>These two resolutions are different, but they’re representing the
same data. We can tell R to force our newly reprojected raster to be the
same as <code>DTM_TUD</code> by adding a line of code
<code>res = res(DTM_TUD)</code> within the <code>project()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_EPSG28992_TUD</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, </span>
<span>                                  <span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span>,</span>
<span>                                  res <span class="op">=</span> <span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now both our resolutions and our CRSs match, so we can plot these two
data sets together. Let’s double-check our resolution to be sure:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<p>For plotting with <code>ggplot()</code>, we will need to create a
data frame from our newly reprojected raster.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_TUD_2_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now create a plot of this data.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_2_df</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-reproject-raster-data-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We have now successfully draped the Digital Terrain Model on top of
our hillshade to produce a nice looking, textured map!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>In order to plot two raster data sets together, they must be in the
same CRS.</li>
<li>Use the <code>project()</code> function to convert between
CRSs.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-16-raster-calculations"><p>Content from <a href="16-raster-calculations.html">Raster Calculations</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/16-raster-calculations.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I subtract one raster from another and extract pixel values
for defined locations?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Perform a subtraction between two rasters using raster math.</li>
<li>Export raster data as a GeoTIFF file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>We often want to combine values of and perform calculations on
rasters to create a new output raster. This episode covers how to
subtract one raster from another using basic raster math.</p>
<section id="raster-calculations-in-r"><h2 class="section-heading">Raster calculations in R<a class="anchor" aria-label="anchor" href="#raster-calculations-in-r"></a>
</h2>
<hr class="half-width">
<p>We often want to perform calculations on two or more rasters to
create a new output raster. For example, if we are interested in mapping
the heights of trees and buildings across an entire field site, we might
want to calculate the difference between the Digital Surface Model (DSM,
tops of trees and buildings) and the Digital Terrain Model (DTM, ground
level). The resulting dataset is referred to as a Canopy Height Model
(CHM) and represents the actual height of trees, buildings, etc. with
the influence of ground elevation removed.</p>
<figure><img src="https://datacarpentry.org/r-raster-vector-geospatial/fig/dc-spatial-raster/lidarTree-height.png" alt="" class="figure mx-auto d-block"><figcaption>Source: National Ecological Observatory Network
(NEON).</figcaption></figure></section><section id="load-the-data"><h2 class="section-heading">Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>For this episode, we will use the DTM and DSM data which we already
have loaded from previous episodes.</p>
<p>We use the <code>describe()</code> function to view information about
the DTM and DSM data files.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dtm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dtm-5m.tif"                                                                                            
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                 
 [2] "Files: data/tud-dsm-5m.tif"                                                                                            
 [3] "Size is 722, 386"                                                                                                      
 [4] "Coordinate System is:"                                                                                                 
 [5] "PROJCRS[\"Amersfoort / RD New\","                                                                                      
 [6] "    BASEGEOGCRS[\"Amersfoort\","                                                                                       
 [7] "        DATUM[\"Amersfoort\","                                                                                         
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                            
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                       
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                
[12] "        ID[\"EPSG\",4289]],"                                                                                           
[13] "    CONVERSION[\"RD New\","                                                                                            
[14] "        METHOD[\"Oblique Stereographic\","                                                                             
[15] "            ID[\"EPSG\",9809]],"                                                                                       
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"                                                    
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[18] "            ID[\"EPSG\",8801]],"                                                                                       
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"                                                   
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                 
[21] "            ID[\"EPSG\",8802]],"                                                                                       
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"                                                       
[23] "            SCALEUNIT[\"unity\",1],"                                                                                   
[24] "            ID[\"EPSG\",8805]],"                                                                                       
[25] "        PARAMETER[\"False easting\",155000,"                                                                           
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[27] "            ID[\"EPSG\",8806]],"                                                                                       
[28] "        PARAMETER[\"False northing\",463000,"                                                                          
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                  
[30] "            ID[\"EPSG\",8807]]],"                                                                                      
[31] "    CS[Cartesian,2],"                                                                                                  
[32] "        AXIS[\"easting (X)\",east,"                                                                                    
[33] "            ORDER[1],"                                                                                                 
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[35] "        AXIS[\"northing (Y)\",north,"                                                                                  
[36] "            ORDER[2],"                                                                                                 
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                 
[38] "    USAGE["                                                                                                            
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                          
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"                                                                                   
[42] "    ID[\"EPSG\",28992]]"                                                                                               
[43] "Data axis to CRS axis mapping: 1,2"                                                                                    
[44] "Origin = (83565.000000000000000,447180.000000000000000)"                                                               
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"                                                                   
[46] "Metadata:"                                                                                                             
[47] "  AREA_OR_POINT=Area"                                                                                                  
[48] "Image Structure Metadata:"                                                                                             
[49] "  INTERLEAVE=BAND"                                                                                                     
[50] "Corner Coordinates:"                                                                                                   
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"                                             
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"                                             
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"                                             
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"                                             
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"                                             
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<p>We’ve already loaded and worked with these two data files in earlier
episodes. Let’s plot them each once more to remind ourselves what this
data looks like. First we’ll plot the DTM elevation data:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And then the DSM elevation data:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , </span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="raster-math-and-canopy-height-models"><h2 class="section-heading">Raster math and Canopy Height Models<a class="anchor" aria-label="anchor" href="#raster-math-and-canopy-height-models"></a>
</h2>
<hr class="half-width">
<p>We can perform raster calculations by subtracting (or adding,
multiplying, etc.) two rasters. In the geospatial world, we call this
“raster math”.</p>
<p>Let’s subtract the DTM from the DSM to create a Canopy Height Model.
After subtracting, let’s create a data frame so we can plot with
<code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_TUD</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD</span> <span class="op">-</span> <span class="va">DTM_TUD</span></span>
<span><span class="va">CHM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now plot the output CHM.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_TUD_df</span> , </span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Canopy Height"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Let’s have a look at the distribution of values in our newly created
Canopy Height Model (CHM).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/16-raster-calculations-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure">
Notice that the range of values for the output CHM starts right below 0
and ranges to almost 100 meters. Does this make sense for buildings and
trees in Delft?</p>
<div id="challenge-explore-chm-raster-values" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-explore-chm-raster-values" class="callout-inner">
<h3 class="callout-title">Challenge: Explore CHM Raster Values<a class="anchor" aria-label="anchor" href="#challenge-explore-chm-raster-values"></a>
</h3>
<div class="callout-content">
<p>It’s often a good idea to explore the range of values in a raster
dataset just like we might explore a dataset that we collected in the
field.</p>
<ol style="list-style-type: decimal">
<li>What is the minimum and maximum value for the Canopy Height Model
<code>CHM_TUD</code> that we just created?</li>
<li>What is the distribution of all the pixel values in the CHM?</li>
<li>Plot the <code>CHM_TUD</code> raster using breaks that make sense
for the data. Include an appropriate colour palette for the data, plot
title and no axes ticks / labels.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">$</span><span class="va">`tud-dsm-5m`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -3.638057</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">$</span><span class="va">`tud-dsm-5m`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 92.08102</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">CHM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">CHM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>                  <span class="fu">mutate</span><span class="op">(</span>canopy_discrete <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       fill <span class="op">=</span> <span class="va">canopy_discrete</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-raster-calculations-rendered-unnamed-chunk-7-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="two-ways-to-perform-raster-calculations" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="two-ways-to-perform-raster-calculations" class="callout-inner">
<h3 class="callout-title">Two Ways to Perform Raster Calculations<a class="anchor" aria-label="anchor" href="#two-ways-to-perform-raster-calculations"></a>
</h3>
<div class="callout-content">
<p>We can calculate the difference between two rasters in two different
ways:</p>
<ul>
<li>by directly subtracting the two rasters in R using raster math,</li>
</ul>
<p>or for more efficient processing, particularly if our rasters are
large and/or the calculations we are performing are complex:</p>
<ul>
<li>using the <code>lapp()</code> function.</li>
</ul>
<p>See how <code>lapp()</code> is used in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/04-raster-calculations-in-r.html#efficient-raster-calculations" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
</section><section id="export-a-geotiff"><h2 class="section-heading">Export a GeoTIFF<a class="anchor" aria-label="anchor" href="#export-a-geotiff"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve created a new raster, let’s export the data as a
GeoTIFF file using the <code>writeRaster()</code> function.</p>
<p>When we write this raster object to a GeoTIFF file we’ll name it
<code>CHM_TUD.tiff</code>. This name allows us to quickly remember both
what the data contains (CHM data) and for where (TU Delft campus and
surroundings). The <code>writeRaster()</code> function by default writes
the output file to your working directory unless you specify a full file
path.</p>
<p>We will specify the output format (“GTiff”), the no data value
<code>NAflag = -9999</code>. We will also tell R to overwrite any data
that is already in a file of the same name.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">CHM_TUD</span>, <span class="st">"fig/CHM_TUD.tiff"</span>,</span>
<span>            filetype<span class="op">=</span><span class="st">"GTiff"</span>,</span>
<span>            overwrite<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>            NAflag<span class="op">=</span><span class="op">-</span><span class="fl">9999</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Rasters can be computed on using mathematical functions.</li>
<li>The <code>writeRaster()</code> function can be used to write raster
data to a file.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-17-work-with-multi-band-rasters"><p>Content from <a href="17-work-with-multi-band-rasters.html">Work with Multi-Band Rasters</a></p>
<hr>
<p>Last updated on 2024-01-29 |
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/17-work-with-multi-band-rasters.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I visualize individual and multiple bands in a raster
object?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Identify a single versus a multi-band raster file.</li>
<li>Import multi-band rasters into R using the <code>terra</code>
package.</li>
<li>Plot multi-band colour image rasters in R using the
<code>ggplot</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this
episode<a class="anchor" aria-label="anchor" href="#things-youll-need-to-complete-this-episode"></a>
</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>This episode explores how to import and plot a multi-band raster in
R.</p>
<section id="getting-started-with-multi-band-data-in-r"><h2 class="section-heading">Getting Started with Multi-Band Data in R<a class="anchor" aria-label="anchor" href="#getting-started-with-multi-band-data-in-r"></a>
</h2>
<hr class="half-width">
<p>In this episode, the multi-band data that we are working with is <a href="https://opendata.beeldmateriaal.nl/" class="external-link">Beeldmateriaal Open Data</a>
from the Netherlands. Each RGB image is a 3-band raster. The same steps
would apply to working with a multi-spectral image with 4 or more bands
- like Landsat imagery.</p>
<p>By using the <code>rast()</code> function along with the
<code>lyrs</code> parameter, we can read specific raster bands; omitting
this parameter would read instead all bands.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band1_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span>, lyrs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>We need to convert this data to a data frame in order to plot it with
<code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band1_TUD_df</span>  <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_band1_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_band1_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="image-raster-data-values"><h2 class="section-heading">Image Raster Data Values<a class="anchor" aria-label="anchor" href="#image-raster-data-values"></a>
</h2>
<hr class="half-width">
<p>This raster contains values between 0 and 255. These values represent
degrees of brightness associated with the image band. In the case of a
RGB image (red, green and blue), band 1 is the red band. When we plot
the red band, larger numbers (towards 255) represent pixels with more
red in them (a strong red reflection). Smaller numbers (towards 0)
represent pixels with less red in them (less red was reflected). To plot
an RGB image, we mix red + green + blue values into one single colour to
create a full colour image - similar to the colour image a digital
camera creates.</p>
</section><section id="import-a-specific-band"><h2 class="section-heading">Import a Specific Band<a class="anchor" aria-label="anchor" href="#import-a-specific-band"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>rast()</code> function to import specific bands
in our raster object by specifying which band we want with
<code>lyrs = N</code> (N represents the band number we want to work
with). To import the green band, we would use <code>lyrs = 2</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band2_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span>, lyrs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<p>We can convert this data to a data frame and plot the same way we
plotted the red band:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band2_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_band2_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_band2_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_2`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="raster-stacks"><h2 class="section-heading">Raster Stacks<a class="anchor" aria-label="anchor" href="#raster-stacks"></a>
</h2>
<hr class="half-width">
<p>Next, we will work with all three image bands (red, green and blue)
as an R raster object. We will then plot a 3-band composite, or
full-colour, image.</p>
<p>To bring in all bands of a multi-band raster, we use the
<code>rast()</code> function.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s preview the attributes of our stack object:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 4988, 4866, 3  (nrow, ncol, nlyr)
resolution  : 0.08, 0.08  (x, y)
extent      : 85272, 85661.28, 446295.2, 446694.2  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992) 
source      : tudlib-rgb.tif 
colors RGB  : 1, 2, 3 
names       : tudlib-rgb_1, tudlib-rgb_2, tudlib-rgb_3 </code></pre>
</div>
<p>We can view the attributes of each band in the stack in a single
output. For example, if we had hundreds of bands, we could specify which
band we’d like to view attributes for using an index value:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 4988, 4866, 1  (nrow, ncol, nlyr)
resolution  : 0.08, 0.08  (x, y)
extent      : 85272, 85661.28, 446295.2, 446694.2  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992) 
source      : tudlib-rgb.tif 
name        : tudlib-rgb_2 </code></pre>
</div>
<p>We can also use <code>ggplot2</code> to plot the data in any layer of
our raster object. Remember, we need to convert to a data frame
first.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_stack_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Each band in our RasterStack gets its own column in the data frame.
Thus we have:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">RGB_stack_TUD_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	24271608 obs. of  5 variables:
 $ x           : num  85272 85272 85272 85272 85272 ...
 $ y           : num  446694 446694 446694 446694 446694 ...
 $ tudlib-rgb_1: int  52 48 47 49 47 45 47 48 49 54 ...
 $ tudlib-rgb_2: int  64 58 57 60 57 55 58 59 62 69 ...
 $ tudlib-rgb_3: int  57 49 49 53 50 47 51 54 57 68 ...</code></pre>
</div>
<p>Let’s create a histogram of the first band:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_stack_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">`tudlib-rgb_1`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure">
And a raster plot of the second band:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_stack_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_2`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can access any individual band in the same way.</p>
</section><section id="create-a-three-band-image"><h2 class="section-heading">Create a three-band image<a class="anchor" aria-label="anchor" href="#create-a-three-band-image"></a>
</h2>
<hr class="half-width">
<p>To render a final three-band, coloured image in R, we use the
<code>plotRGB()</code> function.</p>
<p>This function allows us to:</p>
<ul>
<li>Identify what bands we want to render in the red, green and blue
regions. The <code>plotRGB()</code> function defaults to a 1=red,
2=green, and 3=blue band order. However, you can define what bands you’d
like to plot manually. Manual definition of bands is useful if you have,
for example a near-infrared band and want to create a colour infrared
image.</li>
<li>Adjust the stretch of the image to increase or decrease
contrast.</li>
</ul>
<p>Let’s plot our 3-band image. Note that we can use the
<code>plotRGB()</code> function directly with our RasterStack object (we
don’t need a data frame as this function isn’t part of the
<code>ggplot2</code> package).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">RGB_stack_TUD</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The image above looks pretty good. We can explore whether applying a
stretch to the image might improve clarity and contrast using
stretch=“lin” or stretch=“hist”, as explained in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html#create-a-three-band-image" class="external-link">this
lesson</a>.</p>
<div id="spatraster-in-r" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="spatraster-in-r" class="callout-inner">
<h3 class="callout-title">SpatRaster in R<a class="anchor" aria-label="anchor" href="#spatraster-in-r"></a>
</h3>
<div class="callout-content">
<p>The R SpatRaster object type can handle rasters with multiple bands.
The SpatRaster only holds parameters that describe the properties of
raster data that is located somewhere on our computer.</p>
<p>A SpatRasterDataset object can hold references to sub-datasets, that
is, SpatRaster objects. In most cases, we can work with a SpatRaster in
the same way we might work with a SpatRasterDataset.</p>
<p>Read more about SpatRasters in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html#spatraster-in-r" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>A single raster file can contain multiple bands or layers.</li>
<li>Use the <code>rast()</code> function to load all bands in a
multi-layer raster file into R.</li>
<li>Individual bands within a SpatRaster can be accessed, analysed, and
visualized using the same functions no matter how many bands it
holds.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/r-geospatial-urban/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/r-geospatial-urban/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/r-geospatial-urban/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:c.forgaci@tudelft.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/r-geospatial-urban/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, geospatial",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/r-geospatial-urban/aio.html",
  "identifier": "https://carpentries-incubator.github.io/r-geospatial-urban/aio.html",
  "dateCreated": "2024-01-29",
  "dateModified": "2024-01-29",
  "datePublished": "2024-01-29"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

